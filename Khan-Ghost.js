/// ////////////////////////////////////////////
// SIM! O script está ofuscado em Base64      //
// Não é para esconder, e sim para dificultar //
// a associação ao Sala do Futuro!            //
////////////////////////////////////////////////


(function(base64Input){
    const decodedText = new TextDecoder("utf-8").decode(
        Uint8Array.from(atob(base64Input), char => char.charCodeAt(0))
    );
    eval(decodedText);
})("Y29uc3QgY29udHJvbFBhbmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CmNvbnN0IGZsb2F0aW5nQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7Cgp3aW5kb3cuZmVhdHVyZXMgPSB7CiAgICBieXBhc3NRdWVzdGlvbnM6IHRydWUsCiAgICBza2lwVmlkZW9zOiB0cnVlLAogICAgcmV2ZWFsQ29ycmVjdDogdHJ1ZSwKICAgIGluc3RhbnRDb21wbGV0ZTogZmFsc2UKfTsKCndpbmRvdy5mZWF0dXJlQ29uZmlncyA9IHsKICAgIGNvbXBsZXRpb25TcGVlZDogMwp9OwoKY29uc3QgaW5pdGlhbGl6ZUljb25zID0gKCkgPT4gewogICAgaWYgKHR5cGVvZiBsdWNpZGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgbHVjaWRlLmNyZWF0ZUljb25zKCk7CiAgICB9IGVsc2UgewogICAgICAgIHNldFRpbWVvdXQoaW5pdGlhbGl6ZUljb25zLCAxMDApOwogICAgfQp9OwoKY2xhc3MgRXZlbnRFbWl0dGVyIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHRoaXMuZXZlbnRzID0ge307CiAgICB9CiAgICBvbih0LCBlKSB7CiAgICAgICAgaWYgKHR5cGVvZiB0ID09PSAic3RyaW5nIikgdCA9IFt0XTsKICAgICAgICB0LmZvckVhY2goZXZlbnQgPT4gewogICAgICAgICAgICBpZiAoIXRoaXMuZXZlbnRzW2V2ZW50XSkgdGhpcy5ldmVudHNbZXZlbnRdID0gW107CiAgICAgICAgICAgIHRoaXMuZXZlbnRzW2V2ZW50XS5wdXNoKGUpOwogICAgICAgIH0pOwogICAgfQogICAgZW1pdCh0LCAuLi5lKSB7CiAgICAgICAgaWYgKHRoaXMuZXZlbnRzW3RdKSB7CiAgICAgICAgICAgIHRoaXMuZXZlbnRzW3RdLmZvckVhY2goY2FsbGJhY2sgPT4gY2FsbGJhY2soLi4uZSkpOwogICAgICAgIH0KICAgIH0KfQoKY29uc3QgZXZlbnRCdXMgPSBuZXcgRXZlbnRFbWl0dGVyKCk7CgpuZXcgTXV0YXRpb25PYnNlcnZlcigobXV0YXRpb25zTGlzdCkgPT4gewogICAgZm9yIChsZXQgbXV0YXRpb24gb2YgbXV0YXRpb25zTGlzdCkgewogICAgICAgIGlmIChtdXRhdGlvbi50eXBlID09PSAnY2hpbGRMaXN0JykgZXZlbnRCdXMuZW1pdCgnZG9tQ2hhbmdlZCcpOwogICAgfQp9KS5vYnNlcnZlKGRvY3VtZW50LmJvZHksIHsgY2hpbGRMaXN0OiB0cnVlLCBzdWJ0cmVlOiB0cnVlIH0pOwoKY29uc3Qgd2FpdCA9IG1zID0+IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpOwoKY29uc3QgY2xpY2tFbGVtZW50ID0gc2VsZWN0b3IgPT4gewogICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpOwogICAgaWYgKGVsZW1lbnQpIGVsZW1lbnQuY2xpY2soKTsKfTsKCmNvbnN0IHVwZGF0ZUNvbmZpZyA9IChwYXRoLCB2YWx1ZSkgPT4gewogICAgbGV0IG9iaiA9IHdpbmRvdzsKICAgIGNvbnN0IHBhcnRzID0gcGF0aC5zcGxpdCgnLicpOwogICAgd2hpbGUgKHBhcnRzLmxlbmd0aCA+IDEpIG9iaiA9IG9ialtwYXJ0cy5zaGlmdCgpXTsKICAgIG9ialtwYXJ0c1swXV0gPSB2YWx1ZTsKfTsKCmZ1bmN0aW9uIGNsZWFudXBQYWdlKCkgewogICAgY29uc3QgcmVtb3ZlU2VsZWN0b3JzID0gWwogICAgICAgICdmb290ZXIuXzRzanV6dicsCiAgICAgICAgJ2Rpdi5fMWNwOWN4cGsnLAogICAgICAgICdkaXYuX2g4dHBvbScsCiAgICAgICAgJ2Rpdi5fMTR3bXF1MWInLAogICAgICAgICdkaXYuXzgzMTFjY2InLAogICAgICAgICdkaXYudXNlci1pbmZvLWFsbCcsCiAgICAgICAgJ2Rpdi51c2VyLWluZm8uY2xlYXJmaXgnLAogICAgICAgICdbZGF0YS1zbHVnPSJ0b3BpYy1wcm9ncmVzcyJdJwogICAgXTsKICAgIAogICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigoKSA9PiB7CiAgICAgICAgcmVtb3ZlU2VsZWN0b3JzLmZvckVhY2goc2VsZWN0b3IgPT4gewogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKS5mb3JFYWNoKGVsID0+IGVsLnJlbW92ZSgpKTsKICAgICAgICB9KTsKICAgIH0pOwogICAgCiAgICBvYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmJvZHksIHsgY2hpbGRMaXN0OiB0cnVlLCBzdWJ0cmVlOiB0cnVlIH0pOwogICAgCiAgICByZW1vdmVTZWxlY3RvcnMuZm9yRWFjaChzZWxlY3RvciA9PiB7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikuZm9yRWFjaChlbCA9PiBlbC5yZW1vdmUoKSk7CiAgICB9KTsKfQoKZnVuY3Rpb24gY3JlYXRlSW50ZXJmYWNlKCkgewogICAgT2JqZWN0LmFzc2lnbihmbG9hdGluZ0J1dHRvbi5zdHlsZSwgewogICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLAogICAgICAgIHRvcDogJzIwcHgnLAogICAgICAgIHJpZ2h0OiAnMjBweCcsCiAgICAgICAgd2lkdGg6ICc2MHB4JywKICAgICAgICBoZWlnaHQ6ICc2MHB4JywKICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjMGEwYTBhJywKICAgICAgICBib3JkZXI6ICcycHggc29saWQgIzFhMWExYScsCiAgICAgICAgY29sb3I6ICcjZmZmJywKICAgICAgICBmb250U2l6ZTogJzI0cHgnLAogICAgICAgIGRpc3BsYXk6ICdmbGV4JywKICAgICAgICBqdXN0aWZ5Q29udGVudDogJ2NlbnRlcicsCiAgICAgICAgYWxpZ25JdGVtczogJ2NlbnRlcicsCiAgICAgICAgY3Vyc29yOiAncG9pbnRlcicsCiAgICAgICAgdXNlclNlbGVjdDogJ25vbmUnLAogICAgICAgIGJvcmRlclJhZGl1czogJzE2cHgnLAogICAgICAgIHpJbmRleDogJzEwMDAxJywKICAgICAgICB0cmFuc2l0aW9uOiAnYWxsIDAuM3MgY3ViaWMtYmV6aWVyKDAuNCwgMCwgMC4yLCAxKScsCiAgICAgICAgYmFja2Ryb3BGaWx0ZXI6ICdibHVyKDEwcHgpJywKICAgICAgICBXZWJraXRCYWNrZHJvcEZpbHRlcjogJ2JsdXIoMTBweCknCiAgICB9KTsKCiAgICBmbG9hdGluZ0J1dHRvbi5pbm5lckhUTUwgPSBgPGkgZGF0YS1sdWNpZGU9Imdob3N0IiBzdHlsZT0id2lkdGg6IDMycHg7IGhlaWdodDogMzJweDsgY29sb3I6ICM4YjVjZjY7Ij48L2k+YDsKCiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZsb2F0aW5nQnV0dG9uKTsKCiAgICBPYmplY3QuYXNzaWduKGNvbnRyb2xQYW5lbC5zdHlsZSwgewogICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgIHRvcDogJ2NhbGMoMTAwJSArIDEwcHgpJywKICAgICAgICByaWdodDogJzAnLAogICAgICAgIHdpZHRoOiAnMjgwcHgnLAogICAgICAgIG1heFdpZHRoOiAnOTB2dycsCiAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzBhMGEwYScsCiAgICAgICAgYm9yZGVyOiAnMnB4IHNvbGlkICMxYTFhMWEnLAogICAgICAgIGJvcmRlclJhZGl1czogJzE2cHgnLAogICAgICAgIGNvbG9yOiAnI2ZmZicsCiAgICAgICAgZm9udFNpemU6ICcxNHB4JywKICAgICAgICBmb250RmFtaWx5OiAnLWFwcGxlLXN5c3RlbSwgQmxpbmtNYWNTeXN0ZW1Gb250LCAiU2Vnb2UgVUkiLCBSb2JvdG8sIHNhbnMtc2VyaWYnLAogICAgICAgIGRpc3BsYXk6ICdub25lJywKICAgICAgICBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJywKICAgICAgICB6SW5kZXg6ICcxMDAwMCcsCiAgICAgICAgcGFkZGluZzogJzE2cHgnLAogICAgICAgIGN1cnNvcjogJ2RlZmF1bHQnLAogICAgICAgIHVzZXJTZWxlY3Q6ICdub25lJywKICAgICAgICB0cmFuc2l0aW9uOiAnYWxsIDAuM3MgY3ViaWMtYmV6aWVyKDAuNCwgMCwgMC4yLCAxKScsCiAgICAgICAgYmFja2Ryb3BGaWx0ZXI6ICdibHVyKDIwcHgpJywKICAgICAgICBXZWJraXRCYWNrZHJvcEZpbHRlcjogJ2JsdXIoMjBweCknLAogICAgICAgIG9wYWNpdHk6ICcwJwogICAgfSk7CgogICAgY29udHJvbFBhbmVsLmlubmVySFRNTCA9IGAKICAgICAgICA8c3R5bGU+CiAgICAgICAgICAgIEBtZWRpYSAobWF4LXdpZHRoOiA3NjhweCkgewogICAgICAgICAgICAgICAgI2toYW5HaG9zdFBhbmVsIHsKICAgICAgICAgICAgICAgICAgICB3aWR0aDogMjYwcHggIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAxMnB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgZm9udC1zaXplOiAxM3B4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICNraGFuR2hvc3RCdXR0b24gewogICAgICAgICAgICAgICAgICAgIHdpZHRoOiA1MHB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA1MHB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC5naG9zdC1mZWF0dXJlLXRleHQgewogICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTNweCAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBAa2V5ZnJhbWVzIGdob3N0U2xpZGVJbiB7CiAgICAgICAgICAgICAgICBmcm9tIHsKICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwOwogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMTBweCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0byB7CiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMTsKICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1oZWFkZXIgewogICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgICAgIGdhcDogMTJweDsKICAgICAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOiAxNnB4OwogICAgICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMnB4IHNvbGlkICMxYTFhMWE7CiAgICAgICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxNnB4OwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3QtaGVhZGVyIGkgewogICAgICAgICAgICAgICAgd2lkdGg6IDI0cHg7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDI0cHg7CiAgICAgICAgICAgICAgICBjb2xvcjogIzhiNWNmNjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LXRpdGxlIHsKICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMThweDsKICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7CiAgICAgICAgICAgICAgICBjb2xvcjogI2ZmZjsKICAgICAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiAwLjVweDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LXN3aXRjaCB7CiAgICAgICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgICAgICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICAgICAgICAgICAgICB3aWR0aDogNDhweDsKICAgICAgICAgICAgICAgIGhlaWdodDogMjRweDsKICAgICAgICAgICAgICAgIGZsZXgtc2hyaW5rOiAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3Qtc3dpdGNoIGlucHV0IHsKICAgICAgICAgICAgICAgIG9wYWNpdHk6IDA7CiAgICAgICAgICAgICAgICB3aWR0aDogMDsKICAgICAgICAgICAgICAgIGhlaWdodDogMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LXNsaWRlciB7CiAgICAgICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgICAgICB0b3A6IDA7CiAgICAgICAgICAgICAgICBsZWZ0OiAwOwogICAgICAgICAgICAgICAgcmlnaHQ6IDA7CiAgICAgICAgICAgICAgICBib3R0b206IDA7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMWExYTFhOwogICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogMC4zczsKICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDI0cHg7CiAgICAgICAgICAgICAgICBib3JkZXI6IDJweCBzb2xpZCAjMmEyYTJhOwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3Qtc2xpZGVyOmJlZm9yZSB7CiAgICAgICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgICAgICAgICBjb250ZW50OiAiIjsKICAgICAgICAgICAgICAgIGhlaWdodDogMTZweDsKICAgICAgICAgICAgICAgIHdpZHRoOiAxNnB4OwogICAgICAgICAgICAgICAgbGVmdDogMnB4OwogICAgICAgICAgICAgICAgYm90dG9tOiAycHg7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjNDQ0OwogICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogMC4zczsKICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW5wdXQ6Y2hlY2tlZCArIC5naG9zdC1zbGlkZXIgewogICAgICAgICAgICAgICAgYmFja2dyb3VuZDogIzI4QTc0NTsKICAgICAgICAgICAgICAgIGJvcmRlci1jb2xvcjogIzI4QTc0NTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW5wdXQ6Y2hlY2tlZCArIC5naG9zdC1zbGlkZXI6YmVmb3JlIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgyNHB4KTsKICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmZmY7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1mZWF0dXJlLWl0ZW0gewogICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICAgICAgICAgICAgICBwYWRkaW5nOiAxNHB4IDA7CiAgICAgICAgICAgICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgIzFhMWExYTsKICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogZ2hvc3RTbGlkZUluIDAuM3MgZWFzZS1vdXQ7CiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3QtZmVhdHVyZS1pdGVtOmhvdmVyIHsKICAgICAgICAgICAgICAgIHBhZGRpbmctbGVmdDogOHB4OwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3QtZmVhdHVyZS1pdGVtOmxhc3QtY2hpbGQgewogICAgICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogbm9uZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LWZlYXR1cmUtbGFiZWwgewogICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgICAgICBnYXA6IDEycHg7CiAgICAgICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgICAgICBmbGV4LWdyb3c6IDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1mZWF0dXJlLWxhYmVsIGkgewogICAgICAgICAgICAgICAgd2lkdGg6IDIwcHg7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDIwcHg7CiAgICAgICAgICAgICAgICBjb2xvcjogIzhiNWNmNjsKICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAwLjJzIGVhc2U7CiAgICAgICAgICAgICAgICBmbGV4LXNocmluazogMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LWZlYXR1cmUtaXRlbTpob3ZlciAuZ2hvc3QtZmVhdHVyZS1sYWJlbCBpIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogc2NhbGUoMS4xKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LWZlYXR1cmUtdGV4dCB7CiAgICAgICAgICAgICAgICBmb250LXNpemU6IDE0cHg7CiAgICAgICAgICAgICAgICBjb2xvcjogI2UwZTBlMDsKICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA1MDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1zbGlkZXItY29udGFpbmVyIHsKICAgICAgICAgICAgICAgIHBhZGRpbmc6IDE0cHggMDsKICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogZ2hvc3RTbGlkZUluIDAuM3MgZWFzZS1vdXQ7CiAgICAgICAgICAgICAgICBhbmltYXRpb24tZGVsYXk6IDAuMXM7CiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwOwogICAgICAgICAgICAgICAgYW5pbWF0aW9uLWZpbGwtbW9kZTogZm9yd2FyZHM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1zbGlkZXItbGFiZWwgewogICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgICAgICBnYXA6IDhweDsKICAgICAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDEycHg7CiAgICAgICAgICAgICAgICBjb2xvcjogI2EwYTBhMDsKICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgICAgICAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgICAgICAgICAgICAgbGV0dGVyLXNwYWNpbmc6IDAuNXB4OwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3Qtc2xpZGVyLWxhYmVsIGkgewogICAgICAgICAgICAgICAgd2lkdGg6IDE2cHg7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDE2cHg7CiAgICAgICAgICAgICAgICBjb2xvcjogIzYzNjZmMTsKICAgICAgICAgICAgICAgIGZsZXgtc2hyaW5rOiAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpbnB1dFt0eXBlPSJyYW5nZSJdIHsKICAgICAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICAgICAgaGVpZ2h0OiA2cHg7CiAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiAzcHg7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gcmlnaHQsICM4YjVjZjYgMCUsICM2MzY2ZjEgMTAwJSk7CiAgICAgICAgICAgICAgICBvdXRsaW5lOiBub25lOwogICAgICAgICAgICAgICAgb3BhY2l0eTogMC45OwogICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogb3BhY2l0eSAwLjJzOwogICAgICAgICAgICAgICAgLXdlYmtpdC1hcHBlYXJhbmNlOiBub25lOwogICAgICAgICAgICAgICAgYXBwZWFyYW5jZTogbm9uZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW5wdXRbdHlwZT0icmFuZ2UiXTpob3ZlciB7CiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpbnB1dFt0eXBlPSJyYW5nZSJdOjotd2Via2l0LXNsaWRlci10aHVtYiB7CiAgICAgICAgICAgICAgICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmU7CiAgICAgICAgICAgICAgICBhcHBlYXJhbmNlOiBub25lOwogICAgICAgICAgICAgICAgd2lkdGg6IDE4cHg7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDE4cHg7CiAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZmZmOwogICAgICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW5wdXRbdHlwZT0icmFuZ2UiXTo6LXdlYmtpdC1zbGlkZXItdGh1bWI6aG92ZXIgewogICAgICAgICAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxLjIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpbnB1dFt0eXBlPSJyYW5nZSJdOjotbW96LXJhbmdlLXRodW1iIHsKICAgICAgICAgICAgICAgIHdpZHRoOiAxOHB4OwogICAgICAgICAgICAgICAgaGVpZ2h0OiAxOHB4OwogICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgICAgICAgICAgICAgYmFja2dyb3VuZDogI2ZmZjsKICAgICAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlucHV0W3R5cGU9InJhbmdlIl06Oi1tb3otcmFuZ2UtdGh1bWI6aG92ZXIgewogICAgICAgICAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxLjIpOwogICAgICAgICAgICB9CiAgICAgICAgPC9zdHlsZT4KICAgICAgICA8ZGl2IGNsYXNzPSJnaG9zdC1oZWFkZXIiPgogICAgICAgICAgICA8c3BhbiBjbGFzcz0iZ2hvc3QtdGl0bGUiPktoYW5HaG9zdDwvc3Bhbj4KICAgICAgICA8L2Rpdj4KICAgIGA7CgogICAgZmxvYXRpbmdCdXR0b24uaWQgPSAna2hhbkdob3N0QnV0dG9uJzsKICAgIGNvbnRyb2xQYW5lbC5pZCA9ICdraGFuR2hvc3RQYW5lbCc7CgogICAgZmxvYXRpbmdCdXR0b24uYXBwZW5kQ2hpbGQoY29udHJvbFBhbmVsKTsKCiAgICBjb25zdCBmZWF0dXJlcyA9IFsKICAgICAgICB7IGlkOiAnYnlwYXNzUXVlc3Rpb25zJywgaWNvbjogJ2ZpbGUtcXVlc3Rpb24nLCBsYWJlbDogJ0J5cGFzcyBRdWVzdGlvbnMnLCB2YXJpYWJsZTogJ2ZlYXR1cmVzLmJ5cGFzc1F1ZXN0aW9ucycsIGNoZWNrZWQ6IHRydWUgfSwKICAgICAgICB7IGlkOiAnc2tpcFZpZGVvcycsIGljb246ICd2aWRlbycsIGxhYmVsOiAnU2tpcCBWaWRlb3MnLCB2YXJpYWJsZTogJ2ZlYXR1cmVzLnNraXBWaWRlb3MnLCBjaGVja2VkOiB0cnVlIH0sCiAgICAgICAgeyBpZDogJ3JldmVhbENvcnJlY3QnLCBpY29uOiAnZXllJywgbGFiZWw6ICdSZXZlYWwgQ29ycmVjdCcsIHZhcmlhYmxlOiAnZmVhdHVyZXMucmV2ZWFsQ29ycmVjdCcsIGNoZWNrZWQ6IHRydWUgfSwKICAgICAgICB7IGlkOiAnaW5zdGFudENvbXBsZXRlJywgaWNvbjogJ3phcCcsIGxhYmVsOiAnSW5zdGFudCBDb21wbGV0ZScsIHZhcmlhYmxlOiAnZmVhdHVyZXMuaW5zdGFudENvbXBsZXRlJywgY2hlY2tlZDogZmFsc2UsIGRlcGVuZGVudDogJ3NwZWVkQ29udHJvbCcgfQogICAgXTsKCiAgICBmZWF0dXJlcy5mb3JFYWNoKGZlYXR1cmUgPT4gewogICAgICAgIGNvbnN0IGZlYXR1cmVEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBmZWF0dXJlRGl2LmNsYXNzTmFtZSA9ICdnaG9zdC1mZWF0dXJlLWl0ZW0nOwogICAgICAgIGZlYXR1cmVEaXYuaW5uZXJIVE1MID0gYAogICAgICAgICAgICA8bGFiZWwgY2xhc3M9Imdob3N0LWZlYXR1cmUtbGFiZWwiPgogICAgICAgICAgICAgICAgPGkgZGF0YS1sdWNpZGU9IiR7ZmVhdHVyZS5pY29ufSI+PC9pPgogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Imdob3N0LWZlYXR1cmUtdGV4dCI+JHtmZWF0dXJlLmxhYmVsfTwvc3Bhbj4KICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJnaG9zdC1zd2l0Y2giPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0iJHtmZWF0dXJlLmlkfSIgJHtmZWF0dXJlLmNoZWNrZWQgPyAnY2hlY2tlZCcgOiAnJ30+CiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZ2hvc3Qtc2xpZGVyIj48L3NwYW4+CiAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgYDsKICAgICAgICBjb250cm9sUGFuZWwuYXBwZW5kQ2hpbGQoZmVhdHVyZURpdik7CgogICAgICAgIGNvbnN0IGNoZWNrYm94ID0gZmVhdHVyZURpdi5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpOwogICAgICAgIGNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7CiAgICAgICAgICAgIHVwZGF0ZUNvbmZpZyhmZWF0dXJlLnZhcmlhYmxlLCBlLnRhcmdldC5jaGVja2VkKTsKICAgICAgICAgICAgaWYgKGZlYXR1cmUuZGVwZW5kZW50KSB7CiAgICAgICAgICAgICAgICBjb25zdCBkZXBlbmRlbnRFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZlYXR1cmUuZGVwZW5kZW50KTsKICAgICAgICAgICAgICAgIGlmIChkZXBlbmRlbnRFbCkgewogICAgICAgICAgICAgICAgICAgIGRlcGVuZGVudEVsLnN0eWxlLmRpc3BsYXkgPSBlLnRhcmdldC5jaGVja2VkID8gJ2Jsb2NrJyA6ICdub25lJzsKICAgICAgICAgICAgICAgICAgICBkZXBlbmRlbnRFbC5zdHlsZS5vcGFjaXR5ID0gZS50YXJnZXQuY2hlY2tlZCA/ICcxJyA6ICcwJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZmVhdHVyZS5pZCA9PT0gJ2luc3RhbnRDb21wbGV0ZScgJiYgZS50YXJnZXQuY2hlY2tlZCAmJiAhd2luZG93LmZlYXR1cmVzLmJ5cGFzc1F1ZXN0aW9ucykgewogICAgICAgICAgICAgICAgY29uc3QgYnlwYXNzQ2hlY2tib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnlwYXNzUXVlc3Rpb25zJyk7CiAgICAgICAgICAgICAgICBpZiAoYnlwYXNzQ2hlY2tib3gpIHsKICAgICAgICAgICAgICAgICAgICBieXBhc3NDaGVja2JveC5jaGVja2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmVhdHVyZXMuYnlwYXNzUXVlc3Rpb25zID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSk7CgogICAgY29uc3Qgc2xpZGVyQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBzbGlkZXJDb250YWluZXIuY2xhc3NOYW1lID0gJ2dob3N0LXNsaWRlci1jb250YWluZXInOwogICAgc2xpZGVyQ29udGFpbmVyLmlkID0gJ3NwZWVkQ29udHJvbCc7CiAgICBzbGlkZXJDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIHNsaWRlckNvbnRhaW5lci5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0iZ2hvc3Qtc2xpZGVyLWxhYmVsIj4KICAgICAgICAgICAgPGkgZGF0YS1sdWNpZGU9InRpbWVyIj48L2k+CiAgICAgICAgICAgIDxzcGFuPkNvbXBsZXRpb24gU3BlZWQ8L3NwYW4+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGlucHV0IHR5cGU9InJhbmdlIiBtaW49IjEiIG1heD0iMyIgdmFsdWU9IjEiIGlkPSJzcGVlZFNsaWRlciI+CiAgICBgOwogICAgY29udHJvbFBhbmVsLmFwcGVuZENoaWxkKHNsaWRlckNvbnRhaW5lcik7CgogICAgY29uc3Qgc3BlZWRTbGlkZXIgPSBzbGlkZXJDb250YWluZXIucXVlcnlTZWxlY3RvcignaW5wdXQnKTsKICAgIHNwZWVkU2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKGUpID0+IHsKICAgICAgICB3aW5kb3cuZmVhdHVyZUNvbmZpZ3MuY29tcGxldGlvblNwZWVkID0gNCAtIGUudGFyZ2V0LnZhbHVlOwogICAgfSk7CgogICAgbGV0IG1lbnVPcGVuID0gZmFsc2U7CgogICAgZnVuY3Rpb24gb3Blbk1lbnUoKSB7CiAgICAgICAgY29udHJvbFBhbmVsLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiBjb250cm9sUGFuZWwuc3R5bGUub3BhY2l0eSA9ICcxJywgMTApOwogICAgICAgIG1lbnVPcGVuID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBjbG9zZU1lbnUoKSB7CiAgICAgICAgY29udHJvbFBhbmVsLnN0eWxlLm9wYWNpdHkgPSAnMCc7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiBjb250cm9sUGFuZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJywgMzAwKTsKICAgICAgICBtZW51T3BlbiA9IGZhbHNlOwogICAgfQoKICAgIGZsb2F0aW5nQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIGlmIChtZW51T3BlbikgewogICAgICAgICAgICBjbG9zZU1lbnUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBvcGVuTWVudSgpOwogICAgICAgIH0KICAgIH0pOwoKICAgIGNvbnRyb2xQYW5lbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgIH0pOwoKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICBpZiAobWVudU9wZW4gJiYgIWZsb2F0aW5nQnV0dG9uLmNvbnRhaW5zKGUudGFyZ2V0KSkgewogICAgICAgICAgICBjbG9zZU1lbnUoKTsKICAgICAgICB9CiAgICB9KTsKfQoKY29uc3QgY29ycmVjdEFuc3dlcnMgPSBuZXcgTWFwKCk7Cgpjb25zdCB0b0ZyYWN0aW9uID0gKGQpID0+IHsKICAgIGlmIChkID09PSAwIHx8IGQgPT09IDEpIHJldHVybiBTdHJpbmcoZCk7CiAgICBjb25zdCBkZWNpbWFscyA9IChTdHJpbmcoZCkuc3BsaXQoJy4nKVsxXSB8fCAnJykubGVuZ3RoOwogICAgbGV0IG51bSA9IE1hdGgucm91bmQoZCAqIE1hdGgucG93KDEwLCBkZWNpbWFscykpOwogICAgbGV0IGRlbiA9IE1hdGgucG93KDEwLCBkZWNpbWFscyk7CiAgICBjb25zdCBnY2QgPSAoYSwgYikgPT4gewogICAgICAgIHdoaWxlIChiKSB7CiAgICAgICAgICAgIFthLCBiXSA9IFtiLCBhICUgYl07CiAgICAgICAgfQogICAgICAgIHJldHVybiBhOwogICAgfTsKICAgIGNvbnN0IGRpdiA9IGdjZChNYXRoLmFicyhudW0pLCBNYXRoLmFicyhkZW4pKTsKICAgIHJldHVybiBkZW4gLyBkaXYgPT09IDEgPyBTdHJpbmcobnVtIC8gZGl2KSA6IGAke251bSAvIGRpdn0vJHtkZW4gLyBkaXZ9YDsKfTsKCmZ1bmN0aW9uIGludGVyY2VwdFF1ZXN0aW9ucygpIHsKICAgIGNvbnN0IG9yaWdpbmFsRmV0Y2ggPSB3aW5kb3cuZmV0Y2g7CgogICAgd2luZG93LmZldGNoID0gYXN5bmMgZnVuY3Rpb24oaW5wdXQsIGluaXQpIHsKICAgICAgICBjb25zdCB1cmwgPSBpbnB1dCBpbnN0YW5jZW9mIFJlcXVlc3QgPyBpbnB1dC51cmwgOiBpbnB1dDsKICAgICAgICBsZXQgYm9keSA9IGlucHV0IGluc3RhbmNlb2YgUmVxdWVzdCA/IGF3YWl0IGlucHV0LmNsb25lKCkudGV4dCgpIDogaW5pdD8uYm9keTsKCiAgICAgICAgaWYgKHdpbmRvdy5mZWF0dXJlcy5ieXBhc3NRdWVzdGlvbnMgJiYgdXJsLmluY2x1ZGVzKCdnZXRBc3Nlc3NtZW50SXRlbScpICYmIGJvZHkpIHsKICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgb3JpZ2luYWxGZXRjaC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICBjb25zdCBjbG9uZSA9IHJlcy5jbG9uZSgpOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBjbG9uZS5qc29uKCk7CgogICAgICAgICAgICAgICAgbGV0IGl0ZW0gPSBudWxsOwogICAgICAgICAgICAgICAgaWYgKGRhdGE/LmRhdGEpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBkYXRhLmRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuZGF0YVtrZXldPy5pdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gZGF0YS5kYXRhW2tleV0uaXRlbTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghaXRlbT8uaXRlbURhdGEpIHJldHVybiByZXM7CgogICAgICAgICAgICAgICAgbGV0IGl0ZW1EYXRhID0gSlNPTi5wYXJzZShpdGVtLml0ZW1EYXRhKTsKICAgICAgICAgICAgICAgIGNvbnN0IGFuc3dlcnMgPSBbXTsKCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHddIG9mIE9iamVjdC5lbnRyaWVzKGl0ZW1EYXRhLnF1ZXN0aW9uLndpZGdldHMpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHcudHlwZSA9PT0gJ3JhZGlvJyAmJiB3Lm9wdGlvbnM/LmNob2ljZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hvaWNlcyA9IHcub3B0aW9ucy5jaG9pY2VzLm1hcCgoYywgaSkgPT4gKHsgLi4uYywgaWQ6IGMuaWQgfHwgYHJhZGlvLWNob2ljZS0ke2l9YCB9KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvcnJlY3QgPSBjaG9pY2VzLmZpbmQoYyA9PiBjLmNvcnJlY3QpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29ycmVjdCkgYW5zd2Vycy5wdXNoKHsgdHlwZTogJ3JhZGlvJywgY2hvaWNlSWQ6IGNvcnJlY3QuaWQsIHdpZGdldEtleToga2V5IH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAody50eXBlID09PSAnbnVtZXJpYy1pbnB1dCcgJiYgdy5vcHRpb25zPy5hbnN3ZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvcnJlY3QgPSB3Lm9wdGlvbnMuYW5zd2Vycy5maW5kKGEgPT4gYS5zdGF0dXMgPT09ICdjb3JyZWN0Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3JyZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWwgPSBjb3JyZWN0LmFuc3dlckZvcm1zPy5zb21lKGYgPT4gZiA9PT0gJ3Byb3BlcicgfHwgZiA9PT0gJ2ltcHJvcGVyJykgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvRnJhY3Rpb24oY29ycmVjdC52YWx1ZSkgOiBTdHJpbmcoY29ycmVjdC52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbnN3ZXJzLnB1c2goeyB0eXBlOiAnbnVtZXJpYycsIHZhbHVlOiB2YWwsIHdpZGdldEtleToga2V5IH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh3LnR5cGUgPT09ICdleHByZXNzaW9uJyAmJiB3Lm9wdGlvbnM/LmFuc3dlckZvcm1zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvcnJlY3QgPSB3Lm9wdGlvbnMuYW5zd2VyRm9ybXMuZmluZChmID0+IGYuY29uc2lkZXJlZCA9PT0gJ2NvcnJlY3QnIHx8IGYuZm9ybSA9PT0gdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3JyZWN0KSBhbnN3ZXJzLnB1c2goeyB0eXBlOiAnZXhwcmVzc2lvbicsIHZhbHVlOiBjb3JyZWN0LnZhbHVlLCB3aWRnZXRLZXk6IGtleSB9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHcudHlwZSA9PT0gJ2dyYXBoZXInICYmIHcub3B0aW9ucz8uY29ycmVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjID0gdy5vcHRpb25zLmNvcnJlY3Q7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjLnR5cGUgJiYgYy5jb29yZHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuc3dlcnMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2dyYXBoZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyYXBoVHlwZTogYy50eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb3JkczogYy5jb29yZHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXN5bXB0b3RlOiBjLmFzeW1wdG90ZSB8fCBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZGdldEtleToga2V5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoYW5zd2Vycy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29ycmVjdEFuc3dlcnMuc2V0KGl0ZW0uaWQsIGFuc3dlcnMpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChpdGVtRGF0YS5xdWVzdGlvbi5jb250ZW50Py5bMF0gPT09IGl0ZW1EYXRhLnF1ZXN0aW9uLmNvbnRlbnRbMF0udG9VcHBlckNhc2UoKSkgewogICAgICAgICAgICAgICAgICAgIGl0ZW1EYXRhLmFuc3dlckFyZWEgPSB7IGNhbGN1bGF0b3I6IGZhbHNlLCBjaGkyVGFibGU6IGZhbHNlLCBwZXJpb2RpY1RhYmxlOiBmYWxzZSwgdFRhYmxlOiBmYWxzZSwgelRhYmxlOiBmYWxzZSB9OwogICAgICAgICAgICAgICAgICAgIGl0ZW1EYXRhLnF1ZXN0aW9uLmNvbnRlbnQgPSBgW1vimIMgcmFkaW8gMV1dYDsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpdGVtRGF0YS5xdWVzdGlvbi53aWRnZXRzID0gewogICAgICAgICAgICAgICAgICAgICAgICAicmFkaW8gMSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJyYWRpbyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGlnbm1lbnQ6ICJkZWZhdWx0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRpYzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmFkZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hvaWNlczogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGNvbnRlbnQ6ICLwn42AIiwgY29ycmVjdDogdHJ1ZSwgaWQ6ICJjb3JyZWN0LWNob2ljZSIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBjb250ZW50OiAi4p2MIiwgY29ycmVjdDogZmFsc2UsIGlkOiAiaW5jb3JyZWN0LWNob2ljZSIgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZG9taXplOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdWx0aXBsZVNlbGVjdDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheUNvdW50OiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2VsZWN0RW5hYmxlZDogZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7IG1ham9yOiAxLCBtaW5vcjogMCB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2RpZmllZCA9IHsgLi4uZGF0YSB9OwoKICAgICAgICAgICAgICAgICAgICBpZiAobW9kaWZpZWQuZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBtb2RpZmllZC5kYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobW9kaWZpZWQuZGF0YVtrZXldPy5pdGVtPy5pdGVtRGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkLmRhdGFba2V5XS5pdGVtLml0ZW1EYXRhID0gSlNPTi5zdHJpbmdpZnkoaXRlbURhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KG1vZGlmaWVkKSwgewogICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHJlcy5zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c1RleHQ6IHJlcy5zdGF0dXNUZXh0LAogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiByZXMuaGVhZGVycwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBxdWVzdGlvbiBieXBhc3M6JywgZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICB9CgogICAgICAgIGlmICh3aW5kb3cuZmVhdHVyZXMuYnlwYXNzUXVlc3Rpb25zICYmIGJvZHk/LmluY2x1ZGVzKCcib3BlcmF0aW9uTmFtZSI6ImF0dGVtcHRQcm9ibGVtIicpKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBsZXQgYm9keU9iaiA9IEpTT04ucGFyc2UoYm9keSk7CiAgICAgICAgICAgICAgICBjb25zdCBpdGVtSWQgPSBib2R5T2JqLnZhcmlhYmxlcz8uaW5wdXQ/LmFzc2Vzc21lbnRJdGVtSWQ7CiAgICAgICAgICAgICAgICBjb25zdCBhbnN3ZXJzID0gY29ycmVjdEFuc3dlcnMuZ2V0KGl0ZW1JZCk7CgogICAgICAgICAgICAgICAgaWYgKGFuc3dlcnM/Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250ZW50ID0gW107CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXNlcklucHV0ID0ge307CiAgICAgICAgICAgICAgICAgICAgbGV0IHN0YXRlID0gYm9keU9iai52YXJpYWJsZXMuaW5wdXQuYXR0ZW1wdFN0YXRlID8gSlNPTi5wYXJzZShib2R5T2JqLnZhcmlhYmxlcy5pbnB1dC5hdHRlbXB0U3RhdGUpIDogbnVsbDsKCiAgICAgICAgICAgICAgICAgICAgYW5zd2Vycy5mb3JFYWNoKGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS50eXBlID09PSAncmFkaW8nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50LnB1c2goeyBzZWxlY3RlZENob2ljZUlkczogW2EuY2hvaWNlSWRdIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklucHV0W2Eud2lkZ2V0S2V5XSA9IHsgc2VsZWN0ZWRDaG9pY2VJZHM6IFthLmNob2ljZUlkXSB9OwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGEudHlwZSA9PT0gJ251bWVyaWMnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50LnB1c2goeyBjdXJyZW50VmFsdWU6IGEudmFsdWUgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VySW5wdXRbYS53aWRnZXRLZXldID0geyBjdXJyZW50VmFsdWU6IGEudmFsdWUgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZT8uW2Eud2lkZ2V0S2V5XSkgc3RhdGVbYS53aWRnZXRLZXldLmN1cnJlbnRWYWx1ZSA9IGEudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYS50eXBlID09PSAnZXhwcmVzc2lvbicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQucHVzaChhLnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJbnB1dFthLndpZGdldEtleV0gPSBhLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlPy5bYS53aWRnZXRLZXldKSBzdGF0ZVthLndpZGdldEtleV0udmFsdWUgPSBhLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGEudHlwZSA9PT0gJ2dyYXBoZXInKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBncmFwaCA9IHsgdHlwZTogYS5ncmFwaFR5cGUsIGNvb3JkczogYS5jb29yZHMsIGFzeW1wdG90ZTogYS5hc3ltcHRvdGUgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQucHVzaChncmFwaCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VySW5wdXRbYS53aWRnZXRLZXldID0gZ3JhcGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGU/LlthLndpZGdldEtleV0pIHN0YXRlW2Eud2lkZ2V0S2V5XS5wbG90ID0gZ3JhcGg7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgYm9keU9iai52YXJpYWJsZXMuaW5wdXQuYXR0ZW1wdENvbnRlbnQgPSBKU09OLnN0cmluZ2lmeShbY29udGVudCwgW11dKTsKICAgICAgICAgICAgICAgICAgICBib2R5T2JqLnZhcmlhYmxlcy5pbnB1dC51c2VySW5wdXQgPSBKU09OLnN0cmluZ2lmeSh1c2VySW5wdXQpOwogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZSkgYm9keU9iai52YXJpYWJsZXMuaW5wdXQuYXR0ZW1wdFN0YXRlID0gSlNPTi5zdHJpbmdpZnkoc3RhdGUpOwoKICAgICAgICAgICAgICAgICAgICBib2R5ID0gSlNPTi5zdHJpbmdpZnkoYm9keU9iaik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0IGluc3RhbmNlb2YgUmVxdWVzdCkgewogICAgICAgICAgICAgICAgICAgICAgICBpbnB1dCA9IG5ldyBSZXF1ZXN0KGlucHV0LCB7IGJvZHkgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5pdC5ib2R5ID0gYm9keTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFwcGx5aW5nIGFuc3dlcnM6JywgZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBvcmlnaW5hbEZldGNoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9Owp9CgpmdW5jdGlvbiBpbnRlcmNlcHRWaWRlb3MoKSB7CiAgICBjb25zdCBvcmlnaW5hbEZldGNoID0gd2luZG93LmZldGNoOwoKICAgIHdpbmRvdy5mZXRjaCA9IGFzeW5jIGZ1bmN0aW9uKGlucHV0LCBpbml0KSB7CiAgICAgICAgbGV0IGJvZHk7CiAgICAgICAgaWYgKGlucHV0IGluc3RhbmNlb2YgUmVxdWVzdCkgewogICAgICAgICAgICBib2R5ID0gYXdhaXQgaW5wdXQuY2xvbmUoKS50ZXh0KCk7CiAgICAgICAgfSBlbHNlIGlmIChpbml0ICYmIGluaXQuYm9keSkgewogICAgICAgICAgICBib2R5ID0gaW5pdC5ib2R5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHdpbmRvdy5mZWF0dXJlcy5za2lwVmlkZW9zICYmIGJvZHkgJiYgYm9keS5pbmNsdWRlcygnIm9wZXJhdGlvbk5hbWUiOiJ1cGRhdGVVc2VyVmlkZW9Qcm9ncmVzcyInKSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgbGV0IGJvZHlPYmogPSBKU09OLnBhcnNlKGJvZHkpOwogICAgICAgICAgICAgICAgaWYgKGJvZHlPYmoudmFyaWFibGVzICYmIGJvZHlPYmoudmFyaWFibGVzLmlucHV0KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHVyYXRpb25TZWNvbmRzID0gYm9keU9iai52YXJpYWJsZXMuaW5wdXQuZHVyYXRpb25TZWNvbmRzOwogICAgICAgICAgICAgICAgICAgIGJvZHlPYmoudmFyaWFibGVzLmlucHV0LnNlY29uZHNXYXRjaGVkID0gZHVyYXRpb25TZWNvbmRzOwogICAgICAgICAgICAgICAgICAgIGJvZHlPYmoudmFyaWFibGVzLmlucHV0Lmxhc3RTZWNvbmRXYXRjaGVkID0gZHVyYXRpb25TZWNvbmRzOwogICAgICAgICAgICAgICAgICAgIGJvZHkgPSBKU09OLnN0cmluZ2lmeShib2R5T2JqKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBSZXF1ZXN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0ID0gbmV3IFJlcXVlc3QoaW5wdXQsIHsgYm9keTogYm9keSB9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpbml0LmJvZHkgPSBib2R5OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gdmlkZW8gc2tpcDonLCBlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gb3JpZ2luYWxGZXRjaC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKfQoKZnVuY3Rpb24gcmV2ZWFsQW5zd2VycygpIHsKICAgIGNvbnN0IG9yaWdpbmFsUGFyc2UgPSBKU09OLnBhcnNlOwoKICAgIEpTT04ucGFyc2UgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgbGV0IGJvZHkgPSBvcmlnaW5hbFBhcnNlKGUsIHQpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChib2R5Py5kYXRhKSB7CiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhib2R5LmRhdGEpLmZvckVhY2goa2V5ID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gYm9keS5kYXRhW2tleV07CiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mZWF0dXJlcy5yZXZlYWxDb3JyZWN0ICYmIGtleSA9PT0gImFzc2Vzc21lbnRJdGVtIiAmJiBkYXRhPy5pdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1EYXRhID0gSlNPTi5wYXJzZShkYXRhLml0ZW0uaXRlbURhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbURhdGEucXVlc3Rpb24gJiYgaXRlbURhdGEucXVlc3Rpb24ud2lkZ2V0cyAmJiBpdGVtRGF0YS5xdWVzdGlvbi5jb250ZW50WzBdID09PSBpdGVtRGF0YS5xdWVzdGlvbi5jb250ZW50WzBdLnRvVXBwZXJDYXNlKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGl0ZW1EYXRhLnF1ZXN0aW9uLndpZGdldHMpLmZvckVhY2god2lkZ2V0S2V5ID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB3aWRnZXQgPSBpdGVtRGF0YS5xdWVzdGlvbi53aWRnZXRzW3dpZGdldEtleV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpZGdldC5vcHRpb25zICYmIHdpZGdldC5vcHRpb25zLmNob2ljZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkZ2V0Lm9wdGlvbnMuY2hvaWNlcy5mb3JFYWNoKGNob2ljZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hvaWNlLmNvcnJlY3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaG9pY2UuY29udGVudCA9ICLinIUgIiArIGNob2ljZS5jb250ZW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuaXRlbS5pdGVtRGF0YSA9IEpTT04uc3RyaW5naWZ5KGl0ZW1EYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciByZXZlYWxpbmcgYW5zd2VyczonLCBlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJvZHk7CiAgICB9Owp9CgpmdW5jdGlvbiBhdXRvbWF0ZUNvbXBsZXRpb24oKSB7CiAgICBjb25zdCBzZWxlY3RvcnMgPSBbCiAgICAgICAgYC5wZXJzZXVzX2htM3V1LXNxYCwKICAgICAgICBgW2RhdGEtdGVzdGlkPSJleGVyY2lzZS1jaGVjay1hbnN3ZXIiXWAsCiAgICAgICAgYFtkYXRhLXRlc3RpZD0iZXhlcmNpc2UtbmV4dC1xdWVzdGlvbiJdYCwKICAgICAgICBgLl8xd2kydG1hNGAKICAgIF07CgogICAgd2luZG93Lmdob3N0QWN0aXZlID0gdHJ1ZTsKCiAgICAoYXN5bmMgKCkgPT4gewogICAgICAgIHdoaWxlICh3aW5kb3cuZ2hvc3RBY3RpdmUpIHsKICAgICAgICAgICAgaWYgKHdpbmRvdy5mZWF0dXJlcy5pbnN0YW50Q29tcGxldGUgJiYgd2luZG93LmZlYXR1cmVzLmJ5cGFzc1F1ZXN0aW9ucykgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBzZWxlY3RvciBvZiBzZWxlY3RvcnMpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2tFbGVtZW50KHNlbGVjdG9yKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXdhaXQgd2FpdCh3aW5kb3cuZmVhdHVyZUNvbmZpZ3MuY29tcGxldGlvblNwZWVkICogODAwKTsKICAgICAgICB9CiAgICB9KSgpOwp9CgpmdW5jdGlvbiBlbmFibGVEYXJrTW9kZSgpIHsKICAgIHRyeSB7CiAgICAgICAgY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICAgICAgc2NyaXB0LnNyYyA9ICJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2RhcmtyZWFkZXJAbGF0ZXN0L2RhcmtyZWFkZXIubWluLmpzIjsKICAgICAgICBzY3JpcHQuY3Jvc3NPcmlnaW4gPSAiYW5vbnltb3VzIjsKICAgICAgICBzY3JpcHQub25sb2FkID0gKCkgPT4gewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5EYXJrUmVhZGVyICYmIHR5cGVvZiBEYXJrUmVhZGVyLnNldEZldGNoTWV0aG9kID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICAgICAgRGFya1JlYWRlci5zZXRGZXRjaE1ldGhvZCgodXJsKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3aW5kb3cuZmV0Y2godXJsLCB7IG1vZGU6ICdjb3JzJywgY3JlZGVudGlhbHM6ICdvbWl0JyB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAod2luZG93LkRhcmtSZWFkZXIgJiYgdHlwZW9mIERhcmtSZWFkZXIuZW5hYmxlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICAgICAgRGFya1JlYWRlci5lbmFibGUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoaW5uZXJFcnIpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm8gYW8gY2FycmVnYXIvYXRpdmFyIERhcmtSZWFkZXI6JywgaW5uZXJFcnIpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBzY3JpcHQub25lcnJvciA9IChlKSA9PiBjb25zb2xlLmVycm9yKCdGYWxoYSBhbyBjYXJyZWdhciBvIHNjcmlwdCBkbyBEYXJrUmVhZGVyJywgZSk7CiAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOwogICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm8gYW8gaGFiaWxpdGFyIGRhcmsgbW9kZTonLCBlKTsKICAgIH0KfQoKCmZ1bmN0aW9uIGVuYWJsZUFudGlJbnNwZWN0KCkgewogICAgdHJ5IHsKICAgICAgICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgICAgICBzY3JpcHQuc3JjID0gImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vZGV2dG9vbHMtZGV0ZWN0b3IvbGliL2RldnRvb2xzLWRldGVjdG9yLm1pbi5qcyI7CiAgICAgICAgc2NyaXB0Lm9ubG9hZCA9ICgpID0+IHsKICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICd1c2Ugc3RyaWN0JzsKCiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdzZWxlY3RzdGFydCcsIGUgPT4gewogICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBjb25zdCBzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKICAgICAgICAgICAgICAgIHMudGV4dENvbnRlbnQgPSBgCiAgICAgICAgICAgICAgICAgICAgKnsKICAgICAgICAgICAgICAgICAgICAgICAgLXdlYmtpdC11c2VyLXNlbGVjdDpub25lIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICAgICAgLW1vei11c2VyLXNlbGVjdDpub25lIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICAgICAgLW1zLXVzZXItc2VsZWN0Om5vbmUhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgICAgICAgICB1c2VyLXNlbGVjdDpub25lIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICAgICAgLXdlYmtpdC11c2VyLWRyYWc6bm9uZSFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIC1raHRtbC11c2VyLWRyYWc6bm9uZSFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIC1tb3otdXNlci1kcmFnOm5vbmUhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgICAgICAgICAtby11c2VyLWRyYWc6bm9uZSFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXItZHJhZzpub25lIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzKTsKCiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCBlID0+IHsgZS5wcmV2ZW50RGVmYXVsdCgpOyByZXR1cm4gZmFsc2U7IH0pOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIGUgPT4geyBlLnByZXZlbnREZWZhdWx0KCk7IHJldHVybiBmYWxzZTsgfSk7CgogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpbWdzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2ltZycpOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGltZyBvZiBpbWdzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGltZy5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCBlID0+IHsgZS5wcmV2ZW50RGVmYXVsdCgpOyByZXR1cm4gZmFsc2U7IH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRleHRtZW51JywgZSA9PiB7IGUucHJldmVudERlZmF1bHQoKTsgcmV0dXJuIGZhbHNlOyB9KTsKCiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICBlLmtleUNvZGUgPT09IDEyMyB8fAogICAgICAgICAgICAgICAgICAgICAgICAoZS5jdHJsS2V5ICYmIGUuc2hpZnRLZXkgJiYgKGUua2V5Q29kZSA9PT0gNzMgfHwgZS5rZXlDb2RlID09PSA3NCB8fCBlLmtleUNvZGUgPT09IDY3KSkgfHwKICAgICAgICAgICAgICAgICAgICAgICAgKGUuY3RybEtleSAmJiAoZS5rZXlDb2RlID09PSA4NSB8fCBlLmtleUNvZGUgPT09IDgzIHx8IGUua2V5Q29kZSA9PT0gODApKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAoZS5tZXRhS2V5ICYmIGUuYWx0S2V5ICYmIChlLmtleUNvZGUgPT09IDczIHx8IGUua2V5Q29kZSA9PT0gNzQgfHwgZS5rZXlDb2RlID09PSA2NykpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIChlLm1ldGFLZXkgJiYgZS5rZXlDb2RlID09PSA4NSkKICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgY29uc3QgciA9ICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB1ID0gd2luZG93LmxvY2F0aW9uLnByb3RvY29sICsgIi8vIiArIHdpbmRvdy5sb2NhdGlvbi5ob3N0OwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmICE9PSB1ICsgIi8iID8gd2luZG93LmxvY2F0aW9uLmhyZWYgPSB1ICsgIi8iIDogd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBkZXZ0b29sc0RldGVjdG9yLmFkZExpc3RlbmVyKG9wZW5lZCA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9wZW5lZCkgcigpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgZGV2dG9vbHNEZXRlY3Rvci5sYXVuY2goKTsKCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cgPSBjb25zb2xlLndhcm4gPSBjb25zb2xlLmVycm9yID0gY29uc29sZS5pbmZvID0gY29uc29sZS5kZWJ1ZyA9IGNvbnNvbGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7IH07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9KSgpOwogICAgICAgIH07CgogICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKCiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJybyBhbyBhdGl2YXIgc2NyaXB0IGFudGktaW5zcGXDp8OjbzoiLCBlKTsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gYm9vdHN0cmFwKCkgewogICAgY29uc3QgbHVjaWRlU2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICBsdWNpZGVTY3JpcHQuc3JjID0gJ2h0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vbHVjaWRlL2Rpc3QvdW1kL2x1Y2lkZS5taW4uanMnOwogICAgbHVjaWRlU2NyaXB0LmFzeW5jID0gdHJ1ZTsKICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQobHVjaWRlU2NyaXB0KTsKCiAgICBhd2FpdCB3YWl0KDUwMCk7CgogICAgY3JlYXRlSW50ZXJmYWNlKCk7CiAgICBlbmFibGVBbnRpSW5zcGVjdCgpOwogICAgaW50ZXJjZXB0UXVlc3Rpb25zKCk7CiAgICBpbnRlcmNlcHRWaWRlb3MoKTsKICAgIHJldmVhbEFuc3dlcnMoKTsKICAgIGF1dG9tYXRlQ29tcGxldGlvbigpOwogICAgZW5hYmxlRGFya01vZGUoKTsKICAgIGNsZWFudXBQYWdlKCk7CiAgICBpbml0aWFsaXplSWNvbnMoKTsKfQoKYm9vdHN0cmFwKCk7");
