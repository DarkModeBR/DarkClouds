/// ////////////////////////////////////////////
// SIM! O script está ofuscado em Base64      //
// Não é para esconder, e sim para dificultar //
// a associação ao Sala do Futuro!            //
////////////////////////////////////////////////


(function(base64Input){
    const decodedText = new TextDecoder("utf-8").decode(
        Uint8Array.from(atob(base64Input), char => char.charCodeAt(0))
    );
    eval(decodedText);
})("Y29uc3QgY29udHJvbFBhbmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CmNvbnN0IGZsb2F0aW5nQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7Cgp3aW5kb3cuZmVhdHVyZXMgPSB7CiAgICBieXBhc3NRdWVzdGlvbnM6IHRydWUsCiAgICBza2lwVmlkZW9zOiB0cnVlLAogICAgcmV2ZWFsQ29ycmVjdDogdHJ1ZSwKICAgIGluc3RhbnRDb21wbGV0ZTogZmFsc2UKfTsKCndpbmRvdy5mZWF0dXJlQ29uZmlncyA9IHsKICAgIGNvbXBsZXRpb25TcGVlZDogMwp9OwoKY29uc3QgaW5pdGlhbGl6ZUljb25zID0gKCkgPT4gewogICAgaWYgKHR5cGVvZiBsdWNpZGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgbHVjaWRlLmNyZWF0ZUljb25zKCk7CiAgICB9IGVsc2UgewogICAgICAgIHNldFRpbWVvdXQoaW5pdGlhbGl6ZUljb25zLCAxMDApOwogICAgfQp9OwoKY2xhc3MgRXZlbnRFbWl0dGVyIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHRoaXMuZXZlbnRzID0ge307CiAgICB9CiAgICBvbih0LCBlKSB7CiAgICAgICAgaWYgKHR5cGVvZiB0ID09PSAic3RyaW5nIikgdCA9IFt0XTsKICAgICAgICB0LmZvckVhY2goZXZlbnQgPT4gewogICAgICAgICAgICBpZiAoIXRoaXMuZXZlbnRzW2V2ZW50XSkgdGhpcy5ldmVudHNbZXZlbnRdID0gW107CiAgICAgICAgICAgIHRoaXMuZXZlbnRzW2V2ZW50XS5wdXNoKGUpOwogICAgICAgIH0pOwogICAgfQogICAgZW1pdCh0LCAuLi5lKSB7CiAgICAgICAgaWYgKHRoaXMuZXZlbnRzW3RdKSB7CiAgICAgICAgICAgIHRoaXMuZXZlbnRzW3RdLmZvckVhY2goY2FsbGJhY2sgPT4gY2FsbGJhY2soLi4uZSkpOwogICAgICAgIH0KICAgIH0KfQoKY29uc3QgZXZlbnRCdXMgPSBuZXcgRXZlbnRFbWl0dGVyKCk7CgpuZXcgTXV0YXRpb25PYnNlcnZlcigobXV0YXRpb25zTGlzdCkgPT4gewogICAgZm9yIChsZXQgbXV0YXRpb24gb2YgbXV0YXRpb25zTGlzdCkgewogICAgICAgIGlmIChtdXRhdGlvbi50eXBlID09PSAnY2hpbGRMaXN0JykgZXZlbnRCdXMuZW1pdCgnZG9tQ2hhbmdlZCcpOwogICAgfQp9KS5vYnNlcnZlKGRvY3VtZW50LmJvZHksIHsgY2hpbGRMaXN0OiB0cnVlLCBzdWJ0cmVlOiB0cnVlIH0pOwoKY29uc3Qgd2FpdCA9IG1zID0+IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpOwoKY29uc3QgY2xpY2tFbGVtZW50ID0gc2VsZWN0b3IgPT4gewogICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpOwogICAgaWYgKGVsZW1lbnQpIGVsZW1lbnQuY2xpY2soKTsKfTsKCmNvbnN0IHVwZGF0ZUNvbmZpZyA9IChwYXRoLCB2YWx1ZSkgPT4gewogICAgbGV0IG9iaiA9IHdpbmRvdzsKICAgIGNvbnN0IHBhcnRzID0gcGF0aC5zcGxpdCgnLicpOwogICAgd2hpbGUgKHBhcnRzLmxlbmd0aCA+IDEpIG9iaiA9IG9ialtwYXJ0cy5zaGlmdCgpXTsKICAgIG9ialtwYXJ0c1swXV0gPSB2YWx1ZTsKfTsKCmZ1bmN0aW9uIGNsZWFudXBQYWdlKCkgewogICAgY29uc3QgcmVtb3ZlU2VsZWN0b3JzID0gWwogICAgICAgICdmb290ZXIuXzRzanV6dicsCiAgICAgICAgJ2Rpdi5fMWNwOWN4cGsnLAogICAgICAgICdkaXYuX2g4dHBvbScsCiAgICAgICAgJ2Rpdi5fMTR3bXF1MWInLAogICAgICAgICdkaXYuXzgzMTFjY2InLAogICAgICAgICdkaXYudXNlci1pbmZvLWFsbCcsCiAgICAgICAgJ2Rpdi51c2VyLWluZm8uY2xlYXJmaXgnLAogICAgICAgICdbZGF0YS1zbHVnPSJ0b3BpYy1wcm9ncmVzcyJdJwogICAgXTsKICAgIAogICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigoKSA9PiB7CiAgICAgICAgcmVtb3ZlU2VsZWN0b3JzLmZvckVhY2goc2VsZWN0b3IgPT4gewogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKS5mb3JFYWNoKGVsID0+IGVsLnJlbW92ZSgpKTsKICAgICAgICB9KTsKICAgIH0pOwogICAgCiAgICBvYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmJvZHksIHsgY2hpbGRMaXN0OiB0cnVlLCBzdWJ0cmVlOiB0cnVlIH0pOwogICAgCiAgICByZW1vdmVTZWxlY3RvcnMuZm9yRWFjaChzZWxlY3RvciA9PiB7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikuZm9yRWFjaChlbCA9PiBlbC5yZW1vdmUoKSk7CiAgICB9KTsKfQoKZnVuY3Rpb24gY3JlYXRlSW50ZXJmYWNlKCkgewogICAgT2JqZWN0LmFzc2lnbihmbG9hdGluZ0J1dHRvbi5zdHlsZSwgewogICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLAogICAgICAgIHRvcDogJzIwcHgnLAogICAgICAgIHJpZ2h0OiAnMjBweCcsCiAgICAgICAgd2lkdGg6ICc2MHB4JywKICAgICAgICBoZWlnaHQ6ICc2MHB4JywKICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjMGEwYTBhJywKICAgICAgICBib3JkZXI6ICcycHggc29saWQgIzFhMWExYScsCiAgICAgICAgY29sb3I6ICcjZmZmJywKICAgICAgICBmb250U2l6ZTogJzI0cHgnLAogICAgICAgIGRpc3BsYXk6ICdmbGV4JywKICAgICAgICBqdXN0aWZ5Q29udGVudDogJ2NlbnRlcicsCiAgICAgICAgYWxpZ25JdGVtczogJ2NlbnRlcicsCiAgICAgICAgY3Vyc29yOiAncG9pbnRlcicsCiAgICAgICAgdXNlclNlbGVjdDogJ25vbmUnLAogICAgICAgIGJvcmRlclJhZGl1czogJzE2cHgnLAogICAgICAgIHpJbmRleDogJzEwMDAxJywKICAgICAgICB0cmFuc2l0aW9uOiAnYWxsIDAuM3MgY3ViaWMtYmV6aWVyKDAuNCwgMCwgMC4yLCAxKScsCiAgICAgICAgYmFja2Ryb3BGaWx0ZXI6ICdibHVyKDEwcHgpJywKICAgICAgICBXZWJraXRCYWNrZHJvcEZpbHRlcjogJ2JsdXIoMTBweCknCiAgICB9KTsKCiAgICBmbG9hdGluZ0J1dHRvbi5pbm5lckhUTUwgPSBgPGkgZGF0YS1sdWNpZGU9Imdob3N0IiBzdHlsZT0id2lkdGg6IDMycHg7IGhlaWdodDogMzJweDsgY29sb3I6ICM4YjVjZjY7Ij48L2k+YDsKCiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZsb2F0aW5nQnV0dG9uKTsKCiAgICBPYmplY3QuYXNzaWduKGNvbnRyb2xQYW5lbC5zdHlsZSwgewogICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgIHRvcDogJ2NhbGMoMTAwJSArIDEwcHgpJywKICAgICAgICByaWdodDogJzAnLAogICAgICAgIHdpZHRoOiAnMjgwcHgnLAogICAgICAgIG1heFdpZHRoOiAnOTB2dycsCiAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzBhMGEwYScsCiAgICAgICAgYm9yZGVyOiAnMnB4IHNvbGlkICMxYTFhMWEnLAogICAgICAgIGJvcmRlclJhZGl1czogJzE2cHgnLAogICAgICAgIGNvbG9yOiAnI2ZmZicsCiAgICAgICAgZm9udFNpemU6ICcxNHB4JywKICAgICAgICBmb250RmFtaWx5OiAnLWFwcGxlLXN5c3RlbSwgQmxpbmtNYWNTeXN0ZW1Gb250LCAiU2Vnb2UgVUkiLCBSb2JvdG8sIHNhbnMtc2VyaWYnLAogICAgICAgIGRpc3BsYXk6ICdub25lJywKICAgICAgICBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJywKICAgICAgICB6SW5kZXg6ICcxMDAwMCcsCiAgICAgICAgcGFkZGluZzogJzE2cHgnLAogICAgICAgIGN1cnNvcjogJ2RlZmF1bHQnLAogICAgICAgIHVzZXJTZWxlY3Q6ICdub25lJywKICAgICAgICB0cmFuc2l0aW9uOiAnYWxsIDAuM3MgY3ViaWMtYmV6aWVyKDAuNCwgMCwgMC4yLCAxKScsCiAgICAgICAgYmFja2Ryb3BGaWx0ZXI6ICdibHVyKDIwcHgpJywKICAgICAgICBXZWJraXRCYWNrZHJvcEZpbHRlcjogJ2JsdXIoMjBweCknLAogICAgICAgIG9wYWNpdHk6ICcwJwogICAgfSk7CgogICAgY29udHJvbFBhbmVsLmlubmVySFRNTCA9IGAKICAgICAgICA8c3R5bGU+CiAgICAgICAgICAgIEBtZWRpYSAobWF4LXdpZHRoOiA3NjhweCkgewogICAgICAgICAgICAgICAgI2toYW5HaG9zdFBhbmVsIHsKICAgICAgICAgICAgICAgICAgICB3aWR0aDogMjYwcHggIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAxMnB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgZm9udC1zaXplOiAxM3B4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICNraGFuR2hvc3RCdXR0b24gewogICAgICAgICAgICAgICAgICAgIHdpZHRoOiA1MHB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA1MHB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC5naG9zdC1mZWF0dXJlLXRleHQgewogICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTNweCAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBAa2V5ZnJhbWVzIGdob3N0U2xpZGVJbiB7CiAgICAgICAgICAgICAgICBmcm9tIHsKICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwOwogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMTBweCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0byB7CiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMTsKICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1oZWFkZXIgewogICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgICAgIGdhcDogMTJweDsKICAgICAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOiAxNnB4OwogICAgICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMnB4IHNvbGlkICMxYTFhMWE7CiAgICAgICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxNnB4OwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3QtaGVhZGVyIGkgewogICAgICAgICAgICAgICAgd2lkdGg6IDI0cHg7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDI0cHg7CiAgICAgICAgICAgICAgICBjb2xvcjogIzhiNWNmNjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LXRpdGxlIHsKICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMThweDsKICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7CiAgICAgICAgICAgICAgICBjb2xvcjogI2ZmZjsKICAgICAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiAwLjVweDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LXN3aXRjaCB7CiAgICAgICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgICAgICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICAgICAgICAgICAgICB3aWR0aDogNDhweDsKICAgICAgICAgICAgICAgIGhlaWdodDogMjRweDsKICAgICAgICAgICAgICAgIGZsZXgtc2hyaW5rOiAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3Qtc3dpdGNoIGlucHV0IHsKICAgICAgICAgICAgICAgIG9wYWNpdHk6IDA7CiAgICAgICAgICAgICAgICB3aWR0aDogMDsKICAgICAgICAgICAgICAgIGhlaWdodDogMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LXNsaWRlciB7CiAgICAgICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgICAgICB0b3A6IDA7CiAgICAgICAgICAgICAgICBsZWZ0OiAwOwogICAgICAgICAgICAgICAgcmlnaHQ6IDA7CiAgICAgICAgICAgICAgICBib3R0b206IDA7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMWExYTFhOwogICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogMC4zczsKICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDI0cHg7CiAgICAgICAgICAgICAgICBib3JkZXI6IDJweCBzb2xpZCAjMmEyYTJhOwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3Qtc2xpZGVyOmJlZm9yZSB7CiAgICAgICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgICAgICAgICBjb250ZW50OiAiIjsKICAgICAgICAgICAgICAgIGhlaWdodDogMTZweDsKICAgICAgICAgICAgICAgIHdpZHRoOiAxNnB4OwogICAgICAgICAgICAgICAgbGVmdDogMnB4OwogICAgICAgICAgICAgICAgYm90dG9tOiAycHg7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjNDQ0OwogICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogMC4zczsKICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW5wdXQ6Y2hlY2tlZCArIC5naG9zdC1zbGlkZXIgewogICAgICAgICAgICAgICAgYmFja2dyb3VuZDogIzI4QTc0NTsKICAgICAgICAgICAgICAgIGJvcmRlci1jb2xvcjogIzI4QTc0NTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW5wdXQ6Y2hlY2tlZCArIC5naG9zdC1zbGlkZXI6YmVmb3JlIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgyNHB4KTsKICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmZmY7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1mZWF0dXJlLWl0ZW0gewogICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICAgICAgICAgICAgICBwYWRkaW5nOiAxNHB4IDA7CiAgICAgICAgICAgICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgIzFhMWExYTsKICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogZ2hvc3RTbGlkZUluIDAuM3MgZWFzZS1vdXQ7CiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3QtZmVhdHVyZS1pdGVtOmhvdmVyIHsKICAgICAgICAgICAgICAgIHBhZGRpbmctbGVmdDogOHB4OwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3QtZmVhdHVyZS1pdGVtOmxhc3QtY2hpbGQgewogICAgICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogbm9uZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LWZlYXR1cmUtbGFiZWwgewogICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgICAgICBnYXA6IDEycHg7CiAgICAgICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgICAgICBmbGV4LWdyb3c6IDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1mZWF0dXJlLWxhYmVsIGkgewogICAgICAgICAgICAgICAgd2lkdGg6IDIwcHg7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDIwcHg7CiAgICAgICAgICAgICAgICBjb2xvcjogIzhiNWNmNjsKICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAwLjJzIGVhc2U7CiAgICAgICAgICAgICAgICBmbGV4LXNocmluazogMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LWZlYXR1cmUtaXRlbTpob3ZlciAuZ2hvc3QtZmVhdHVyZS1sYWJlbCBpIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogc2NhbGUoMS4xKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LWZlYXR1cmUtdGV4dCB7CiAgICAgICAgICAgICAgICBmb250LXNpemU6IDE0cHg7CiAgICAgICAgICAgICAgICBjb2xvcjogI2UwZTBlMDsKICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA1MDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1zbGlkZXItY29udGFpbmVyIHsKICAgICAgICAgICAgICAgIHBhZGRpbmc6IDE0cHggMDsKICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogZ2hvc3RTbGlkZUluIDAuM3MgZWFzZS1vdXQ7CiAgICAgICAgICAgICAgICBhbmltYXRpb24tZGVsYXk6IDAuMXM7CiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwOwogICAgICAgICAgICAgICAgYW5pbWF0aW9uLWZpbGwtbW9kZTogZm9yd2FyZHM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1zbGlkZXItbGFiZWwgewogICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgICAgICBnYXA6IDhweDsKICAgICAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDEycHg7CiAgICAgICAgICAgICAgICBjb2xvcjogI2EwYTBhMDsKICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgICAgICAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgICAgICAgICAgICAgbGV0dGVyLXNwYWNpbmc6IDAuNXB4OwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3Qtc2xpZGVyLWxhYmVsIGkgewogICAgICAgICAgICAgICAgd2lkdGg6IDE2cHg7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDE2cHg7CiAgICAgICAgICAgICAgICBjb2xvcjogIzYzNjZmMTsKICAgICAgICAgICAgICAgIGZsZXgtc2hyaW5rOiAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpbnB1dFt0eXBlPSJyYW5nZSJdIHsKICAgICAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICAgICAgaGVpZ2h0OiA2cHg7CiAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiAzcHg7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gcmlnaHQsICM4YjVjZjYgMCUsICM2MzY2ZjEgMTAwJSk7CiAgICAgICAgICAgICAgICBvdXRsaW5lOiBub25lOwogICAgICAgICAgICAgICAgb3BhY2l0eTogMC45OwogICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogb3BhY2l0eSAwLjJzOwogICAgICAgICAgICAgICAgLXdlYmtpdC1hcHBlYXJhbmNlOiBub25lOwogICAgICAgICAgICAgICAgYXBwZWFyYW5jZTogbm9uZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW5wdXRbdHlwZT0icmFuZ2UiXTpob3ZlciB7CiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpbnB1dFt0eXBlPSJyYW5nZSJdOjotd2Via2l0LXNsaWRlci10aHVtYiB7CiAgICAgICAgICAgICAgICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmU7CiAgICAgICAgICAgICAgICBhcHBlYXJhbmNlOiBub25lOwogICAgICAgICAgICAgICAgd2lkdGg6IDE4cHg7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDE4cHg7CiAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZmZmOwogICAgICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW5wdXRbdHlwZT0icmFuZ2UiXTo6LXdlYmtpdC1zbGlkZXItdGh1bWI6aG92ZXIgewogICAgICAgICAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxLjIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpbnB1dFt0eXBlPSJyYW5nZSJdOjotbW96LXJhbmdlLXRodW1iIHsKICAgICAgICAgICAgICAgIHdpZHRoOiAxOHB4OwogICAgICAgICAgICAgICAgaGVpZ2h0OiAxOHB4OwogICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgICAgICAgICAgICAgYmFja2dyb3VuZDogI2ZmZjsKICAgICAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlucHV0W3R5cGU9InJhbmdlIl06Oi1tb3otcmFuZ2UtdGh1bWI6aG92ZXIgewogICAgICAgICAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxLjIpOwogICAgICAgICAgICB9CiAgICAgICAgPC9zdHlsZT4KICAgICAgICA8ZGl2IGNsYXNzPSJnaG9zdC1oZWFkZXIiPgogICAgICAgICAgICA8c3BhbiBjbGFzcz0iZ2hvc3QtdGl0bGUiPktoYW5HaG9zdDwvc3Bhbj4KICAgICAgICA8L2Rpdj4KICAgIGA7CgogICAgZmxvYXRpbmdCdXR0b24uaWQgPSAna2hhbkdob3N0QnV0dG9uJzsKICAgIGNvbnRyb2xQYW5lbC5pZCA9ICdraGFuR2hvc3RQYW5lbCc7CgogICAgZmxvYXRpbmdCdXR0b24uYXBwZW5kQ2hpbGQoY29udHJvbFBhbmVsKTsKCiAgICBjb25zdCBmZWF0dXJlcyA9IFsKICAgICAgICB7IGlkOiAnYnlwYXNzUXVlc3Rpb25zJywgaWNvbjogJ2ZpbGUtcXVlc3Rpb24nLCBsYWJlbDogJ0J5cGFzcyBRdWVzdGlvbnMnLCB2YXJpYWJsZTogJ2ZlYXR1cmVzLmJ5cGFzc1F1ZXN0aW9ucycsIGNoZWNrZWQ6IHRydWUgfSwKICAgICAgICB7IGlkOiAnc2tpcFZpZGVvcycsIGljb246ICd2aWRlbycsIGxhYmVsOiAnU2tpcCBWaWRlb3MnLCB2YXJpYWJsZTogJ2ZlYXR1cmVzLnNraXBWaWRlb3MnLCBjaGVja2VkOiB0cnVlIH0sCiAgICAgICAgeyBpZDogJ3JldmVhbENvcnJlY3QnLCBpY29uOiAnZXllJywgbGFiZWw6ICdSZXZlYWwgQ29ycmVjdCcsIHZhcmlhYmxlOiAnZmVhdHVyZXMucmV2ZWFsQ29ycmVjdCcsIGNoZWNrZWQ6IHRydWUgfSwKICAgICAgICB7IGlkOiAnaW5zdGFudENvbXBsZXRlJywgaWNvbjogJ3phcCcsIGxhYmVsOiAnSW5zdGFudCBDb21wbGV0ZScsIHZhcmlhYmxlOiAnZmVhdHVyZXMuaW5zdGFudENvbXBsZXRlJywgY2hlY2tlZDogZmFsc2UsIGRlcGVuZGVudDogJ3NwZWVkQ29udHJvbCcgfQogICAgXTsKCiAgICBmZWF0dXJlcy5mb3JFYWNoKGZlYXR1cmUgPT4gewogICAgICAgIGNvbnN0IGZlYXR1cmVEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBmZWF0dXJlRGl2LmNsYXNzTmFtZSA9ICdnaG9zdC1mZWF0dXJlLWl0ZW0nOwogICAgICAgIGZlYXR1cmVEaXYuaW5uZXJIVE1MID0gYAogICAgICAgICAgICA8bGFiZWwgY2xhc3M9Imdob3N0LWZlYXR1cmUtbGFiZWwiPgogICAgICAgICAgICAgICAgPGkgZGF0YS1sdWNpZGU9IiR7ZmVhdHVyZS5pY29ufSI+PC9pPgogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Imdob3N0LWZlYXR1cmUtdGV4dCI+JHtmZWF0dXJlLmxhYmVsfTwvc3Bhbj4KICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJnaG9zdC1zd2l0Y2giPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0iJHtmZWF0dXJlLmlkfSIgJHtmZWF0dXJlLmNoZWNrZWQgPyAnY2hlY2tlZCcgOiAnJ30+CiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZ2hvc3Qtc2xpZGVyIj48L3NwYW4+CiAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgYDsKICAgICAgICBjb250cm9sUGFuZWwuYXBwZW5kQ2hpbGQoZmVhdHVyZURpdik7CgogICAgICAgIGNvbnN0IGNoZWNrYm94ID0gZmVhdHVyZURpdi5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpOwogICAgICAgIGNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7CiAgICAgICAgICAgIHVwZGF0ZUNvbmZpZyhmZWF0dXJlLnZhcmlhYmxlLCBlLnRhcmdldC5jaGVja2VkKTsKICAgICAgICAgICAgaWYgKGZlYXR1cmUuZGVwZW5kZW50KSB7CiAgICAgICAgICAgICAgICBjb25zdCBkZXBlbmRlbnRFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZlYXR1cmUuZGVwZW5kZW50KTsKICAgICAgICAgICAgICAgIGlmIChkZXBlbmRlbnRFbCkgewogICAgICAgICAgICAgICAgICAgIGRlcGVuZGVudEVsLnN0eWxlLmRpc3BsYXkgPSBlLnRhcmdldC5jaGVja2VkID8gJ2Jsb2NrJyA6ICdub25lJzsKICAgICAgICAgICAgICAgICAgICBkZXBlbmRlbnRFbC5zdHlsZS5vcGFjaXR5ID0gZS50YXJnZXQuY2hlY2tlZCA/ICcxJyA6ICcwJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZmVhdHVyZS5pZCA9PT0gJ2luc3RhbnRDb21wbGV0ZScgJiYgZS50YXJnZXQuY2hlY2tlZCAmJiAhd2luZG93LmZlYXR1cmVzLmJ5cGFzc1F1ZXN0aW9ucykgewogICAgICAgICAgICAgICAgY29uc3QgYnlwYXNzQ2hlY2tib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnlwYXNzUXVlc3Rpb25zJyk7CiAgICAgICAgICAgICAgICBpZiAoYnlwYXNzQ2hlY2tib3gpIHsKICAgICAgICAgICAgICAgICAgICBieXBhc3NDaGVja2JveC5jaGVja2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmVhdHVyZXMuYnlwYXNzUXVlc3Rpb25zID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSk7CgogICAgY29uc3Qgc2xpZGVyQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBzbGlkZXJDb250YWluZXIuY2xhc3NOYW1lID0gJ2dob3N0LXNsaWRlci1jb250YWluZXInOwogICAgc2xpZGVyQ29udGFpbmVyLmlkID0gJ3NwZWVkQ29udHJvbCc7CiAgICBzbGlkZXJDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIHNsaWRlckNvbnRhaW5lci5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0iZ2hvc3Qtc2xpZGVyLWxhYmVsIj4KICAgICAgICAgICAgPGkgZGF0YS1sdWNpZGU9InRpbWVyIj48L2k+CiAgICAgICAgICAgIDxzcGFuPkNvbXBsZXRpb24gU3BlZWQ8L3NwYW4+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGlucHV0IHR5cGU9InJhbmdlIiBtaW49IjEiIG1heD0iMyIgdmFsdWU9IjEiIGlkPSJzcGVlZFNsaWRlciI+CiAgICBgOwogICAgY29udHJvbFBhbmVsLmFwcGVuZENoaWxkKHNsaWRlckNvbnRhaW5lcik7CgogICAgY29uc3Qgc3BlZWRTbGlkZXIgPSBzbGlkZXJDb250YWluZXIucXVlcnlTZWxlY3RvcignaW5wdXQnKTsKICAgIHNwZWVkU2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKGUpID0+IHsKICAgICAgICB3aW5kb3cuZmVhdHVyZUNvbmZpZ3MuY29tcGxldGlvblNwZWVkID0gNCAtIGUudGFyZ2V0LnZhbHVlOwogICAgfSk7CgogICAgbGV0IG1lbnVPcGVuID0gZmFsc2U7CgogICAgZnVuY3Rpb24gb3Blbk1lbnUoKSB7CiAgICAgICAgY29udHJvbFBhbmVsLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiBjb250cm9sUGFuZWwuc3R5bGUub3BhY2l0eSA9ICcxJywgMTApOwogICAgICAgIG1lbnVPcGVuID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBjbG9zZU1lbnUoKSB7CiAgICAgICAgY29udHJvbFBhbmVsLnN0eWxlLm9wYWNpdHkgPSAnMCc7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiBjb250cm9sUGFuZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJywgMzAwKTsKICAgICAgICBtZW51T3BlbiA9IGZhbHNlOwogICAgfQoKICAgIGZsb2F0aW5nQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGlmIChtZW51T3BlbikgewogICAgICAgICAgICBjbG9zZU1lbnUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBvcGVuTWVudSgpOwogICAgICAgIH0KICAgIH0pOwoKICAgIGNvbnRyb2xQYW5lbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIH0pOwp9Cgpjb25zdCBjb3JyZWN0QW5zd2VycyA9IG5ldyBNYXAoKTsKCmNvbnN0IHRvRnJhY3Rpb24gPSAoZCkgPT4gewogICAgaWYgKGQgPT09IDAgfHwgZCA9PT0gMSkgcmV0dXJuIFN0cmluZyhkKTsKICAgIGNvbnN0IGRlY2ltYWxzID0gKFN0cmluZyhkKS5zcGxpdCgnLicpWzFdIHx8ICcnKS5sZW5ndGg7CiAgICBsZXQgbnVtID0gTWF0aC5yb3VuZChkICogTWF0aC5wb3coMTAsIGRlY2ltYWxzKSk7CiAgICBsZXQgZGVuID0gTWF0aC5wb3coMTAsIGRlY2ltYWxzKTsKICAgIGNvbnN0IGdjZCA9IChhLCBiKSA9PiB7CiAgICAgICAgd2hpbGUgKGIpIHsKICAgICAgICAgICAgW2EsIGJdID0gW2IsIGEgJSBiXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGE7CiAgICB9OwogICAgY29uc3QgZGl2ID0gZ2NkKE1hdGguYWJzKG51bSksIE1hdGguYWJzKGRlbikpOwogICAgcmV0dXJuIGRlbiAvIGRpdiA9PT0gMSA/IFN0cmluZyhudW0gLyBkaXYpIDogYCR7bnVtIC8gZGl2fS8ke2RlbiAvIGRpdn1gOwp9OwoKZnVuY3Rpb24gaW50ZXJjZXB0UXVlc3Rpb25zKCkgewogICAgY29uc3Qgb3JpZ2luYWxGZXRjaCA9IHdpbmRvdy5mZXRjaDsKCiAgICB3aW5kb3cuZmV0Y2ggPSBhc3luYyBmdW5jdGlvbihpbnB1dCwgaW5pdCkgewogICAgICAgIGNvbnN0IHVybCA9IGlucHV0IGluc3RhbmNlb2YgUmVxdWVzdCA/IGlucHV0LnVybCA6IGlucHV0OwogICAgICAgIGxldCBib2R5ID0gaW5wdXQgaW5zdGFuY2VvZiBSZXF1ZXN0ID8gYXdhaXQgaW5wdXQuY2xvbmUoKS50ZXh0KCkgOiBpbml0Py5ib2R5OwoKICAgICAgICBpZiAod2luZG93LmZlYXR1cmVzLmJ5cGFzc1F1ZXN0aW9ucyAmJiB1cmwuaW5jbHVkZXMoJ2dldEFzc2Vzc21lbnRJdGVtJykgJiYgYm9keSkgewogICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBvcmlnaW5hbEZldGNoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIGNvbnN0IGNsb25lID0gcmVzLmNsb25lKCk7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGNsb25lLmpzb24oKTsKCiAgICAgICAgICAgICAgICBsZXQgaXRlbSA9IG51bGw7CiAgICAgICAgICAgICAgICBpZiAoZGF0YT8uZGF0YSkgewogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIGRhdGEuZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5kYXRhW2tleV0/Lml0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0gPSBkYXRhLmRhdGFba2V5XS5pdGVtOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCFpdGVtPy5pdGVtRGF0YSkgcmV0dXJuIHJlczsKCiAgICAgICAgICAgICAgICBsZXQgaXRlbURhdGEgPSBKU09OLnBhcnNlKGl0ZW0uaXRlbURhdGEpOwogICAgICAgICAgICAgICAgY29uc3QgYW5zd2VycyA9IFtdOwoKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgd10gb2YgT2JqZWN0LmVudHJpZXMoaXRlbURhdGEucXVlc3Rpb24ud2lkZ2V0cykpIHsKICAgICAgICAgICAgICAgICAgICBpZiAody50eXBlID09PSAncmFkaW8nICYmIHcub3B0aW9ucz8uY2hvaWNlcykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaG9pY2VzID0gdy5vcHRpb25zLmNob2ljZXMubWFwKChjLCBpKSA9PiAoeyAuLi5jLCBpZDogYy5pZCB8fCBgcmFkaW8tY2hvaWNlLSR7aX1gIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29ycmVjdCA9IGNob2ljZXMuZmluZChjID0+IGMuY29ycmVjdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3JyZWN0KSBhbnN3ZXJzLnB1c2goeyB0eXBlOiAncmFkaW8nLCBjaG9pY2VJZDogY29ycmVjdC5pZCwgd2lkZ2V0S2V5OiBrZXkgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh3LnR5cGUgPT09ICdudW1lcmljLWlucHV0JyAmJiB3Lm9wdGlvbnM/LmFuc3dlcnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29ycmVjdCA9IHcub3B0aW9ucy5hbnN3ZXJzLmZpbmQoYSA9PiBhLnN0YXR1cyA9PT0gJ2NvcnJlY3QnKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvcnJlY3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbCA9IGNvcnJlY3QuYW5zd2VyRm9ybXM/LnNvbWUoZiA9PiBmID09PSAncHJvcGVyJyB8fCBmID09PSAnaW1wcm9wZXInKSA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9GcmFjdGlvbihjb3JyZWN0LnZhbHVlKSA6IFN0cmluZyhjb3JyZWN0LnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuc3dlcnMucHVzaCh7IHR5cGU6ICdudW1lcmljJywgdmFsdWU6IHZhbCwgd2lkZ2V0S2V5OiBrZXkgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHcudHlwZSA9PT0gJ2V4cHJlc3Npb24nICYmIHcub3B0aW9ucz8uYW5zd2VyRm9ybXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29ycmVjdCA9IHcub3B0aW9ucy5hbnN3ZXJGb3Jtcy5maW5kKGYgPT4gZi5jb25zaWRlcmVkID09PSAnY29ycmVjdCcgfHwgZi5mb3JtID09PSB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvcnJlY3QpIGFuc3dlcnMucHVzaCh7IHR5cGU6ICdleHByZXNzaW9uJywgdmFsdWU6IGNvcnJlY3QudmFsdWUsIHdpZGdldEtleToga2V5IH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAody50eXBlID09PSAnZ3JhcGhlcicgJiYgdy5vcHRpb25zPy5jb3JyZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGMgPSB3Lm9wdGlvbnMuY29ycmVjdDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMudHlwZSAmJiBjLmNvb3JkcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5zd2Vycy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZ3JhcGhlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JhcGhUeXBlOiBjLnR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29vcmRzOiBjLmNvb3JkcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3ltcHRvdGU6IGMuYXN5bXB0b3RlIHx8IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkZ2V0S2V5OiBrZXkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChhbnN3ZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBjb3JyZWN0QW5zd2Vycy5zZXQoaXRlbS5pZCwgYW5zd2Vycyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGl0ZW1EYXRhLnF1ZXN0aW9uLmNvbnRlbnQ/LlswXSA9PT0gaXRlbURhdGEucXVlc3Rpb24uY29udGVudFswXS50b1VwcGVyQ2FzZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbURhdGEuYW5zd2VyQXJlYSA9IHsgY2FsY3VsYXRvcjogZmFsc2UsIGNoaTJUYWJsZTogZmFsc2UsIHBlcmlvZGljVGFibGU6IGZhbHNlLCB0VGFibGU6IGZhbHNlLCB6VGFibGU6IGZhbHNlIH07CiAgICAgICAgICAgICAgICAgICAgaXRlbURhdGEucXVlc3Rpb24uY29udGVudCA9IGBbW+KYgyByYWRpbyAxXV1gOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1EYXRhLnF1ZXN0aW9uLndpZGdldHMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICJyYWRpbyAxIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogInJhZGlvIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsaWdubWVudDogImRlZmF1bHQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGljOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyYWRlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaG9pY2VzOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgY29udGVudDogIvCfjYAiLCBjb3JyZWN0OiB0cnVlLCBpZDogImNvcnJlY3QtY2hvaWNlIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGNvbnRlbnQ6ICLinYwiLCBjb3JyZWN0OiBmYWxzZSwgaWQ6ICJpbmNvcnJlY3QtY2hvaWNlIiB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5kb21pemU6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpcGxlU2VsZWN0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5Q291bnQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzZWxlY3RFbmFibGVkOiBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcnNpb246IHsgbWFqb3I6IDEsIG1pbm9yOiAwIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1vZGlmaWVkID0geyAuLi5kYXRhIH07CgogICAgICAgICAgICAgICAgICAgIGlmIChtb2RpZmllZC5kYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIG1vZGlmaWVkLmRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb2RpZmllZC5kYXRhW2tleV0/Lml0ZW0/Lml0ZW1EYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWQuZGF0YVtrZXldLml0ZW0uaXRlbURhdGEgPSBKU09OLnN0cmluZ2lmeShpdGVtRGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkobW9kaWZpZWQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogcmVzLnN0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogcmVzLnN0YXR1c1RleHQsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHJlcy5oZWFkZXJzCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHF1ZXN0aW9uIGJ5cGFzczonLCBlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdpbmRvdy5mZWF0dXJlcy5ieXBhc3NRdWVzdGlvbnMgJiYgYm9keT8uaW5jbHVkZXMoJyJvcGVyYXRpb25OYW1lIjoiYXR0ZW1wdFByb2JsZW0iJykpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGxldCBib2R5T2JqID0gSlNPTi5wYXJzZShib2R5KTsKICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1JZCA9IGJvZHlPYmoudmFyaWFibGVzPy5pbnB1dD8uYXNzZXNzbWVudEl0ZW1JZDsKICAgICAgICAgICAgICAgIGNvbnN0IGFuc3dlcnMgPSBjb3JyZWN0QW5zd2Vycy5nZXQoaXRlbUlkKTsKCiAgICAgICAgICAgICAgICBpZiAoYW5zd2Vycz8ubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBbXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB1c2VySW5wdXQgPSB7fTsKICAgICAgICAgICAgICAgICAgICBsZXQgc3RhdGUgPSBib2R5T2JqLnZhcmlhYmxlcy5pbnB1dC5hdHRlbXB0U3RhdGUgPyBKU09OLnBhcnNlKGJvZHlPYmoudmFyaWFibGVzLmlucHV0LmF0dGVtcHRTdGF0ZSkgOiBudWxsOwoKICAgICAgICAgICAgICAgICAgICBhbnN3ZXJzLmZvckVhY2goYSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLnR5cGUgPT09ICdyYWRpbycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQucHVzaCh7IHNlbGVjdGVkQ2hvaWNlSWRzOiBbYS5jaG9pY2VJZF0gfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VySW5wdXRbYS53aWRnZXRLZXldID0geyBzZWxlY3RlZENob2ljZUlkczogW2EuY2hvaWNlSWRdIH07CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYS50eXBlID09PSAnbnVtZXJpYycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQucHVzaCh7IGN1cnJlbnRWYWx1ZTogYS52YWx1ZSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJbnB1dFthLndpZGdldEtleV0gPSB7IGN1cnJlbnRWYWx1ZTogYS52YWx1ZSB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlPy5bYS53aWRnZXRLZXldKSBzdGF0ZVthLndpZGdldEtleV0uY3VycmVudFZhbHVlID0gYS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhLnR5cGUgPT09ICdleHByZXNzaW9uJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudC5wdXNoKGEudmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklucHV0W2Eud2lkZ2V0S2V5XSA9IGEudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGU/LlthLndpZGdldEtleV0pIHN0YXRlW2Eud2lkZ2V0S2V5XS52YWx1ZSA9IGEudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYS50eXBlID09PSAnZ3JhcGhlcicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGdyYXBoID0geyB0eXBlOiBhLmdyYXBoVHlwZSwgY29vcmRzOiBhLmNvb3JkcywgYXN5bXB0b3RlOiBhLmFzeW1wdG90ZSB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudC5wdXNoKGdyYXBoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJbnB1dFthLndpZGdldEtleV0gPSBncmFwaDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZT8uW2Eud2lkZ2V0S2V5XSkgc3RhdGVbYS53aWRnZXRLZXldLnBsb3QgPSBncmFwaDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBib2R5T2JqLnZhcmlhYmxlcy5pbnB1dC5hdHRlbXB0Q29udGVudCA9IEpTT04uc3RyaW5naWZ5KFtjb250ZW50LCBbXV0pOwogICAgICAgICAgICAgICAgICAgIGJvZHlPYmoudmFyaWFibGVzLmlucHV0LnVzZXJJbnB1dCA9IEpTT04uc3RyaW5naWZ5KHVzZXJJbnB1dCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlKSBib2R5T2JqLnZhcmlhYmxlcy5pbnB1dC5hdHRlbXB0U3RhdGUgPSBKU09OLnN0cmluZ2lmeShzdGF0ZSk7CgogICAgICAgICAgICAgICAgICAgIGJvZHkgPSBKU09OLnN0cmluZ2lmeShib2R5T2JqKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBSZXF1ZXN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0ID0gbmV3IFJlcXVlc3QoaW5wdXQsIHsgYm9keSB9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpbml0LmJvZHkgPSBib2R5OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYXBwbHlpbmcgYW5zd2VyczonLCBlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG9yaWdpbmFsRmV0Y2guYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07Cn0KCmZ1bmN0aW9uIGludGVyY2VwdFZpZGVvcygpIHsKICAgIGNvbnN0IG9yaWdpbmFsRmV0Y2ggPSB3aW5kb3cuZmV0Y2g7CgogICAgd2luZG93LmZldGNoID0gYXN5bmMgZnVuY3Rpb24oaW5wdXQsIGluaXQpIHsKICAgICAgICBsZXQgYm9keTsKICAgICAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBSZXF1ZXN0KSB7CiAgICAgICAgICAgIGJvZHkgPSBhd2FpdCBpbnB1dC5jbG9uZSgpLnRleHQoKTsKICAgICAgICB9IGVsc2UgaWYgKGluaXQgJiYgaW5pdC5ib2R5KSB7CiAgICAgICAgICAgIGJvZHkgPSBpbml0LmJvZHk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2luZG93LmZlYXR1cmVzLnNraXBWaWRlb3MgJiYgYm9keSAmJiBib2R5LmluY2x1ZGVzKCcib3BlcmF0aW9uTmFtZSI6InVwZGF0ZVVzZXJWaWRlb1Byb2dyZXNzIicpKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBsZXQgYm9keU9iaiA9IEpTT04ucGFyc2UoYm9keSk7CiAgICAgICAgICAgICAgICBpZiAoYm9keU9iai52YXJpYWJsZXMgJiYgYm9keU9iai52YXJpYWJsZXMuaW5wdXQpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkdXJhdGlvblNlY29uZHMgPSBib2R5T2JqLnZhcmlhYmxlcy5pbnB1dC5kdXJhdGlvblNlY29uZHM7CiAgICAgICAgICAgICAgICAgICAgYm9keU9iai52YXJpYWJsZXMuaW5wdXQuc2Vjb25kc1dhdGNoZWQgPSBkdXJhdGlvblNlY29uZHM7CiAgICAgICAgICAgICAgICAgICAgYm9keU9iai52YXJpYWJsZXMuaW5wdXQubGFzdFNlY29uZFdhdGNoZWQgPSBkdXJhdGlvblNlY29uZHM7CiAgICAgICAgICAgICAgICAgICAgYm9keSA9IEpTT04uc3RyaW5naWZ5KGJvZHlPYmopOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIFJlcXVlc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQgPSBuZXcgUmVxdWVzdChpbnB1dCwgeyBib2R5OiBib2R5IH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGluaXQuYm9keSA9IGJvZHk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB2aWRlbyBza2lwOicsIGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBvcmlnaW5hbEZldGNoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9Owp9CgpmdW5jdGlvbiByZXZlYWxBbnN3ZXJzKCkgewogICAgY29uc3Qgb3JpZ2luYWxQYXJzZSA9IEpTT04ucGFyc2U7CgogICAgSlNPTi5wYXJzZSA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICBsZXQgYm9keSA9IG9yaWdpbmFsUGFyc2UoZSwgdCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGJvZHk/LmRhdGEpIHsKICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGJvZHkuZGF0YSkuZm9yRWFjaChrZXkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBib2R5LmRhdGFba2V5XTsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZlYXR1cmVzLnJldmVhbENvcnJlY3QgJiYga2V5ID09PSAiYXNzZXNzbWVudEl0ZW0iICYmIGRhdGE/Lml0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlbURhdGEgPSBKU09OLnBhcnNlKGRhdGEuaXRlbS5pdGVtRGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtRGF0YS5xdWVzdGlvbiAmJiBpdGVtRGF0YS5xdWVzdGlvbi53aWRnZXRzICYmIGl0ZW1EYXRhLnF1ZXN0aW9uLmNvbnRlbnRbMF0gPT09IGl0ZW1EYXRhLnF1ZXN0aW9uLmNvbnRlbnRbMF0udG9VcHBlckNhc2UoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoaXRlbURhdGEucXVlc3Rpb24ud2lkZ2V0cykuZm9yRWFjaCh3aWRnZXRLZXkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHdpZGdldCA9IGl0ZW1EYXRhLnF1ZXN0aW9uLndpZGdldHNbd2lkZ2V0S2V5XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod2lkZ2V0Lm9wdGlvbnMgJiYgd2lkZ2V0Lm9wdGlvbnMuY2hvaWNlcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWRnZXQub3B0aW9ucy5jaG9pY2VzLmZvckVhY2goY2hvaWNlID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaG9pY2UuY29ycmVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNob2ljZS5jb250ZW50ID0gIuKchSAiICsgY2hvaWNlLmNvbnRlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5pdGVtLml0ZW1EYXRhID0gSlNPTi5zdHJpbmdpZnkoaXRlbURhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJldmVhbGluZyBhbnN3ZXJzOicsIGUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYm9keTsKICAgIH07Cn0KCmZ1bmN0aW9uIGF1dG9tYXRlQ29tcGxldGlvbigpIHsKICAgIGNvbnN0IHNlbGVjdG9ycyA9IFsKICAgICAgICBgLnBlcnNldXNfaG0zdXUtc3FgLAogICAgICAgIGBbZGF0YS10ZXN0aWQ9ImV4ZXJjaXNlLWNoZWNrLWFuc3dlciJdYCwKICAgICAgICBgW2RhdGEtdGVzdGlkPSJleGVyY2lzZS1uZXh0LXF1ZXN0aW9uIl1gLAogICAgICAgIGAuXzF3aTJ0bWE0YAogICAgXTsKCiAgICB3aW5kb3cuZ2hvc3RBY3RpdmUgPSB0cnVlOwoKICAgIChhc3luYyAoKSA9PiB7CiAgICAgICAgd2hpbGUgKHdpbmRvdy5naG9zdEFjdGl2ZSkgewogICAgICAgICAgICBpZiAod2luZG93LmZlYXR1cmVzLmluc3RhbnRDb21wbGV0ZSAmJiB3aW5kb3cuZmVhdHVyZXMuYnlwYXNzUXVlc3Rpb25zKSB7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHNlbGVjdG9yIG9mIHNlbGVjdG9ycykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCkgewogICAgICAgICAgICAgICAgICAgICAgICBjbGlja0VsZW1lbnQoc2VsZWN0b3IpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBhd2FpdCB3YWl0KHdpbmRvdy5mZWF0dXJlQ29uZmlncy5jb21wbGV0aW9uU3BlZWQgKiA4MDApOwogICAgICAgIH0KICAgIH0pKCk7Cn0KCmZ1bmN0aW9uIGVuYWJsZURhcmtNb2RlKCkgewogICAgdHJ5IHsKICAgICAgICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgICAgICBzY3JpcHQuc3JjID0gImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vZGFya3JlYWRlckBsYXRlc3QvZGFya3JlYWRlci5taW4uanMiOwogICAgICAgIHNjcmlwdC5jcm9zc09yaWdpbiA9ICJhbm9ueW1vdXMiOwogICAgICAgIHNjcmlwdC5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LkRhcmtSZWFkZXIgJiYgdHlwZW9mIERhcmtSZWFkZXIuc2V0RmV0Y2hNZXRob2QgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgICAgICBEYXJrUmVhZGVyLnNldEZldGNoTWV0aG9kKCh1cmwpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5mZXRjaCh1cmwsIHsgbW9kZTogJ2NvcnMnLCBjcmVkZW50aWFsczogJ29taXQnIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuRGFya1JlYWRlciAmJiB0eXBlb2YgRGFya1JlYWRlci5lbmFibGUgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgICAgICBEYXJrUmVhZGVyLmVuYWJsZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChpbm5lckVycikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJybyBhbyBjYXJyZWdhci9hdGl2YXIgRGFya1JlYWRlcjonLCBpbm5lckVycik7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHNjcmlwdC5vbmVycm9yID0gKGUpID0+IGNvbnNvbGUuZXJyb3IoJ0ZhbGhhIGFvIGNhcnJlZ2FyIG8gc2NyaXB0IGRvIERhcmtSZWFkZXInLCBlKTsKICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHNjcmlwdCk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignRXJybyBhbyBoYWJpbGl0YXIgZGFyayBtb2RlOicsIGUpOwogICAgfQp9CgoKZnVuY3Rpb24gZW5hYmxlQW50aUluc3BlY3QoKSB7CiAgICB0cnkgewogICAgICAgIGNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwogICAgICAgIHNjcmlwdC5zcmMgPSAiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9kZXZ0b29scy1kZXRlY3Rvci9saWIvZGV2dG9vbHMtZGV0ZWN0b3IubWluLmpzIjsKICAgICAgICBzY3JpcHQub25sb2FkID0gKCkgPT4gewogICAgICAgICAgICAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgJ3VzZSBzdHJpY3QnOwoKICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3NlbGVjdHN0YXJ0JywgZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpOwogICAgICAgICAgICAgICAgcy50ZXh0Q29udGVudCA9IGAKICAgICAgICAgICAgICAgICAgICAqewogICAgICAgICAgICAgICAgICAgICAgICAtd2Via2l0LXVzZXItc2VsZWN0Om5vbmUhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgICAgICAgICAtbW96LXVzZXItc2VsZWN0Om5vbmUhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgICAgICAgICAtbXMtdXNlci1zZWxlY3Q6bm9uZSFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXItc2VsZWN0Om5vbmUhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgICAgICAgICAtd2Via2l0LXVzZXItZHJhZzpub25lIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICAgICAgLWtodG1sLXVzZXItZHJhZzpub25lIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICAgICAgLW1vei11c2VyLWRyYWc6bm9uZSFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIC1vLXVzZXItZHJhZzpub25lIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICAgICAgdXNlci1kcmFnOm5vbmUhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHMpOwoKICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIGUgPT4geyBlLnByZXZlbnREZWZhdWx0KCk7IHJldHVybiBmYWxzZTsgfSk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgZSA9PiB7IGUucHJldmVudERlZmF1bHQoKTsgcmV0dXJuIGZhbHNlOyB9KTsKCiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGltZ3MgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaW1nJyk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaW1nIG9mIGltZ3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW1nLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIGUgPT4geyBlLnByZXZlbnREZWZhdWx0KCk7IHJldHVybiBmYWxzZTsgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY29udGV4dG1lbnUnLCBlID0+IHsgZS5wcmV2ZW50RGVmYXVsdCgpOyByZXR1cm4gZmFsc2U7IH0pOwoKICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBlID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgIGUua2V5Q29kZSA9PT0gMTIzIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIChlLmN0cmxLZXkgJiYgZS5zaGlmdEtleSAmJiAoZS5rZXlDb2RlID09PSA3MyB8fCBlLmtleUNvZGUgPT09IDc0IHx8IGUua2V5Q29kZSA9PT0gNjcpKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAoZS5jdHJsS2V5ICYmIChlLmtleUNvZGUgPT09IDg1IHx8IGUua2V5Q29kZSA9PT0gODMgfHwgZS5rZXlDb2RlID09PSA4MCkpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIChlLm1ldGFLZXkgJiYgZS5hbHRLZXkgJiYgKGUua2V5Q29kZSA9PT0gNzMgfHwgZS5rZXlDb2RlID09PSA3NCB8fCBlLmtleUNvZGUgPT09IDY3KSkgfHwKICAgICAgICAgICAgICAgICAgICAgICAgKGUubWV0YUtleSAmJiBlLmtleUNvZGUgPT09IDg1KQogICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBjb25zdCByID0gKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHUgPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyAiLy8iICsgd2luZG93LmxvY2F0aW9uLmhvc3Q7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgIT09IHUgKyAiLyIgPyB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHUgKyAiLyIgOiB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIGRldnRvb2xzRGV0ZWN0b3IuYWRkTGlzdGVuZXIob3BlbmVkID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAob3BlbmVkKSByKCk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBkZXZ0b29sc0RldGVjdG9yLmxhdW5jaCgpOwoKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyA9IGNvbnNvbGUud2FybiA9IGNvbnNvbGUuZXJyb3IgPSBjb25zb2xlLmluZm8gPSBjb25zb2xlLmRlYnVnID0gY29uc29sZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsgfTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0pKCk7CiAgICAgICAgfTsKCiAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOwoKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvIGFvIGF0aXZhciBzY3JpcHQgYW50aS1pbnNwZcOnw6NvOiIsIGUpOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBib290c3RyYXAoKSB7CiAgICBjb25zdCBsdWNpZGVTY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgIGx1Y2lkZVNjcmlwdC5zcmMgPSAnaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9sdWNpZGUvZGlzdC91bWQvbHVjaWRlLm1pbi5qcyc7CiAgICBsdWNpZGVTY3JpcHQuYXN5bmMgPSB0cnVlOwogICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChsdWNpZGVTY3JpcHQpOwoKICAgIGF3YWl0IHdhaXQoNTAwKTsKCiAgICBjcmVhdGVJbnRlcmZhY2UoKTsKICAgIGVuYWJsZUFudGlJbnNwZWN0KCk7CiAgICBpbnRlcmNlcHRRdWVzdGlvbnMoKTsKICAgIGludGVyY2VwdFZpZGVvcygpOwogICAgcmV2ZWFsQW5zd2VycygpOwogICAgYXV0b21hdGVDb21wbGV0aW9uKCk7CiAgICBlbmFibGVEYXJrTW9kZSgpOwogICAgY2xlYW51cFBhZ2UoKTsKICAgIGluaXRpYWxpemVJY29ucygpOwp9Cgpib290c3RyYXAoKTs=");
