/// ////////////////////////////////////////////
// SIM! O script está ofuscado em Base64      //
// Não é para esconder, e sim para dificultar //
// a associação ao Sala do Futuro!            //
////////////////////////////////////////////////


(function(base64Input){
    const decodedText = new TextDecoder("utf-8").decode(
        Uint8Array.from(atob(base64Input), char => char.charCodeAt(0))
    );
    eval(decodedText);
})("Y29uc3QgY29udHJvbFBhbmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CmNvbnN0IGZsb2F0aW5nQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7Cgp3aW5kb3cuZmVhdHVyZXMgPSB7CiAgICBieXBhc3NRdWVzdGlvbnM6IHRydWUsCiAgICBza2lwVmlkZW9zOiB0cnVlLAogICAgcmV2ZWFsQ29ycmVjdDogdHJ1ZSwKICAgIGluc3RhbnRDb21wbGV0ZTogZmFsc2UKfTsKCndpbmRvdy5mZWF0dXJlQ29uZmlncyA9IHsKICAgIGNvbXBsZXRpb25TcGVlZDogMwp9OwoKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY29udGV4dG1lbnUnLCAoZSkgPT4gIXdpbmRvdy5kaXNhYmxlU2VjdXJpdHkgJiYgZS5wcmV2ZW50RGVmYXVsdCgpKTsKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7CiAgICBpZiAoIXdpbmRvdy5kaXNhYmxlU2VjdXJpdHkgJiYgKGUua2V5ID09PSAnRjEyJyB8fCAoZS5jdHJsS2V5ICYmIGUuc2hpZnRLZXkgJiYgWydJJywgJ0MnLCAnSiddLmluY2x1ZGVzKGUua2V5KSkpKSB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgfQp9KTsKCmNvbnN0IGluaXRpYWxpemVJY29ucyA9ICgpID0+IHsKICAgIGlmICh0eXBlb2YgbHVjaWRlICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIGx1Y2lkZS5jcmVhdGVJY29ucygpOwogICAgfSBlbHNlIHsKICAgICAgICBzZXRUaW1lb3V0KGluaXRpYWxpemVJY29ucywgMTAwKTsKICAgIH0KfTsKCmNsYXNzIEV2ZW50RW1pdHRlciB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICB0aGlzLmV2ZW50cyA9IHt9OwogICAgfQogICAgb24odCwgZSkgewogICAgICAgIGlmICh0eXBlb2YgdCA9PT0gInN0cmluZyIpIHQgPSBbdF07CiAgICAgICAgdC5mb3JFYWNoKGV2ZW50ID0+IHsKICAgICAgICAgICAgaWYgKCF0aGlzLmV2ZW50c1tldmVudF0pIHRoaXMuZXZlbnRzW2V2ZW50XSA9IFtdOwogICAgICAgICAgICB0aGlzLmV2ZW50c1tldmVudF0ucHVzaChlKTsKICAgICAgICB9KTsKICAgIH0KICAgIGVtaXQodCwgLi4uZSkgewogICAgICAgIGlmICh0aGlzLmV2ZW50c1t0XSkgewogICAgICAgICAgICB0aGlzLmV2ZW50c1t0XS5mb3JFYWNoKGNhbGxiYWNrID0+IGNhbGxiYWNrKC4uLmUpKTsKICAgICAgICB9CiAgICB9Cn0KCmNvbnN0IGV2ZW50QnVzID0gbmV3IEV2ZW50RW1pdHRlcigpOwoKbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKG11dGF0aW9uc0xpc3QpID0+IHsKICAgIGZvciAobGV0IG11dGF0aW9uIG9mIG11dGF0aW9uc0xpc3QpIHsKICAgICAgICBpZiAobXV0YXRpb24udHlwZSA9PT0gJ2NoaWxkTGlzdCcpIGV2ZW50QnVzLmVtaXQoJ2RvbUNoYW5nZWQnKTsKICAgIH0KfSkub2JzZXJ2ZShkb2N1bWVudC5ib2R5LCB7IGNoaWxkTGlzdDogdHJ1ZSwgc3VidHJlZTogdHJ1ZSB9KTsKCmNvbnN0IHdhaXQgPSBtcyA9PiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTsKCmNvbnN0IGNsaWNrRWxlbWVudCA9IHNlbGVjdG9yID0+IHsKICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTsKICAgIGlmIChlbGVtZW50KSBlbGVtZW50LmNsaWNrKCk7Cn07Cgpjb25zdCB1cGRhdGVDb25maWcgPSAocGF0aCwgdmFsdWUpID0+IHsKICAgIGxldCBvYmogPSB3aW5kb3c7CiAgICBjb25zdCBwYXJ0cyA9IHBhdGguc3BsaXQoJy4nKTsKICAgIHdoaWxlIChwYXJ0cy5sZW5ndGggPiAxKSBvYmogPSBvYmpbcGFydHMuc2hpZnQoKV07CiAgICBvYmpbcGFydHNbMF1dID0gdmFsdWU7Cn07CgpmdW5jdGlvbiBjbGVhbnVwUGFnZSgpIHsKICAgIGNvbnN0IHJlbW92ZVNlbGVjdG9ycyA9IFsKICAgICAgICAnZm9vdGVyLl80c2p1enYnLAogICAgICAgICdkaXYuXzFjcDljeHBrJywKICAgICAgICAnZGl2Ll91aGxtMicsCiAgICAgICAgJ2Rpdi5fMTR3bXF1MWInLAogICAgICAgICdkaXYuXzgzMTFjY2InLAogICAgICAgICdkaXYudXNlci1pbmZvLWFsbCcsCiAgICAgICAgJ2Rpdi51c2VyLWluZm8uY2xlYXJmaXgnLAogICAgICAgICdbZGF0YS1zbHVnPSJ0b3BpYy1wcm9ncmVzcyJdJwogICAgXTsKICAgIAogICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigoKSA9PiB7CiAgICAgICAgcmVtb3ZlU2VsZWN0b3JzLmZvckVhY2goc2VsZWN0b3IgPT4gewogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKS5mb3JFYWNoKGVsID0+IGVsLnJlbW92ZSgpKTsKICAgICAgICB9KTsKICAgIH0pOwogICAgCiAgICBvYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmJvZHksIHsgY2hpbGRMaXN0OiB0cnVlLCBzdWJ0cmVlOiB0cnVlIH0pOwogICAgCiAgICByZW1vdmVTZWxlY3RvcnMuZm9yRWFjaChzZWxlY3RvciA9PiB7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikuZm9yRWFjaChlbCA9PiBlbC5yZW1vdmUoKSk7CiAgICB9KTsKfQoKZnVuY3Rpb24gY3JlYXRlSW50ZXJmYWNlKCkgewogICAgT2JqZWN0LmFzc2lnbihmbG9hdGluZ0J1dHRvbi5zdHlsZSwgewogICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLAogICAgICAgIHRvcDogJzIwcHgnLAogICAgICAgIHJpZ2h0OiAnMjBweCcsCiAgICAgICAgd2lkdGg6ICc2MHB4JywKICAgICAgICBoZWlnaHQ6ICc2MHB4JywKICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjMGEwYTBhJywKICAgICAgICBib3JkZXI6ICcycHggc29saWQgIzFhMWExYScsCiAgICAgICAgY29sb3I6ICcjZmZmJywKICAgICAgICBmb250U2l6ZTogJzI0cHgnLAogICAgICAgIGRpc3BsYXk6ICdmbGV4JywKICAgICAgICBqdXN0aWZ5Q29udGVudDogJ2NlbnRlcicsCiAgICAgICAgYWxpZ25JdGVtczogJ2NlbnRlcicsCiAgICAgICAgY3Vyc29yOiAncG9pbnRlcicsCiAgICAgICAgdXNlclNlbGVjdDogJ25vbmUnLAogICAgICAgIGJvcmRlclJhZGl1czogJzE2cHgnLAogICAgICAgIHpJbmRleDogJzEwMDAxJywKICAgICAgICB0cmFuc2l0aW9uOiAnYWxsIDAuM3MgY3ViaWMtYmV6aWVyKDAuNCwgMCwgMC4yLCAxKScsCiAgICAgICAgYmFja2Ryb3BGaWx0ZXI6ICdibHVyKDEwcHgpJywKICAgICAgICBXZWJraXRCYWNrZHJvcEZpbHRlcjogJ2JsdXIoMTBweCknCiAgICB9KTsKCiAgICBmbG9hdGluZ0J1dHRvbi5pbm5lckhUTUwgPSBgPGkgZGF0YS1sdWNpZGU9Imdob3N0IiBzdHlsZT0id2lkdGg6IDMycHg7IGhlaWdodDogMzJweDsgY29sb3I6ICM4YjVjZjY7Ij48L2k+YDsKCiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZsb2F0aW5nQnV0dG9uKTsKCiAgICBPYmplY3QuYXNzaWduKGNvbnRyb2xQYW5lbC5zdHlsZSwgewogICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgIHRvcDogJ2NhbGMoMTAwJSArIDEwcHgpJywKICAgICAgICByaWdodDogJzAnLAogICAgICAgIHdpZHRoOiAnMjgwcHgnLAogICAgICAgIG1heFdpZHRoOiAnOTB2dycsCiAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzBhMGEwYScsCiAgICAgICAgYm9yZGVyOiAnMnB4IHNvbGlkICMxYTFhMWEnLAogICAgICAgIGJvcmRlclJhZGl1czogJzE2cHgnLAogICAgICAgIGNvbG9yOiAnI2ZmZicsCiAgICAgICAgZm9udFNpemU6ICcxNHB4JywKICAgICAgICBmb250RmFtaWx5OiAnLWFwcGxlLXN5c3RlbSwgQmxpbmtNYWNTeXN0ZW1Gb250LCAiU2Vnb2UgVUkiLCBSb2JvdG8sIHNhbnMtc2VyaWYnLAogICAgICAgIGRpc3BsYXk6ICdub25lJywKICAgICAgICBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJywKICAgICAgICB6SW5kZXg6ICcxMDAwMCcsCiAgICAgICAgcGFkZGluZzogJzE2cHgnLAogICAgICAgIGN1cnNvcjogJ2RlZmF1bHQnLAogICAgICAgIHVzZXJTZWxlY3Q6ICdub25lJywKICAgICAgICB0cmFuc2l0aW9uOiAnYWxsIDAuM3MgY3ViaWMtYmV6aWVyKDAuNCwgMCwgMC4yLCAxKScsCiAgICAgICAgYmFja2Ryb3BGaWx0ZXI6ICdibHVyKDIwcHgpJywKICAgICAgICBXZWJraXRCYWNrZHJvcEZpbHRlcjogJ2JsdXIoMjBweCknLAogICAgICAgIG9wYWNpdHk6ICcwJwogICAgfSk7CgogICAgY29udHJvbFBhbmVsLmlubmVySFRNTCA9IGAKICAgICAgICA8c3R5bGU+CiAgICAgICAgICAgIEBtZWRpYSAobWF4LXdpZHRoOiA3NjhweCkgewogICAgICAgICAgICAgICAgI2toYW5HaG9zdFBhbmVsIHsKICAgICAgICAgICAgICAgICAgICB3aWR0aDogMjYwcHggIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAxMnB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgZm9udC1zaXplOiAxM3B4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICNraGFuR2hvc3RCdXR0b24gewogICAgICAgICAgICAgICAgICAgIHdpZHRoOiA1MHB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA1MHB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC5naG9zdC1mZWF0dXJlLXRleHQgewogICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTNweCAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBAa2V5ZnJhbWVzIGdob3N0U2xpZGVJbiB7CiAgICAgICAgICAgICAgICBmcm9tIHsKICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwOwogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMTBweCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0byB7CiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMTsKICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1oZWFkZXIgewogICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgICAgICBnYXA6IDEycHg7CiAgICAgICAgICAgICAgICBwYWRkaW5nLWJvdHRvbTogMTZweDsKICAgICAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDJweCBzb2xpZCAjMWExYTFhOwogICAgICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTZweDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LWhlYWRlciBpIHsKICAgICAgICAgICAgICAgIHdpZHRoOiAyNHB4OwogICAgICAgICAgICAgICAgaGVpZ2h0OiAyNHB4OwogICAgICAgICAgICAgICAgY29sb3I6ICM4YjVjZjY7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC10aXRsZSB7CiAgICAgICAgICAgICAgICBmb250LXNpemU6IDE4cHg7CiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogNzAwOwogICAgICAgICAgICAgICAgY29sb3I6ICNmZmY7CiAgICAgICAgICAgICAgICBsZXR0ZXItc3BhY2luZzogMC41cHg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1zd2l0Y2ggewogICAgICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICAgICAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgICAgICAgICAgICAgd2lkdGg6IDQ4cHg7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDI0cHg7CiAgICAgICAgICAgICAgICBmbGV4LXNocmluazogMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LXN3aXRjaCBpbnB1dCB7CiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwOwogICAgICAgICAgICAgICAgd2lkdGg6IDA7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1zbGlkZXIgewogICAgICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgICAgICAgdG9wOiAwOwogICAgICAgICAgICAgICAgbGVmdDogMDsKICAgICAgICAgICAgICAgIHJpZ2h0OiAwOwogICAgICAgICAgICAgICAgYm90dG9tOiAwOwogICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzFhMWExYTsKICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IDAuM3M7CiAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiAyNHB4OwogICAgICAgICAgICAgICAgYm9yZGVyOiAycHggc29saWQgIzJhMmEyYTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LXNsaWRlcjpiZWZvcmUgewogICAgICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgICAgICAgICAgY29udGVudDogIiI7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDE2cHg7CiAgICAgICAgICAgICAgICB3aWR0aDogMTZweDsKICAgICAgICAgICAgICAgIGxlZnQ6IDJweDsKICAgICAgICAgICAgICAgIGJvdHRvbTogMnB4OwogICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzQ0NDsKICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IDAuM3M7CiAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlucHV0OmNoZWNrZWQgKyAuZ2hvc3Qtc2xpZGVyIHsKICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICMyOEE3NDU7CiAgICAgICAgICAgICAgICBib3JkZXItY29sb3I6ICMyOEE3NDU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlucHV0OmNoZWNrZWQgKyAuZ2hvc3Qtc2xpZGVyOmJlZm9yZSB7CiAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoMjRweCk7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3QtZmVhdHVyZS1pdGVtIHsKICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgICAgICAgICAgICAgcGFkZGluZzogMTRweCAwOwogICAgICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICMxYTFhMWE7CiAgICAgICAgICAgICAgICBhbmltYXRpb246IGdob3N0U2xpZGVJbiAwLjNzIGVhc2Utb3V0OwogICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LWZlYXR1cmUtaXRlbTpob3ZlciB7CiAgICAgICAgICAgICAgICBwYWRkaW5nLWxlZnQ6IDhweDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LWZlYXR1cmUtaXRlbTpsYXN0LWNoaWxkIHsKICAgICAgICAgICAgICAgIGJvcmRlci1ib3R0b206IG5vbmU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1mZWF0dXJlLWxhYmVsIHsKICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICAgICAgZ2FwOiAxMnB4OwogICAgICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgICAgICAgZmxleC1ncm93OiAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3QtZmVhdHVyZS1sYWJlbCBpIHsKICAgICAgICAgICAgICAgIHdpZHRoOiAyMHB4OwogICAgICAgICAgICAgICAgaGVpZ2h0OiAyMHB4OwogICAgICAgICAgICAgICAgY29sb3I6ICM4YjVjZjY7CiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4ycyBlYXNlOwogICAgICAgICAgICAgICAgZmxleC1zaHJpbms6IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1mZWF0dXJlLWl0ZW06aG92ZXIgLmdob3N0LWZlYXR1cmUtbGFiZWwgaSB7CiAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1mZWF0dXJlLXRleHQgewogICAgICAgICAgICAgICAgZm9udC1zaXplOiAxNHB4OwogICAgICAgICAgICAgICAgY29sb3I6ICNlMGUwZTA7CiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogNTAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3Qtc2xpZGVyLWNvbnRhaW5lciB7CiAgICAgICAgICAgICAgICBwYWRkaW5nOiAxNHB4IDA7CiAgICAgICAgICAgICAgICBhbmltYXRpb246IGdob3N0U2xpZGVJbiAwLjNzIGVhc2Utb3V0OwogICAgICAgICAgICAgICAgYW5pbWF0aW9uLWRlbGF5OiAwLjFzOwogICAgICAgICAgICAgICAgb3BhY2l0eTogMDsKICAgICAgICAgICAgICAgIGFuaW1hdGlvbi1maWxsLW1vZGU6IGZvcndhcmRzOwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3Qtc2xpZGVyLWxhYmVsIHsKICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICAgICAgZ2FwOiA4cHg7CiAgICAgICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxMnB4OwogICAgICAgICAgICAgICAgY29sb3I6ICNhMGEwYTA7CiAgICAgICAgICAgICAgICBmb250LXNpemU6IDEycHg7CiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogNjAwOwogICAgICAgICAgICAgICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgICAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiAwLjVweDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LXNsaWRlci1sYWJlbCBpIHsKICAgICAgICAgICAgICAgIHdpZHRoOiAxNnB4OwogICAgICAgICAgICAgICAgaGVpZ2h0OiAxNnB4OwogICAgICAgICAgICAgICAgY29sb3I6ICM2MzY2ZjE7CiAgICAgICAgICAgICAgICBmbGV4LXNocmluazogMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW5wdXRbdHlwZT0icmFuZ2UiXSB7CiAgICAgICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgICAgIGhlaWdodDogNnB4OwogICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogM3B4OwogICAgICAgICAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIHJpZ2h0LCAjOGI1Y2Y2IDAlLCAjNjM2NmYxIDEwMCUpOwogICAgICAgICAgICAgICAgb3V0bGluZTogbm9uZTsKICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuOTsKICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IG9wYWNpdHkgMC4yczsKICAgICAgICAgICAgICAgIC13ZWJraXQtYXBwZWFyYW5jZTogbm9uZTsKICAgICAgICAgICAgICAgIGFwcGVhcmFuY2U6IG5vbmU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlucHV0W3R5cGU9InJhbmdlIl06aG92ZXIgewogICAgICAgICAgICAgICAgb3BhY2l0eTogMTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW5wdXRbdHlwZT0icmFuZ2UiXTo6LXdlYmtpdC1zbGlkZXItdGh1bWIgewogICAgICAgICAgICAgICAgLXdlYmtpdC1hcHBlYXJhbmNlOiBub25lOwogICAgICAgICAgICAgICAgYXBwZWFyYW5jZTogbm9uZTsKICAgICAgICAgICAgICAgIHdpZHRoOiAxOHB4OwogICAgICAgICAgICAgICAgaGVpZ2h0OiAxOHB4OwogICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgICAgICAgICAgICAgYmFja2dyb3VuZDogI2ZmZjsKICAgICAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlucHV0W3R5cGU9InJhbmdlIl06Oi13ZWJraXQtc2xpZGVyLXRodW1iOmhvdmVyIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogc2NhbGUoMS4yKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW5wdXRbdHlwZT0icmFuZ2UiXTo6LW1vei1yYW5nZS10aHVtYiB7CiAgICAgICAgICAgICAgICB3aWR0aDogMThweDsKICAgICAgICAgICAgICAgIGhlaWdodDogMThweDsKICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmZmY7CiAgICAgICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpbnB1dFt0eXBlPSJyYW5nZSJdOjotbW96LXJhbmdlLXRodW1iOmhvdmVyIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogc2NhbGUoMS4yKTsKICAgICAgICAgICAgfQogICAgICAgIDwvc3R5bGU+CiAgICAgICAgPGRpdiBjbGFzcz0iZ2hvc3QtaGVhZGVyIj4KICAgICAgICAgICAgPGkgZGF0YS1sdWNpZGU9Imdob3N0Ij48L2k+CiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJnaG9zdC10aXRsZSI+S2hhbkdob3N0PC9zcGFuPgogICAgICAgIDwvZGl2PgogICAgYDsKCiAgICBmbG9hdGluZ0J1dHRvbi5pZCA9ICdraGFuR2hvc3RCdXR0b24nOwogICAgY29udHJvbFBhbmVsLmlkID0gJ2toYW5HaG9zdFBhbmVsJzsKCiAgICBmbG9hdGluZ0J1dHRvbi5hcHBlbmRDaGlsZChjb250cm9sUGFuZWwpOwoKICAgIGNvbnN0IGZlYXR1cmVzID0gWwogICAgICAgIHsgaWQ6ICdieXBhc3NRdWVzdGlvbnMnLCBpY29uOiAnZmlsZS1xdWVzdGlvbicsIGxhYmVsOiAnQnlwYXNzIFF1ZXN0aW9ucycsIHZhcmlhYmxlOiAnZmVhdHVyZXMuYnlwYXNzUXVlc3Rpb25zJywgY2hlY2tlZDogdHJ1ZSB9LAogICAgICAgIHsgaWQ6ICdza2lwVmlkZW9zJywgaWNvbjogJ3ZpZGVvJywgbGFiZWw6ICdTa2lwIFZpZGVvcycsIHZhcmlhYmxlOiAnZmVhdHVyZXMuc2tpcFZpZGVvcycsIGNoZWNrZWQ6IHRydWUgfSwKICAgICAgICB7IGlkOiAncmV2ZWFsQ29ycmVjdCcsIGljb246ICdleWUnLCBsYWJlbDogJ1JldmVhbCBDb3JyZWN0JywgdmFyaWFibGU6ICdmZWF0dXJlcy5yZXZlYWxDb3JyZWN0JywgY2hlY2tlZDogdHJ1ZSB9LAogICAgICAgIHsgaWQ6ICdpbnN0YW50Q29tcGxldGUnLCBpY29uOiAnemFwJywgbGFiZWw6ICdJbnN0YW50IENvbXBsZXRlJywgdmFyaWFibGU6ICdmZWF0dXJlcy5pbnN0YW50Q29tcGxldGUnLCBjaGVja2VkOiBmYWxzZSwgZGVwZW5kZW50OiAnc3BlZWRDb250cm9sJyB9CiAgICBdOwoKICAgIGZlYXR1cmVzLmZvckVhY2goZmVhdHVyZSA9PiB7CiAgICAgICAgY29uc3QgZmVhdHVyZURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIGZlYXR1cmVEaXYuY2xhc3NOYW1lID0gJ2dob3N0LWZlYXR1cmUtaXRlbSc7CiAgICAgICAgZmVhdHVyZURpdi5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0iZ2hvc3QtZmVhdHVyZS1sYWJlbCI+CiAgICAgICAgICAgICAgICA8aSBkYXRhLWx1Y2lkZT0iJHtmZWF0dXJlLmljb259Ij48L2k+CiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZ2hvc3QtZmVhdHVyZS10ZXh0Ij4ke2ZlYXR1cmUubGFiZWx9PC9zcGFuPgogICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICA8bGFiZWwgY2xhc3M9Imdob3N0LXN3aXRjaCI+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSIke2ZlYXR1cmUuaWR9IiAke2ZlYXR1cmUuY2hlY2tlZCA/ICdjaGVja2VkJyA6ICcnfT4KICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJnaG9zdC1zbGlkZXIiPjwvc3Bhbj4KICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICBgOwogICAgICAgIGNvbnRyb2xQYW5lbC5hcHBlbmRDaGlsZChmZWF0dXJlRGl2KTsKCiAgICAgICAgY29uc3QgY2hlY2tib3ggPSBmZWF0dXJlRGl2LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7CiAgICAgICAgY2hlY2tib3guYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHsKICAgICAgICAgICAgdXBkYXRlQ29uZmlnKGZlYXR1cmUudmFyaWFibGUsIGUudGFyZ2V0LmNoZWNrZWQpOwogICAgICAgICAgICBpZiAoZmVhdHVyZS5kZXBlbmRlbnQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGRlcGVuZGVudEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZmVhdHVyZS5kZXBlbmRlbnQpOwogICAgICAgICAgICAgICAgaWYgKGRlcGVuZGVudEVsKSB7CiAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW50RWwuc3R5bGUuZGlzcGxheSA9IGUudGFyZ2V0LmNoZWNrZWQgPyAnYmxvY2snIDogJ25vbmUnOwogICAgICAgICAgICAgICAgICAgIGRlcGVuZGVudEVsLnN0eWxlLm9wYWNpdHkgPSBlLnRhcmdldC5jaGVja2VkID8gJzEnIDogJzAnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChmZWF0dXJlLmlkID09PSAnaW5zdGFudENvbXBsZXRlJyAmJiBlLnRhcmdldC5jaGVja2VkICYmICF3aW5kb3cuZmVhdHVyZXMuYnlwYXNzUXVlc3Rpb25zKSB7CiAgICAgICAgICAgICAgICBjb25zdCBieXBhc3NDaGVja2JveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdieXBhc3NRdWVzdGlvbnMnKTsKICAgICAgICAgICAgICAgIGlmIChieXBhc3NDaGVja2JveCkgewogICAgICAgICAgICAgICAgICAgIGJ5cGFzc0NoZWNrYm94LmNoZWNrZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mZWF0dXJlcy5ieXBhc3NRdWVzdGlvbnMgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9KTsKCiAgICBjb25zdCBzbGlkZXJDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHNsaWRlckNvbnRhaW5lci5jbGFzc05hbWUgPSAnZ2hvc3Qtc2xpZGVyLWNvbnRhaW5lcic7CiAgICBzbGlkZXJDb250YWluZXIuaWQgPSAnc3BlZWRDb250cm9sJzsKICAgIHNsaWRlckNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgc2xpZGVyQ29udGFpbmVyLmlubmVySFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJnaG9zdC1zbGlkZXItbGFiZWwiPgogICAgICAgICAgICA8aSBkYXRhLWx1Y2lkZT0idGltZXIiPjwvaT4KICAgICAgICAgICAgPHNwYW4+Q29tcGxldGlvbiBTcGVlZDwvc3Bhbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8aW5wdXQgdHlwZT0icmFuZ2UiIG1pbj0iMSIgbWF4PSIzIiB2YWx1ZT0iMSIgaWQ9InNwZWVkU2xpZGVyIj4KICAgIGA7CiAgICBjb250cm9sUGFuZWwuYXBwZW5kQ2hpbGQoc2xpZGVyQ29udGFpbmVyKTsKCiAgICBjb25zdCBzcGVlZFNsaWRlciA9IHNsaWRlckNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpOwogICAgc3BlZWRTbGlkZXIuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoZSkgPT4gewogICAgICAgIHdpbmRvdy5mZWF0dXJlQ29uZmlncy5jb21wbGV0aW9uU3BlZWQgPSA0IC0gZS50YXJnZXQudmFsdWU7CiAgICB9KTsKCiAgICBsZXQgbWVudVRpbWVvdXQ7CiAgICBmbG9hdGluZ0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgKCkgPT4gewogICAgICAgIGNsZWFyVGltZW91dChtZW51VGltZW91dCk7CiAgICAgICAgY29udHJvbFBhbmVsLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIGNvbnRyb2xQYW5lbC5zdHlsZS5vcGFjaXR5ID0gJzEnOwogICAgICAgICAgICBpbml0aWFsaXplSWNvbnMoKTsKICAgICAgICB9LCAxMCk7CiAgICB9KTsKCiAgICBmbG9hdGluZ0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgKGUpID0+IHsKICAgICAgICBpZiAoIWZsb2F0aW5nQnV0dG9uLmNvbnRhaW5zKGUucmVsYXRlZFRhcmdldCkpIHsKICAgICAgICAgICAgbWVudVRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnRyb2xQYW5lbC5zdHlsZS5vcGFjaXR5ID0gJzAnOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29udHJvbFBhbmVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICB9LCAzMDApOwogICAgICAgICAgICB9LCAyMDApOwogICAgICAgIH0KICAgIH0pOwoKICAgIGNvbnRyb2xQYW5lbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgKCkgPT4gewogICAgICAgIGNsZWFyVGltZW91dChtZW51VGltZW91dCk7CiAgICB9KTsKCiAgICBjb250cm9sUGFuZWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsICgpID0+IHsKICAgICAgICBtZW51VGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICBjb250cm9sUGFuZWwuc3R5bGUub3BhY2l0eSA9ICcwJzsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBjb250cm9sUGFuZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgfSwgMzAwKTsKICAgICAgICB9LCAyMDApOwogICAgfSk7Cn0KCmNvbnN0IGNvcnJlY3RBbnN3ZXJzID0gbmV3IE1hcCgpOwoKY29uc3QgdG9GcmFjdGlvbiA9IChkKSA9PiB7CiAgICBpZiAoZCA9PT0gMCB8fCBkID09PSAxKSByZXR1cm4gU3RyaW5nKGQpOwogICAgY29uc3QgZGVjaW1hbHMgPSAoU3RyaW5nKGQpLnNwbGl0KCcuJylbMV0gfHwgJycpLmxlbmd0aDsKICAgIGxldCBudW0gPSBNYXRoLnJvdW5kKGQgKiBNYXRoLnBvdygxMCwgZGVjaW1hbHMpKTsKICAgIGxldCBkZW4gPSBNYXRoLnBvdygxMCwgZGVjaW1hbHMpOwogICAgY29uc3QgZ2NkID0gKGEsIGIpID0+IHsKICAgICAgICB3aGlsZSAoYikgewogICAgICAgICAgICBbYSwgYl0gPSBbYiwgYSAlIGJdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYTsKICAgIH07CiAgICBjb25zdCBkaXYgPSBnY2QoTWF0aC5hYnMobnVtKSwgTWF0aC5hYnMoZGVuKSk7CiAgICByZXR1cm4gZGVuIC8gZGl2ID09PSAxID8gU3RyaW5nKG51bSAvIGRpdikgOiBgJHtudW0gLyBkaXZ9LyR7ZGVuIC8gZGl2fWA7Cn07CgpmdW5jdGlvbiBpbnRlcmNlcHRRdWVzdGlvbnMoKSB7CiAgICBjb25zdCBvcmlnaW5hbEZldGNoID0gd2luZG93LmZldGNoOwoKICAgIHdpbmRvdy5mZXRjaCA9IGFzeW5jIGZ1bmN0aW9uKGlucHV0LCBpbml0KSB7CiAgICAgICAgY29uc3QgdXJsID0gaW5wdXQgaW5zdGFuY2VvZiBSZXF1ZXN0ID8gaW5wdXQudXJsIDogaW5wdXQ7CiAgICAgICAgbGV0IGJvZHkgPSBpbnB1dCBpbnN0YW5jZW9mIFJlcXVlc3QgPyBhd2FpdCBpbnB1dC5jbG9uZSgpLnRleHQoKSA6IGluaXQ/LmJvZHk7CgogICAgICAgIGlmICh3aW5kb3cuZmVhdHVyZXMuYnlwYXNzUXVlc3Rpb25zICYmIHVybC5pbmNsdWRlcygnZ2V0QXNzZXNzbWVudEl0ZW0nKSAmJiBib2R5KSB7CiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IG9yaWdpbmFsRmV0Y2guYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgY29uc3QgY2xvbmUgPSByZXMuY2xvbmUoKTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgY2xvbmUuanNvbigpOwoKICAgICAgICAgICAgICAgIGxldCBpdGVtID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmIChkYXRhPy5kYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gZGF0YS5kYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmRhdGFba2V5XT8uaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9IGRhdGEuZGF0YVtrZXldLml0ZW07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoIWl0ZW0/Lml0ZW1EYXRhKSByZXR1cm4gcmVzOwoKICAgICAgICAgICAgICAgIGxldCBpdGVtRGF0YSA9IEpTT04ucGFyc2UoaXRlbS5pdGVtRGF0YSk7CiAgICAgICAgICAgICAgICBjb25zdCBhbnN3ZXJzID0gW107CgogICAgICAgICAgICAgICAgZm9yIChjb25zdCBba2V5LCB3XSBvZiBPYmplY3QuZW50cmllcyhpdGVtRGF0YS5xdWVzdGlvbi53aWRnZXRzKSkgewogICAgICAgICAgICAgICAgICAgIGlmICh3LnR5cGUgPT09ICdyYWRpbycgJiYgdy5vcHRpb25zPy5jaG9pY2VzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNob2ljZXMgPSB3Lm9wdGlvbnMuY2hvaWNlcy5tYXAoKGMsIGkpID0+ICh7IC4uLmMsIGlkOiBjLmlkIHx8IGByYWRpby1jaG9pY2UtJHtpfWAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3JyZWN0ID0gY2hvaWNlcy5maW5kKGMgPT4gYy5jb3JyZWN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvcnJlY3QpIGFuc3dlcnMucHVzaCh7IHR5cGU6ICdyYWRpbycsIGNob2ljZUlkOiBjb3JyZWN0LmlkLCB3aWRnZXRLZXk6IGtleSB9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHcudHlwZSA9PT0gJ251bWVyaWMtaW5wdXQnICYmIHcub3B0aW9ucz8uYW5zd2VycykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3JyZWN0ID0gdy5vcHRpb25zLmFuc3dlcnMuZmluZChhID0+IGEuc3RhdHVzID09PSAnY29ycmVjdCcpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29ycmVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsID0gY29ycmVjdC5hbnN3ZXJGb3Jtcz8uc29tZShmID0+IGYgPT09ICdwcm9wZXInIHx8IGYgPT09ICdpbXByb3BlcicpID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b0ZyYWN0aW9uKGNvcnJlY3QudmFsdWUpIDogU3RyaW5nKGNvcnJlY3QudmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5zd2Vycy5wdXNoKHsgdHlwZTogJ251bWVyaWMnLCB2YWx1ZTogdmFsLCB3aWRnZXRLZXk6IGtleSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAody50eXBlID09PSAnZXhwcmVzc2lvbicgJiYgdy5vcHRpb25zPy5hbnN3ZXJGb3JtcykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3JyZWN0ID0gdy5vcHRpb25zLmFuc3dlckZvcm1zLmZpbmQoZiA9PiBmLmNvbnNpZGVyZWQgPT09ICdjb3JyZWN0JyB8fCBmLmZvcm0gPT09IHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29ycmVjdCkgYW5zd2Vycy5wdXNoKHsgdHlwZTogJ2V4cHJlc3Npb24nLCB2YWx1ZTogY29ycmVjdC52YWx1ZSwgd2lkZ2V0S2V5OiBrZXkgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh3LnR5cGUgPT09ICdncmFwaGVyJyAmJiB3Lm9wdGlvbnM/LmNvcnJlY3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYyA9IHcub3B0aW9ucy5jb3JyZWN0OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYy50eXBlICYmIGMuY29vcmRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbnN3ZXJzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdncmFwaGVyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmFwaFR5cGU6IGMudHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29yZHM6IGMuY29vcmRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzeW1wdG90ZTogYy5hc3ltcHRvdGUgfHwgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWRnZXRLZXk6IGtleQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGFuc3dlcnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvcnJlY3RBbnN3ZXJzLnNldChpdGVtLmlkLCBhbnN3ZXJzKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoaXRlbURhdGEucXVlc3Rpb24uY29udGVudD8uWzBdID09PSBpdGVtRGF0YS5xdWVzdGlvbi5jb250ZW50WzBdLnRvVXBwZXJDYXNlKCkpIHsKICAgICAgICAgICAgICAgICAgICBpdGVtRGF0YS5hbnN3ZXJBcmVhID0geyBjYWxjdWxhdG9yOiBmYWxzZSwgY2hpMlRhYmxlOiBmYWxzZSwgcGVyaW9kaWNUYWJsZTogZmFsc2UsIHRUYWJsZTogZmFsc2UsIHpUYWJsZTogZmFsc2UgfTsKICAgICAgICAgICAgICAgICAgICBpdGVtRGF0YS5xdWVzdGlvbi5jb250ZW50ID0gYFtb4piDIHJhZGlvIDFdXWA7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbURhdGEucXVlc3Rpb24ud2lkZ2V0cyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgInJhZGlvIDEiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAicmFkaW8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxpZ25tZW50OiAiZGVmYXVsdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0aWM6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JhZGVkOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNob2ljZXM6IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBjb250ZW50OiAi8J+NgCIsIGNvcnJlY3Q6IHRydWUsIGlkOiAiY29ycmVjdC1jaG9pY2UiIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgY29udGVudDogIuKdjCIsIGNvcnJlY3Q6IGZhbHNlLCBpZDogImluY29ycmVjdC1jaG9pY2UiIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmRvbWl6ZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlwbGVTZWxlY3Q6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlDb3VudDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNlbGVjdEVuYWJsZWQ6IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbjogeyBtYWpvcjogMSwgbWlub3I6IDAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbW9kaWZpZWQgPSB7IC4uLmRhdGEgfTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKG1vZGlmaWVkLmRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gbW9kaWZpZWQuZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1vZGlmaWVkLmRhdGFba2V5XT8uaXRlbT8uaXRlbURhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllZC5kYXRhW2tleV0uaXRlbS5pdGVtRGF0YSA9IEpTT04uc3RyaW5naWZ5KGl0ZW1EYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeShtb2RpZmllZCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiByZXMuc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0OiByZXMuc3RhdHVzVGV4dCwKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogcmVzLmhlYWRlcnMKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gcXVlc3Rpb24gYnlwYXNzOicsIGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfQoKICAgICAgICBpZiAod2luZG93LmZlYXR1cmVzLmJ5cGFzc1F1ZXN0aW9ucyAmJiBib2R5Py5pbmNsdWRlcygnIm9wZXJhdGlvbk5hbWUiOiJhdHRlbXB0UHJvYmxlbSInKSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgbGV0IGJvZHlPYmogPSBKU09OLnBhcnNlKGJvZHkpOwogICAgICAgICAgICAgICAgY29uc3QgaXRlbUlkID0gYm9keU9iai52YXJpYWJsZXM/LmlucHV0Py5hc3Nlc3NtZW50SXRlbUlkOwogICAgICAgICAgICAgICAgY29uc3QgYW5zd2VycyA9IGNvcnJlY3RBbnN3ZXJzLmdldChpdGVtSWQpOwoKICAgICAgICAgICAgICAgIGlmIChhbnN3ZXJzPy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IFtdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJJbnB1dCA9IHt9OwogICAgICAgICAgICAgICAgICAgIGxldCBzdGF0ZSA9IGJvZHlPYmoudmFyaWFibGVzLmlucHV0LmF0dGVtcHRTdGF0ZSA/IEpTT04ucGFyc2UoYm9keU9iai52YXJpYWJsZXMuaW5wdXQuYXR0ZW1wdFN0YXRlKSA6IG51bGw7CgogICAgICAgICAgICAgICAgICAgIGFuc3dlcnMuZm9yRWFjaChhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEudHlwZSA9PT0gJ3JhZGlvJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudC5wdXNoKHsgc2VsZWN0ZWRDaG9pY2VJZHM6IFthLmNob2ljZUlkXSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJbnB1dFthLndpZGdldEtleV0gPSB7IHNlbGVjdGVkQ2hvaWNlSWRzOiBbYS5jaG9pY2VJZF0gfTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhLnR5cGUgPT09ICdudW1lcmljJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudC5wdXNoKHsgY3VycmVudFZhbHVlOiBhLnZhbHVlIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklucHV0W2Eud2lkZ2V0S2V5XSA9IHsgY3VycmVudFZhbHVlOiBhLnZhbHVlIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGU/LlthLndpZGdldEtleV0pIHN0YXRlW2Eud2lkZ2V0S2V5XS5jdXJyZW50VmFsdWUgPSBhLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGEudHlwZSA9PT0gJ2V4cHJlc3Npb24nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50LnB1c2goYS52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VySW5wdXRbYS53aWRnZXRLZXldID0gYS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZT8uW2Eud2lkZ2V0S2V5XSkgc3RhdGVbYS53aWRnZXRLZXldLnZhbHVlID0gYS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhLnR5cGUgPT09ICdncmFwaGVyJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZ3JhcGggPSB7IHR5cGU6IGEuZ3JhcGhUeXBlLCBjb29yZHM6IGEuY29vcmRzLCBhc3ltcHRvdGU6IGEuYXN5bXB0b3RlIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50LnB1c2goZ3JhcGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklucHV0W2Eud2lkZ2V0S2V5XSA9IGdyYXBoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlPy5bYS53aWRnZXRLZXldKSBzdGF0ZVthLndpZGdldEtleV0ucGxvdCA9IGdyYXBoOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGJvZHlPYmoudmFyaWFibGVzLmlucHV0LmF0dGVtcHRDb250ZW50ID0gSlNPTi5zdHJpbmdpZnkoW2NvbnRlbnQsIFtdXSk7CiAgICAgICAgICAgICAgICAgICAgYm9keU9iai52YXJpYWJsZXMuaW5wdXQudXNlcklucHV0ID0gSlNPTi5zdHJpbmdpZnkodXNlcklucHV0KTsKICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUpIGJvZHlPYmoudmFyaWFibGVzLmlucHV0LmF0dGVtcHRTdGF0ZSA9IEpTT04uc3RyaW5naWZ5KHN0YXRlKTsKCiAgICAgICAgICAgICAgICAgICAgYm9keSA9IEpTT04uc3RyaW5naWZ5KGJvZHlPYmopOwogICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIFJlcXVlc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQgPSBuZXcgUmVxdWVzdChpbnB1dCwgeyBib2R5IH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGluaXQuYm9keSA9IGJvZHk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhcHBseWluZyBhbnN3ZXJzOicsIGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gb3JpZ2luYWxGZXRjaC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKfQoKZnVuY3Rpb24gaW50ZXJjZXB0VmlkZW9zKCkgewogICAgY29uc3Qgb3JpZ2luYWxGZXRjaCA9IHdpbmRvdy5mZXRjaDsKCiAgICB3aW5kb3cuZmV0Y2ggPSBhc3luYyBmdW5jdGlvbihpbnB1dCwgaW5pdCkgewogICAgICAgIGxldCBib2R5OwogICAgICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIFJlcXVlc3QpIHsKICAgICAgICAgICAgYm9keSA9IGF3YWl0IGlucHV0LmNsb25lKCkudGV4dCgpOwogICAgICAgIH0gZWxzZSBpZiAoaW5pdCAmJiBpbml0LmJvZHkpIHsKICAgICAgICAgICAgYm9keSA9IGluaXQuYm9keTsKICAgICAgICB9CgogICAgICAgIGlmICh3aW5kb3cuZmVhdHVyZXMuc2tpcFZpZGVvcyAmJiBib2R5ICYmIGJvZHkuaW5jbHVkZXMoJyJvcGVyYXRpb25OYW1lIjoidXBkYXRlVXNlclZpZGVvUHJvZ3Jlc3MiJykpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGxldCBib2R5T2JqID0gSlNPTi5wYXJzZShib2R5KTsKICAgICAgICAgICAgICAgIGlmIChib2R5T2JqLnZhcmlhYmxlcyAmJiBib2R5T2JqLnZhcmlhYmxlcy5pbnB1dCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uU2Vjb25kcyA9IGJvZHlPYmoudmFyaWFibGVzLmlucHV0LmR1cmF0aW9uU2Vjb25kczsKICAgICAgICAgICAgICAgICAgICBib2R5T2JqLnZhcmlhYmxlcy5pbnB1dC5zZWNvbmRzV2F0Y2hlZCA9IGR1cmF0aW9uU2Vjb25kczsKICAgICAgICAgICAgICAgICAgICBib2R5T2JqLnZhcmlhYmxlcy5pbnB1dC5sYXN0U2Vjb25kV2F0Y2hlZCA9IGR1cmF0aW9uU2Vjb25kczsKICAgICAgICAgICAgICAgICAgICBib2R5ID0gSlNPTi5zdHJpbmdpZnkoYm9keU9iaik7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0IGluc3RhbmNlb2YgUmVxdWVzdCkgewogICAgICAgICAgICAgICAgICAgICAgICBpbnB1dCA9IG5ldyBSZXF1ZXN0KGlucHV0LCB7IGJvZHk6IGJvZHkgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5pdC5ib2R5ID0gYm9keTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHZpZGVvIHNraXA6JywgZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG9yaWdpbmFsRmV0Y2guYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07Cn0KCmZ1bmN0aW9uIHJldmVhbEFuc3dlcnMoKSB7CiAgICBjb25zdCBvcmlnaW5hbFBhcnNlID0gSlNPTi5wYXJzZTsKCiAgICBKU09OLnBhcnNlID0gZnVuY3Rpb24oZSwgdCkgewogICAgICAgIGxldCBib2R5ID0gb3JpZ2luYWxQYXJzZShlLCB0KTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoYm9keT8uZGF0YSkgewogICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoYm9keS5kYXRhKS5mb3JFYWNoKGtleSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IGJvZHkuZGF0YVtrZXldOwogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmVhdHVyZXMucmV2ZWFsQ29ycmVjdCAmJiBrZXkgPT09ICJhc3Nlc3NtZW50SXRlbSIgJiYgZGF0YT8uaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpdGVtRGF0YSA9IEpTT04ucGFyc2UoZGF0YS5pdGVtLml0ZW1EYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1EYXRhLnF1ZXN0aW9uICYmIGl0ZW1EYXRhLnF1ZXN0aW9uLndpZGdldHMgJiYgaXRlbURhdGEucXVlc3Rpb24uY29udGVudFswXSA9PT0gaXRlbURhdGEucXVlc3Rpb24uY29udGVudFswXS50b1VwcGVyQ2FzZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhpdGVtRGF0YS5xdWVzdGlvbi53aWRnZXRzKS5mb3JFYWNoKHdpZGdldEtleSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2lkZ2V0ID0gaXRlbURhdGEucXVlc3Rpb24ud2lkZ2V0c1t3aWRnZXRLZXldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aWRnZXQub3B0aW9ucyAmJiB3aWRnZXQub3B0aW9ucy5jaG9pY2VzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZGdldC5vcHRpb25zLmNob2ljZXMuZm9yRWFjaChjaG9pY2UgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNob2ljZS5jb3JyZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hvaWNlLmNvbnRlbnQgPSAi4pyFICIgKyBjaG9pY2UuY29udGVudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLml0ZW0uaXRlbURhdGEgPSBKU09OLnN0cmluZ2lmeShpdGVtRGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcmV2ZWFsaW5nIGFuc3dlcnM6JywgZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBib2R5OwogICAgfTsKfQoKZnVuY3Rpb24gYXV0b21hdGVDb21wbGV0aW9uKCkgewogICAgY29uc3Qgc2VsZWN0b3JzID0gWwogICAgICAgIGAucGVyc2V1c19obTN1dS1zcWAsCiAgICAgICAgYFtkYXRhLXRlc3RpZD0iZXhlcmNpc2UtY2hlY2stYW5zd2VyIl1gLAogICAgICAgIGBbZGF0YS10ZXN0aWQ9ImV4ZXJjaXNlLW5leHQtcXVlc3Rpb24iXWAsCiAgICAgICAgYC5fMXdpMnRtYTRgCiAgICBdOwoKICAgIHdpbmRvdy5naG9zdEFjdGl2ZSA9IHRydWU7CgogICAgKGFzeW5jICgpID0+IHsKICAgICAgICB3aGlsZSAod2luZG93Lmdob3N0QWN0aXZlKSB7CiAgICAgICAgICAgIGlmICh3aW5kb3cuZmVhdHVyZXMuaW5zdGFudENvbXBsZXRlICYmIHdpbmRvdy5mZWF0dXJlcy5ieXBhc3NRdWVzdGlvbnMpIHsKICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgc2VsZWN0b3Igb2Ygc2VsZWN0b3JzKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpOwogICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrRWxlbWVudChzZWxlY3Rvcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGF3YWl0IHdhaXQod2luZG93LmZlYXR1cmVDb25maWdzLmNvbXBsZXRpb25TcGVlZCAqIDgwMCk7CiAgICAgICAgfQogICAgfSkoKTsKfQoKZnVuY3Rpb24gZW5hYmxlRGFya01vZGUoKSB7CiAgICB0cnkgewogICAgICAgIGNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwogICAgICAgIHNjcmlwdC5zcmMgPSAiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9kYXJrcmVhZGVyQGxhdGVzdC9kYXJrcmVhZGVyLm1pbi5qcyI7CiAgICAgICAgc2NyaXB0Lm9ubG9hZCA9ICgpID0+IHsKICAgICAgICAgICAgRGFya1JlYWRlci5lbmFibGUoKTsKICAgICAgICB9OwogICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvIGFvIGhhYmlsaXRhciBkYXJrIG1vZGU6JywgZSk7CiAgICB9Cn0KCmZ1bmN0aW9uIGVuYWJsZUFudGlJbnNwZWN0KCkgewogICAgdHJ5IHsKICAgICAgICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgICAgICBzY3JpcHQuc3JjID0gImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vZGV2dG9vbHMtZGV0ZWN0b3IvbGliL2RldnRvb2xzLWRldGVjdG9yLm1pbi5qcyI7CiAgICAgICAgc2NyaXB0Lm9ubG9hZCA9ICgpID0+IHsKICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICd1c2Ugc3RyaWN0JzsKCiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdzZWxlY3RzdGFydCcsIGUgPT4gewogICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBjb25zdCBzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKICAgICAgICAgICAgICAgIHMudGV4dENvbnRlbnQgPSBgCiAgICAgICAgICAgICAgICAgICAgKnsKICAgICAgICAgICAgICAgICAgICAgICAgLXdlYmtpdC11c2VyLXNlbGVjdDpub25lIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICAgICAgLW1vei11c2VyLXNlbGVjdDpub25lIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICAgICAgLW1zLXVzZXItc2VsZWN0Om5vbmUhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgICAgICAgICB1c2VyLXNlbGVjdDpub25lIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICAgICAgLXdlYmtpdC11c2VyLWRyYWc6bm9uZSFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIC1raHRtbC11c2VyLWRyYWc6bm9uZSFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIC1tb3otdXNlci1kcmFnOm5vbmUhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgICAgICAgICAtby11c2VyLWRyYWc6bm9uZSFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXItZHJhZzpub25lIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzKTsKCiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCBlID0+IHsgZS5wcmV2ZW50RGVmYXVsdCgpOyByZXR1cm4gZmFsc2U7IH0pOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIGUgPT4geyBlLnByZXZlbnREZWZhdWx0KCk7IHJldHVybiBmYWxzZTsgfSk7CgogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpbWdzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2ltZycpOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGltZyBvZiBpbWdzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGltZy5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCBlID0+IHsgZS5wcmV2ZW50RGVmYXVsdCgpOyByZXR1cm4gZmFsc2U7IH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRleHRtZW51JywgZSA9PiB7IGUucHJldmVudERlZmF1bHQoKTsgcmV0dXJuIGZhbHNlOyB9KTsKCiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICBlLmtleUNvZGUgPT09IDEyMyB8fAogICAgICAgICAgICAgICAgICAgICAgICAoZS5jdHJsS2V5ICYmIGUuc2hpZnRLZXkgJiYgKGUua2V5Q29kZSA9PT0gNzMgfHwgZS5rZXlDb2RlID09PSA3NCB8fCBlLmtleUNvZGUgPT09IDY3KSkgfHwKICAgICAgICAgICAgICAgICAgICAgICAgKGUuY3RybEtleSAmJiAoZS5rZXlDb2RlID09PSA4NSB8fCBlLmtleUNvZGUgPT09IDgzIHx8IGUua2V5Q29kZSA9PT0gODApKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAoZS5tZXRhS2V5ICYmIGUuYWx0S2V5ICYmIChlLmtleUNvZGUgPT09IDczIHx8IGUua2V5Q29kZSA9PT0gNzQgfHwgZS5rZXlDb2RlID09PSA2NykpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIChlLm1ldGFLZXkgJiYgZS5rZXlDb2RlID09PSA4NSkKICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgY29uc3QgciA9ICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB1ID0gd2luZG93LmxvY2F0aW9uLnByb3RvY29sICsgIi8vIiArIHdpbmRvdy5sb2NhdGlvbi5ob3N0OwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmICE9PSB1ICsgIi8iID8gd2luZG93LmxvY2F0aW9uLmhyZWYgPSB1ICsgIi8iIDogd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBkZXZ0b29sc0RldGVjdG9yLmFkZExpc3RlbmVyKG9wZW5lZCA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9wZW5lZCkgcigpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgZGV2dG9vbHNEZXRlY3Rvci5sYXVuY2goKTsKCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cgPSBjb25zb2xlLndhcm4gPSBjb25zb2xlLmVycm9yID0gY29uc29sZS5pbmZvID0gY29uc29sZS5kZWJ1ZyA9IGNvbnNvbGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7IH07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9KSgpOwogICAgICAgIH07CgogICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKCiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJybyBhbyBhdGl2YXIgc2NyaXB0IGFudGktaW5zcGXDp8OjbzoiLCBlKTsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gYm9vdHN0cmFwKCkgewogICAgY29uc3QgbHVjaWRlU2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICBsdWNpZGVTY3JpcHQuc3JjID0gJ2h0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vbHVjaWRlL2Rpc3QvdW1kL2x1Y2lkZS5taW4uanMnOwogICAgbHVjaWRlU2NyaXB0LmFzeW5jID0gdHJ1ZTsKICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQobHVjaWRlU2NyaXB0KTsKCiAgICBhd2FpdCB3YWl0KDUwMCk7CgogICAgY3JlYXRlSW50ZXJmYWNlKCk7CiAgICBlbmFibGVBbnRpSW5zcGVjdCgpOwogICAgaW50ZXJjZXB0UXVlc3Rpb25zKCk7CiAgICBpbnRlcmNlcHRWaWRlb3MoKTsKICAgIHJldmVhbEFuc3dlcnMoKTsKICAgIGF1dG9tYXRlQ29tcGxldGlvbigpOwogICAgZW5hYmxlRGFya01vZGUoKTsKICAgIGNsZWFudXBQYWdlKCk7CiAgICAKICAgIGluaXRpYWxpemVJY29ucygpOwp9Cgpib290c3RyYXAoKTs=");
