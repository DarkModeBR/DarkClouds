/// ////////////////////////////////////////////
// SIM! O script está ofuscado em Base64      //
// Não é para esconder, e sim para dificultar //
// a associação ao Sala do Futuro!            //
////////////////////////////////////////////////


(function(base64Input){
    const decodedText = new TextDecoder("utf-8").decode(
        Uint8Array.from(atob(base64Input), char => char.charCodeAt(0))
    );
    eval(decodedText);
})("Y29uc3QgY29udHJvbFBhbmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CmNvbnN0IGZsb2F0aW5nQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7Cgp3aW5kb3cuZmVhdHVyZXMgPSB7CiAgICBieXBhc3NRdWVzdGlvbnM6IHRydWUsCiAgICBza2lwVmlkZW9zOiB0cnVlLAogICAgcmV2ZWFsQ29ycmVjdDogdHJ1ZSwKICAgIGluc3RhbnRDb21wbGV0ZTogZmFsc2UKfTsKCndpbmRvdy5mZWF0dXJlQ29uZmlncyA9IHsKICAgIGNvbXBsZXRpb25TcGVlZDogMwp9OwoKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY29udGV4dG1lbnUnLCAoZSkgPT4gIXdpbmRvdy5kaXNhYmxlU2VjdXJpdHkgJiYgZS5wcmV2ZW50RGVmYXVsdCgpKTsKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7CiAgICBpZiAoIXdpbmRvdy5kaXNhYmxlU2VjdXJpdHkgJiYgKGUua2V5ID09PSAnRjEyJyB8fCAoZS5jdHJsS2V5ICYmIGUuc2hpZnRLZXkgJiYgWydJJywgJ0MnLCAnSiddLmluY2x1ZGVzKGUua2V5KSkpKSB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgfQp9KTsKCmNvbnN0IGluaXRpYWxpemVJY29ucyA9ICgpID0+IHsKICAgIGlmICh0eXBlb2YgbHVjaWRlICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIGx1Y2lkZS5jcmVhdGVJY29ucygpOwogICAgfSBlbHNlIHsKICAgICAgICBzZXRUaW1lb3V0KGluaXRpYWxpemVJY29ucywgMTAwKTsKICAgIH0KfTsKCmNsYXNzIEV2ZW50RW1pdHRlciB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICB0aGlzLmV2ZW50cyA9IHt9OwogICAgfQogICAgb24odCwgZSkgewogICAgICAgIGlmICh0eXBlb2YgdCA9PT0gInN0cmluZyIpIHQgPSBbdF07CiAgICAgICAgdC5mb3JFYWNoKGV2ZW50ID0+IHsKICAgICAgICAgICAgaWYgKCF0aGlzLmV2ZW50c1tldmVudF0pIHRoaXMuZXZlbnRzW2V2ZW50XSA9IFtdOwogICAgICAgICAgICB0aGlzLmV2ZW50c1tldmVudF0ucHVzaChlKTsKICAgICAgICB9KTsKICAgIH0KICAgIGVtaXQodCwgLi4uZSkgewogICAgICAgIGlmICh0aGlzLmV2ZW50c1t0XSkgewogICAgICAgICAgICB0aGlzLmV2ZW50c1t0XS5mb3JFYWNoKGNhbGxiYWNrID0+IGNhbGxiYWNrKC4uLmUpKTsKICAgICAgICB9CiAgICB9Cn0KCmNvbnN0IGV2ZW50QnVzID0gbmV3IEV2ZW50RW1pdHRlcigpOwoKbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKG11dGF0aW9uc0xpc3QpID0+IHsKICAgIGZvciAobGV0IG11dGF0aW9uIG9mIG11dGF0aW9uc0xpc3QpIHsKICAgICAgICBpZiAobXV0YXRpb24udHlwZSA9PT0gJ2NoaWxkTGlzdCcpIGV2ZW50QnVzLmVtaXQoJ2RvbUNoYW5nZWQnKTsKICAgIH0KfSkub2JzZXJ2ZShkb2N1bWVudC5ib2R5LCB7IGNoaWxkTGlzdDogdHJ1ZSwgc3VidHJlZTogdHJ1ZSB9KTsKCmNvbnN0IHdhaXQgPSBtcyA9PiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTsKCmNvbnN0IGNsaWNrRWxlbWVudCA9IHNlbGVjdG9yID0+IHsKICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTsKICAgIGlmIChlbGVtZW50KSBlbGVtZW50LmNsaWNrKCk7Cn07Cgpjb25zdCB1cGRhdGVDb25maWcgPSAocGF0aCwgdmFsdWUpID0+IHsKICAgIGxldCBvYmogPSB3aW5kb3c7CiAgICBjb25zdCBwYXJ0cyA9IHBhdGguc3BsaXQoJy4nKTsKICAgIHdoaWxlIChwYXJ0cy5sZW5ndGggPiAxKSBvYmogPSBvYmpbcGFydHMuc2hpZnQoKV07CiAgICBvYmpbcGFydHNbMF1dID0gdmFsdWU7Cn07CgpmdW5jdGlvbiBjbGVhbnVwUGFnZSgpIHsKICAgIGNvbnN0IHJlbW92ZVNlbGVjdG9ycyA9IFsKICAgICAgICAnZm9vdGVyLl80c2p1enYnLAogICAgICAgICdkaXYuXzFjcDljeHBrJywKICAgICAgICAnZGl2Ll91aGxtMicsCiAgICAgICAgJ2Rpdi5fMTR3bXF1MWInLAogICAgICAgICdkaXYuXzgzMTFjY2InLAogICAgICAgICdkaXYudXNlci1pbmZvLWFsbCcsCiAgICAgICAgJ2Rpdi51c2VyLWluZm8uY2xlYXJmaXgnLAogICAgICAgICdbZGF0YS1zbHVnPSJ0b3BpYy1wcm9ncmVzcyJdJwogICAgXTsKICAgIAogICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigoKSA9PiB7CiAgICAgICAgcmVtb3ZlU2VsZWN0b3JzLmZvckVhY2goc2VsZWN0b3IgPT4gewogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKS5mb3JFYWNoKGVsID0+IGVsLnJlbW92ZSgpKTsKICAgICAgICB9KTsKICAgIH0pOwogICAgCiAgICBvYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmJvZHksIHsgY2hpbGRMaXN0OiB0cnVlLCBzdWJ0cmVlOiB0cnVlIH0pOwogICAgCiAgICByZW1vdmVTZWxlY3RvcnMuZm9yRWFjaChzZWxlY3RvciA9PiB7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikuZm9yRWFjaChlbCA9PiBlbC5yZW1vdmUoKSk7CiAgICB9KTsKfQoKZnVuY3Rpb24gY3JlYXRlSW50ZXJmYWNlKCkgewogICAgT2JqZWN0LmFzc2lnbihmbG9hdGluZ0J1dHRvbi5zdHlsZSwgewogICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLAogICAgICAgIHRvcDogJzIwcHgnLAogICAgICAgIHJpZ2h0OiAnMjBweCcsCiAgICAgICAgd2lkdGg6ICc2MHB4JywKICAgICAgICBoZWlnaHQ6ICc2MHB4JywKICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjMGEwYTBhJywKICAgICAgICBib3JkZXI6ICcycHggc29saWQgIzFhMWExYScsCiAgICAgICAgY29sb3I6ICcjZmZmJywKICAgICAgICBmb250U2l6ZTogJzI0cHgnLAogICAgICAgIGRpc3BsYXk6ICdmbGV4JywKICAgICAgICBqdXN0aWZ5Q29udGVudDogJ2NlbnRlcicsCiAgICAgICAgYWxpZ25JdGVtczogJ2NlbnRlcicsCiAgICAgICAgY3Vyc29yOiAncG9pbnRlcicsCiAgICAgICAgdXNlclNlbGVjdDogJ25vbmUnLAogICAgICAgIGJvcmRlclJhZGl1czogJzE2cHgnLAogICAgICAgIHpJbmRleDogJzEwMDAxJywKICAgICAgICB0cmFuc2l0aW9uOiAnYWxsIDAuM3MgY3ViaWMtYmV6aWVyKDAuNCwgMCwgMC4yLCAxKScsCiAgICAgICAgYmFja2Ryb3BGaWx0ZXI6ICdibHVyKDEwcHgpJywKICAgICAgICBXZWJraXRCYWNrZHJvcEZpbHRlcjogJ2JsdXIoMTBweCknCiAgICB9KTsKCiAgICBmbG9hdGluZ0J1dHRvbi5pbm5lckhUTUwgPSBgPGkgZGF0YS1sdWNpZGU9Imdob3N0IiBzdHlsZT0id2lkdGg6IDMycHg7IGhlaWdodDogMzJweDsgY29sb3I6ICM4YjVjZjY7Ij48L2k+YDsKCiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZsb2F0aW5nQnV0dG9uKTsKCiAgICBPYmplY3QuYXNzaWduKGNvbnRyb2xQYW5lbC5zdHlsZSwgewogICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgIHRvcDogJ2NhbGMoMTAwJSArIDEwcHgpJywKICAgICAgICByaWdodDogJzAnLAogICAgICAgIHdpZHRoOiAnMjgwcHgnLAogICAgICAgIG1heFdpZHRoOiAnOTB2dycsCiAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzBhMGEwYScsCiAgICAgICAgYm9yZGVyOiAnMnB4IHNvbGlkICMxYTFhMWEnLAogICAgICAgIGJvcmRlclJhZGl1czogJzE2cHgnLAogICAgICAgIGNvbG9yOiAnI2ZmZicsCiAgICAgICAgZm9udFNpemU6ICcxNHB4JywKICAgICAgICBmb250RmFtaWx5OiAnLWFwcGxlLXN5c3RlbSwgQmxpbmtNYWNTeXN0ZW1Gb250LCAiU2Vnb2UgVUkiLCBSb2JvdG8sIHNhbnMtc2VyaWYnLAogICAgICAgIGRpc3BsYXk6ICdub25lJywKICAgICAgICBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJywKICAgICAgICB6SW5kZXg6ICcxMDAwMCcsCiAgICAgICAgcGFkZGluZzogJzE2cHgnLAogICAgICAgIGN1cnNvcjogJ2RlZmF1bHQnLAogICAgICAgIHVzZXJTZWxlY3Q6ICdub25lJywKICAgICAgICB0cmFuc2l0aW9uOiAnYWxsIDAuM3MgY3ViaWMtYmV6aWVyKDAuNCwgMCwgMC4yLCAxKScsCiAgICAgICAgYmFja2Ryb3BGaWx0ZXI6ICdibHVyKDIwcHgpJywKICAgICAgICBXZWJraXRCYWNrZHJvcEZpbHRlcjogJ2JsdXIoMjBweCknLAogICAgICAgIG9wYWNpdHk6ICcwJwogICAgfSk7CgogICAgY29udHJvbFBhbmVsLmlubmVySFRNTCA9IGAKICAgICAgICA8c3R5bGU+CiAgICAgICAgICAgIEBtZWRpYSAobWF4LXdpZHRoOiA3NjhweCkgewogICAgICAgICAgICAgICAgI2toYW5HaG9zdFBhbmVsIHsKICAgICAgICAgICAgICAgICAgICB3aWR0aDogMjYwcHggIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAxMnB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgZm9udC1zaXplOiAxM3B4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICNraGFuR2hvc3RCdXR0b24gewogICAgICAgICAgICAgICAgICAgIHdpZHRoOiA1MHB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA1MHB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC5naG9zdC1mZWF0dXJlLXRleHQgewogICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTNweCAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBAa2V5ZnJhbWVzIGdob3N0U2xpZGVJbiB7CiAgICAgICAgICAgICAgICBmcm9tIHsKICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwOwogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMTBweCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0byB7CiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMTsKICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1oZWFkZXIgewogICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgICAgICBnYXA6IDEycHg7CiAgICAgICAgICAgICAgICBwYWRkaW5nLWJvdHRvbTogMTZweDsKICAgICAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDJweCBzb2xpZCAjMWExYTFhOwogICAgICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTZweDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LWhlYWRlciBpIHsKICAgICAgICAgICAgICAgIHdpZHRoOiAyNHB4OwogICAgICAgICAgICAgICAgaGVpZ2h0OiAyNHB4OwogICAgICAgICAgICAgICAgY29sb3I6ICM4YjVjZjY7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC10aXRsZSB7CiAgICAgICAgICAgICAgICBmb250LXNpemU6IDE4cHg7CiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogNzAwOwogICAgICAgICAgICAgICAgY29sb3I6ICNmZmY7CiAgICAgICAgICAgICAgICBsZXR0ZXItc3BhY2luZzogMC41cHg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1zd2l0Y2ggewogICAgICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICAgICAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgICAgICAgICAgICAgd2lkdGg6IDQ4cHg7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDI0cHg7CiAgICAgICAgICAgICAgICBmbGV4LXNocmluazogMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LXN3aXRjaCBpbnB1dCB7CiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwOwogICAgICAgICAgICAgICAgd2lkdGg6IDA7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1zbGlkZXIgewogICAgICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgICAgICAgdG9wOiAwOwogICAgICAgICAgICAgICAgbGVmdDogMDsKICAgICAgICAgICAgICAgIHJpZ2h0OiAwOwogICAgICAgICAgICAgICAgYm90dG9tOiAwOwogICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzFhMWExYTsKICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IDAuM3M7CiAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiAyNHB4OwogICAgICAgICAgICAgICAgYm9yZGVyOiAycHggc29saWQgIzJhMmEyYTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LXNsaWRlcjpiZWZvcmUgewogICAgICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgICAgICAgICAgY29udGVudDogIiI7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDE2cHg7CiAgICAgICAgICAgICAgICB3aWR0aDogMTZweDsKICAgICAgICAgICAgICAgIGxlZnQ6IDJweDsKICAgICAgICAgICAgICAgIGJvdHRvbTogMnB4OwogICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzQ0NDsKICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IDAuM3M7CiAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlucHV0OmNoZWNrZWQgKyAuZ2hvc3Qtc2xpZGVyIHsKICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICMyOEE3NDU7CiAgICAgICAgICAgICAgICBib3JkZXItY29sb3I6ICMyOEE3NDU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlucHV0OmNoZWNrZWQgKyAuZ2hvc3Qtc2xpZGVyOmJlZm9yZSB7CiAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoMjRweCk7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3QtZmVhdHVyZS1pdGVtIHsKICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgICAgICAgICAgICAgcGFkZGluZzogMTRweCAwOwogICAgICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICMxYTFhMWE7CiAgICAgICAgICAgICAgICBhbmltYXRpb246IGdob3N0U2xpZGVJbiAwLjNzIGVhc2Utb3V0OwogICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LWZlYXR1cmUtaXRlbTpob3ZlciB7CiAgICAgICAgICAgICAgICBwYWRkaW5nLWxlZnQ6IDhweDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LWZlYXR1cmUtaXRlbTpsYXN0LWNoaWxkIHsKICAgICAgICAgICAgICAgIGJvcmRlci1ib3R0b206IG5vbmU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1mZWF0dXJlLWxhYmVsIHsKICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICAgICAgZ2FwOiAxMnB4OwogICAgICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgICAgICAgZmxleC1ncm93OiAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3QtZmVhdHVyZS1sYWJlbCBpIHsKICAgICAgICAgICAgICAgIHdpZHRoOiAyMHB4OwogICAgICAgICAgICAgICAgaGVpZ2h0OiAyMHB4OwogICAgICAgICAgICAgICAgY29sb3I6ICM4YjVjZjY7CiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4ycyBlYXNlOwogICAgICAgICAgICAgICAgZmxleC1zaHJpbms6IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1mZWF0dXJlLWl0ZW06aG92ZXIgLmdob3N0LWZlYXR1cmUtbGFiZWwgaSB7CiAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5naG9zdC1mZWF0dXJlLXRleHQgewogICAgICAgICAgICAgICAgZm9udC1zaXplOiAxNHB4OwogICAgICAgICAgICAgICAgY29sb3I6ICNlMGUwZTA7CiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogNTAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3Qtc2xpZGVyLWNvbnRhaW5lciB7CiAgICAgICAgICAgICAgICBwYWRkaW5nOiAxNHB4IDA7CiAgICAgICAgICAgICAgICBhbmltYXRpb246IGdob3N0U2xpZGVJbiAwLjNzIGVhc2Utb3V0OwogICAgICAgICAgICAgICAgYW5pbWF0aW9uLWRlbGF5OiAwLjFzOwogICAgICAgICAgICAgICAgb3BhY2l0eTogMDsKICAgICAgICAgICAgICAgIGFuaW1hdGlvbi1maWxsLW1vZGU6IGZvcndhcmRzOwogICAgICAgICAgICB9CgogICAgICAgICAgICAuZ2hvc3Qtc2xpZGVyLWxhYmVsIHsKICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICAgICAgZ2FwOiA4cHg7CiAgICAgICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxMnB4OwogICAgICAgICAgICAgICAgY29sb3I6ICNhMGEwYTA7CiAgICAgICAgICAgICAgICBmb250LXNpemU6IDEycHg7CiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogNjAwOwogICAgICAgICAgICAgICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgICAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiAwLjVweDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmdob3N0LXNsaWRlci1sYWJlbCBpIHsKICAgICAgICAgICAgICAgIHdpZHRoOiAxNnB4OwogICAgICAgICAgICAgICAgaGVpZ2h0OiAxNnB4OwogICAgICAgICAgICAgICAgY29sb3I6ICM2MzY2ZjE7CiAgICAgICAgICAgICAgICBmbGV4LXNocmluazogMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW5wdXRbdHlwZT0icmFuZ2UiXSB7CiAgICAgICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgICAgIGhlaWdodDogNnB4OwogICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogM3B4OwogICAgICAgICAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIHJpZ2h0LCAjOGI1Y2Y2IDAlLCAjNjM2NmYxIDEwMCUpOwogICAgICAgICAgICAgICAgb3V0bGluZTogbm9uZTsKICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuOTsKICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IG9wYWNpdHkgMC4yczsKICAgICAgICAgICAgICAgIC13ZWJraXQtYXBwZWFyYW5jZTogbm9uZTsKICAgICAgICAgICAgICAgIGFwcGVhcmFuY2U6IG5vbmU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlucHV0W3R5cGU9InJhbmdlIl06aG92ZXIgewogICAgICAgICAgICAgICAgb3BhY2l0eTogMTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW5wdXRbdHlwZT0icmFuZ2UiXTo6LXdlYmtpdC1zbGlkZXItdGh1bWIgewogICAgICAgICAgICAgICAgLXdlYmtpdC1hcHBlYXJhbmNlOiBub25lOwogICAgICAgICAgICAgICAgYXBwZWFyYW5jZTogbm9uZTsKICAgICAgICAgICAgICAgIHdpZHRoOiAxOHB4OwogICAgICAgICAgICAgICAgaGVpZ2h0OiAxOHB4OwogICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgICAgICAgICAgICAgYmFja2dyb3VuZDogI2ZmZjsKICAgICAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlucHV0W3R5cGU9InJhbmdlIl06Oi13ZWJraXQtc2xpZGVyLXRodW1iOmhvdmVyIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogc2NhbGUoMS4yKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW5wdXRbdHlwZT0icmFuZ2UiXTo6LW1vei1yYW5nZS10aHVtYiB7CiAgICAgICAgICAgICAgICB3aWR0aDogMThweDsKICAgICAgICAgICAgICAgIGhlaWdodDogMThweDsKICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmZmY7CiAgICAgICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpbnB1dFt0eXBlPSJyYW5nZSJdOjotbW96LXJhbmdlLXRodW1iOmhvdmVyIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogc2NhbGUoMS4yKTsKICAgICAgICAgICAgfQogICAgICAgIDwvc3R5bGU+CiAgICAgICAgPGRpdiBjbGFzcz0iZ2hvc3QtaGVhZGVyIj4KICAgICAgICAgICAgPGkgZGF0YS1sdWNpZGU9Imdob3N0Ij48L2k+CiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJnaG9zdC10aXRsZSI+S2hhbkdob3N0PC9zcGFuPgogICAgICAgIDwvZGl2PgogICAgYDsKCiAgICBmbG9hdGluZ0J1dHRvbi5pZCA9ICdraGFuR2hvc3RCdXR0b24nOwogICAgY29udHJvbFBhbmVsLmlkID0gJ2toYW5HaG9zdFBhbmVsJzsKCiAgICBmbG9hdGluZ0J1dHRvbi5hcHBlbmRDaGlsZChjb250cm9sUGFuZWwpOwoKICAgIGNvbnN0IGZlYXR1cmVzID0gWwogICAgICAgIHsgaWQ6ICdieXBhc3NRdWVzdGlvbnMnLCBpY29uOiAnZmlsZS1xdWVzdGlvbicsIGxhYmVsOiAnQnlwYXNzIFF1ZXN0aW9ucycsIHZhcmlhYmxlOiAnZmVhdHVyZXMuYnlwYXNzUXVlc3Rpb25zJywgY2hlY2tlZDogdHJ1ZSB9LAogICAgICAgIHsgaWQ6ICdza2lwVmlkZW9zJywgaWNvbjogJ3ZpZGVvJywgbGFiZWw6ICdTa2lwIFZpZGVvcycsIHZhcmlhYmxlOiAnZmVhdHVyZXMuc2tpcFZpZGVvcycsIGNoZWNrZWQ6IHRydWUgfSwKICAgICAgICB7IGlkOiAncmV2ZWFsQ29ycmVjdCcsIGljb246ICdleWUnLCBsYWJlbDogJ1JldmVhbCBDb3JyZWN0JywgdmFyaWFibGU6ICdmZWF0dXJlcy5yZXZlYWxDb3JyZWN0JywgY2hlY2tlZDogdHJ1ZSB9LAogICAgICAgIHsgaWQ6ICdpbnN0YW50Q29tcGxldGUnLCBpY29uOiAnemFwJywgbGFiZWw6ICdJbnN0YW50IENvbXBsZXRlJywgdmFyaWFibGU6ICdmZWF0dXJlcy5pbnN0YW50Q29tcGxldGUnLCBjaGVja2VkOiBmYWxzZSwgZGVwZW5kZW50OiAnc3BlZWRDb250cm9sJyB9CiAgICBdOwoKICAgIGZlYXR1cmVzLmZvckVhY2goZmVhdHVyZSA9PiB7CiAgICAgICAgY29uc3QgZmVhdHVyZURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIGZlYXR1cmVEaXYuY2xhc3NOYW1lID0gJ2dob3N0LWZlYXR1cmUtaXRlbSc7CiAgICAgICAgZmVhdHVyZURpdi5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0iZ2hvc3QtZmVhdHVyZS1sYWJlbCI+CiAgICAgICAgICAgICAgICA8aSBkYXRhLWx1Y2lkZT0iJHtmZWF0dXJlLmljb259Ij48L2k+CiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZ2hvc3QtZmVhdHVyZS10ZXh0Ij4ke2ZlYXR1cmUubGFiZWx9PC9zcGFuPgogICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICA8bGFiZWwgY2xhc3M9Imdob3N0LXN3aXRjaCI+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSIke2ZlYXR1cmUuaWR9IiAke2ZlYXR1cmUuY2hlY2tlZCA/ICdjaGVja2VkJyA6ICcnfT4KICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJnaG9zdC1zbGlkZXIiPjwvc3Bhbj4KICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICBgOwogICAgICAgIGNvbnRyb2xQYW5lbC5hcHBlbmRDaGlsZChmZWF0dXJlRGl2KTsKCiAgICAgICAgY29uc3QgY2hlY2tib3ggPSBmZWF0dXJlRGl2LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7CiAgICAgICAgY2hlY2tib3guYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHsKICAgICAgICAgICAgdXBkYXRlQ29uZmlnKGZlYXR1cmUudmFyaWFibGUsIGUudGFyZ2V0LmNoZWNrZWQpOwogICAgICAgICAgICBpZiAoZmVhdHVyZS5kZXBlbmRlbnQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGRlcGVuZGVudEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZmVhdHVyZS5kZXBlbmRlbnQpOwogICAgICAgICAgICAgICAgaWYgKGRlcGVuZGVudEVsKSB7CiAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW50RWwuc3R5bGUuZGlzcGxheSA9IGUudGFyZ2V0LmNoZWNrZWQgPyAnYmxvY2snIDogJ25vbmUnOwogICAgICAgICAgICAgICAgICAgIGRlcGVuZGVudEVsLnN0eWxlLm9wYWNpdHkgPSBlLnRhcmdldC5jaGVja2VkID8gJzEnIDogJzAnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChmZWF0dXJlLmlkID09PSAnaW5zdGFudENvbXBsZXRlJyAmJiBlLnRhcmdldC5jaGVja2VkICYmICF3aW5kb3cuZmVhdHVyZXMuYnlwYXNzUXVlc3Rpb25zKSB7CiAgICAgICAgICAgICAgICBjb25zdCBieXBhc3NDaGVja2JveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdieXBhc3NRdWVzdGlvbnMnKTsKICAgICAgICAgICAgICAgIGlmIChieXBhc3NDaGVja2JveCkgewogICAgICAgICAgICAgICAgICAgIGJ5cGFzc0NoZWNrYm94LmNoZWNrZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mZWF0dXJlcy5ieXBhc3NRdWVzdGlvbnMgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9KTsKCiAgICBjb25zdCBzbGlkZXJDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHNsaWRlckNvbnRhaW5lci5jbGFzc05hbWUgPSAnZ2hvc3Qtc2xpZGVyLWNvbnRhaW5lcic7CiAgICBzbGlkZXJDb250YWluZXIuaWQgPSAnc3BlZWRDb250cm9sJzsKICAgIHNsaWRlckNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgc2xpZGVyQ29udGFpbmVyLmlubmVySFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJnaG9zdC1zbGlkZXItbGFiZWwiPgogICAgICAgICAgICA8aSBkYXRhLWx1Y2lkZT0idGltZXIiPjwvaT4KICAgICAgICAgICAgPHNwYW4+Q29tcGxldGlvbiBTcGVlZDwvc3Bhbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8aW5wdXQgdHlwZT0icmFuZ2UiIG1pbj0iMSIgbWF4PSIzIiB2YWx1ZT0iMSIgaWQ9InNwZWVkU2xpZGVyIj4KICAgIGA7CiAgICBjb250cm9sUGFuZWwuYXBwZW5kQ2hpbGQoc2xpZGVyQ29udGFpbmVyKTsKCiAgICBjb25zdCBzcGVlZFNsaWRlciA9IHNsaWRlckNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpOwogICAgc3BlZWRTbGlkZXIuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoZSkgPT4gewogICAgICAgIHdpbmRvdy5mZWF0dXJlQ29uZmlncy5jb21wbGV0aW9uU3BlZWQgPSA0IC0gZS50YXJnZXQudmFsdWU7CiAgICB9KTsKCiAgICBsZXQgbWVudU9wZW4gPSBmYWxzZTsKICAgIGxldCBhdXRvQ2xvc2VUaW1lb3V0ID0gbnVsbDsKCiAgICBmdW5jdGlvbiBvcGVuTWVudSgpIHsKICAgICAgICBjb250cm9sUGFuZWwuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGNvbnRyb2xQYW5lbC5zdHlsZS5vcGFjaXR5ID0gJzEnLCAxMCk7CiAgICAgICAgbWVudU9wZW4gPSB0cnVlOwoKICAgICAgICBjbGVhclRpbWVvdXQoYXV0b0Nsb3NlVGltZW91dCk7CiAgICAgICAgYXV0b0Nsb3NlVGltZW91dCA9IHNldFRpbWVvdXQoY2xvc2VNZW51LCA1MDAwKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjbG9zZU1lbnUoKSB7CiAgICAgICAgY29udHJvbFBhbmVsLnN0eWxlLm9wYWNpdHkgPSAnMCc7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiBjb250cm9sUGFuZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJywgMzAwKTsKICAgICAgICBtZW51T3BlbiA9IGZhbHNlOwogICAgfQoKICAgIGZsb2F0aW5nQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGlmIChtZW51T3BlbikgewogICAgICAgICAgICBjbG9zZU1lbnUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBvcGVuTWVudSgpOwogICAgICAgIH0KICAgIH0pOwoKICAgIGNvbnRyb2xQYW5lbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBjbGVhclRpbWVvdXQoYXV0b0Nsb3NlVGltZW91dCk7CiAgICAgICAgYXV0b0Nsb3NlVGltZW91dCA9IHNldFRpbWVvdXQoY2xvc2VNZW51LCAzMDAwKTsKICAgIH0pOwp9Cgpjb25zdCBjb3JyZWN0QW5zd2VycyA9IG5ldyBNYXAoKTsKCmNvbnN0IHRvRnJhY3Rpb24gPSAoZCkgPT4gewogICAgaWYgKGQgPT09IDAgfHwgZCA9PT0gMSkgcmV0dXJuIFN0cmluZyhkKTsKICAgIGNvbnN0IGRlY2ltYWxzID0gKFN0cmluZyhkKS5zcGxpdCgnLicpWzFdIHx8ICcnKS5sZW5ndGg7CiAgICBsZXQgbnVtID0gTWF0aC5yb3VuZChkICogTWF0aC5wb3coMTAsIGRlY2ltYWxzKSk7CiAgICBsZXQgZGVuID0gTWF0aC5wb3coMTAsIGRlY2ltYWxzKTsKICAgIGNvbnN0IGdjZCA9IChhLCBiKSA9PiB7CiAgICAgICAgd2hpbGUgKGIpIHsKICAgICAgICAgICAgW2EsIGJdID0gW2IsIGEgJSBiXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGE7CiAgICB9OwogICAgY29uc3QgZGl2ID0gZ2NkKE1hdGguYWJzKG51bSksIE1hdGguYWJzKGRlbikpOwogICAgcmV0dXJuIGRlbiAvIGRpdiA9PT0gMSA/IFN0cmluZyhudW0gLyBkaXYpIDogYCR7bnVtIC8gZGl2fS8ke2RlbiAvIGRpdn1gOwp9OwoKZnVuY3Rpb24gaW50ZXJjZXB0UXVlc3Rpb25zKCkgewogICAgY29uc3Qgb3JpZ2luYWxGZXRjaCA9IHdpbmRvdy5mZXRjaDsKCiAgICB3aW5kb3cuZmV0Y2ggPSBhc3luYyBmdW5jdGlvbihpbnB1dCwgaW5pdCkgewogICAgICAgIGNvbnN0IHVybCA9IGlucHV0IGluc3RhbmNlb2YgUmVxdWVzdCA/IGlucHV0LnVybCA6IGlucHV0OwogICAgICAgIGxldCBib2R5ID0gaW5wdXQgaW5zdGFuY2VvZiBSZXF1ZXN0ID8gYXdhaXQgaW5wdXQuY2xvbmUoKS50ZXh0KCkgOiBpbml0Py5ib2R5OwoKICAgICAgICBpZiAod2luZG93LmZlYXR1cmVzLmJ5cGFzc1F1ZXN0aW9ucyAmJiB1cmwuaW5jbHVkZXMoJ2dldEFzc2Vzc21lbnRJdGVtJykgJiYgYm9keSkgewogICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBvcmlnaW5hbEZldGNoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIGNvbnN0IGNsb25lID0gcmVzLmNsb25lKCk7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGNsb25lLmpzb24oKTsKCiAgICAgICAgICAgICAgICBsZXQgaXRlbSA9IG51bGw7CiAgICAgICAgICAgICAgICBpZiAoZGF0YT8uZGF0YSkgewogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIGRhdGEuZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5kYXRhW2tleV0/Lml0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0gPSBkYXRhLmRhdGFba2V5XS5pdGVtOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCFpdGVtPy5pdGVtRGF0YSkgcmV0dXJuIHJlczsKCiAgICAgICAgICAgICAgICBsZXQgaXRlbURhdGEgPSBKU09OLnBhcnNlKGl0ZW0uaXRlbURhdGEpOwogICAgICAgICAgICAgICAgY29uc3QgYW5zd2VycyA9IFtdOwoKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgd10gb2YgT2JqZWN0LmVudHJpZXMoaXRlbURhdGEucXVlc3Rpb24ud2lkZ2V0cykpIHsKICAgICAgICAgICAgICAgICAgICBpZiAody50eXBlID09PSAncmFkaW8nICYmIHcub3B0aW9ucz8uY2hvaWNlcykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaG9pY2VzID0gdy5vcHRpb25zLmNob2ljZXMubWFwKChjLCBpKSA9PiAoeyAuLi5jLCBpZDogYy5pZCB8fCBgcmFkaW8tY2hvaWNlLSR7aX1gIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29ycmVjdCA9IGNob2ljZXMuZmluZChjID0+IGMuY29ycmVjdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3JyZWN0KSBhbnN3ZXJzLnB1c2goeyB0eXBlOiAncmFkaW8nLCBjaG9pY2VJZDogY29ycmVjdC5pZCwgd2lkZ2V0S2V5OiBrZXkgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh3LnR5cGUgPT09ICdudW1lcmljLWlucHV0JyAmJiB3Lm9wdGlvbnM/LmFuc3dlcnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29ycmVjdCA9IHcub3B0aW9ucy5hbnN3ZXJzLmZpbmQoYSA9PiBhLnN0YXR1cyA9PT0gJ2NvcnJlY3QnKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvcnJlY3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbCA9IGNvcnJlY3QuYW5zd2VyRm9ybXM/LnNvbWUoZiA9PiBmID09PSAncHJvcGVyJyB8fCBmID09PSAnaW1wcm9wZXInKSA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9GcmFjdGlvbihjb3JyZWN0LnZhbHVlKSA6IFN0cmluZyhjb3JyZWN0LnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuc3dlcnMucHVzaCh7IHR5cGU6ICdudW1lcmljJywgdmFsdWU6IHZhbCwgd2lkZ2V0S2V5OiBrZXkgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHcudHlwZSA9PT0gJ2V4cHJlc3Npb24nICYmIHcub3B0aW9ucz8uYW5zd2VyRm9ybXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29ycmVjdCA9IHcub3B0aW9ucy5hbnN3ZXJGb3Jtcy5maW5kKGYgPT4gZi5jb25zaWRlcmVkID09PSAnY29ycmVjdCcgfHwgZi5mb3JtID09PSB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvcnJlY3QpIGFuc3dlcnMucHVzaCh7IHR5cGU6ICdleHByZXNzaW9uJywgdmFsdWU6IGNvcnJlY3QudmFsdWUsIHdpZGdldEtleToga2V5IH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAody50eXBlID09PSAnZ3JhcGhlcicgJiYgdy5vcHRpb25zPy5jb3JyZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGMgPSB3Lm9wdGlvbnMuY29ycmVjdDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMudHlwZSAmJiBjLmNvb3JkcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5zd2Vycy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZ3JhcGhlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JhcGhUeXBlOiBjLnR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29vcmRzOiBjLmNvb3JkcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3ltcHRvdGU6IGMuYXN5bXB0b3RlIHx8IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkZ2V0S2V5OiBrZXkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChhbnN3ZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBjb3JyZWN0QW5zd2Vycy5zZXQoaXRlbS5pZCwgYW5zd2Vycyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGl0ZW1EYXRhLnF1ZXN0aW9uLmNvbnRlbnQ/LlswXSA9PT0gaXRlbURhdGEucXVlc3Rpb24uY29udGVudFswXS50b1VwcGVyQ2FzZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbURhdGEuYW5zd2VyQXJlYSA9IHsgY2FsY3VsYXRvcjogZmFsc2UsIGNoaTJUYWJsZTogZmFsc2UsIHBlcmlvZGljVGFibGU6IGZhbHNlLCB0VGFibGU6IGZhbHNlLCB6VGFibGU6IGZhbHNlIH07CiAgICAgICAgICAgICAgICAgICAgaXRlbURhdGEucXVlc3Rpb24uY29udGVudCA9IGBbW+KYgyByYWRpbyAxXV1gOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1EYXRhLnF1ZXN0aW9uLndpZGdldHMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICJyYWRpbyAxIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogInJhZGlvIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsaWdubWVudDogImRlZmF1bHQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGljOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyYWRlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaG9pY2VzOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgY29udGVudDogIvCfjYAiLCBjb3JyZWN0OiB0cnVlLCBpZDogImNvcnJlY3QtY2hvaWNlIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGNvbnRlbnQ6ICLinYwiLCBjb3JyZWN0OiBmYWxzZSwgaWQ6ICJpbmNvcnJlY3QtY2hvaWNlIiB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5kb21pemU6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpcGxlU2VsZWN0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5Q291bnQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzZWxlY3RFbmFibGVkOiBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcnNpb246IHsgbWFqb3I6IDEsIG1pbm9yOiAwIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1vZGlmaWVkID0geyAuLi5kYXRhIH07CgogICAgICAgICAgICAgICAgICAgIGlmIChtb2RpZmllZC5kYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIG1vZGlmaWVkLmRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb2RpZmllZC5kYXRhW2tleV0/Lml0ZW0/Lml0ZW1EYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWQuZGF0YVtrZXldLml0ZW0uaXRlbURhdGEgPSBKU09OLnN0cmluZ2lmeShpdGVtRGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkobW9kaWZpZWQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogcmVzLnN0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogcmVzLnN0YXR1c1RleHQsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHJlcy5oZWFkZXJzCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHF1ZXN0aW9uIGJ5cGFzczonLCBlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdpbmRvdy5mZWF0dXJlcy5ieXBhc3NRdWVzdGlvbnMgJiYgYm9keT8uaW5jbHVkZXMoJyJvcGVyYXRpb25OYW1lIjoiYXR0ZW1wdFByb2JsZW0iJykpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGxldCBib2R5T2JqID0gSlNPTi5wYXJzZShib2R5KTsKICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1JZCA9IGJvZHlPYmoudmFyaWFibGVzPy5pbnB1dD8uYXNzZXNzbWVudEl0ZW1JZDsKICAgICAgICAgICAgICAgIGNvbnN0IGFuc3dlcnMgPSBjb3JyZWN0QW5zd2Vycy5nZXQoaXRlbUlkKTsKCiAgICAgICAgICAgICAgICBpZiAoYW5zd2Vycz8ubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBbXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB1c2VySW5wdXQgPSB7fTsKICAgICAgICAgICAgICAgICAgICBsZXQgc3RhdGUgPSBib2R5T2JqLnZhcmlhYmxlcy5pbnB1dC5hdHRlbXB0U3RhdGUgPyBKU09OLnBhcnNlKGJvZHlPYmoudmFyaWFibGVzLmlucHV0LmF0dGVtcHRTdGF0ZSkgOiBudWxsOwoKICAgICAgICAgICAgICAgICAgICBhbnN3ZXJzLmZvckVhY2goYSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLnR5cGUgPT09ICdyYWRpbycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQucHVzaCh7IHNlbGVjdGVkQ2hvaWNlSWRzOiBbYS5jaG9pY2VJZF0gfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VySW5wdXRbYS53aWRnZXRLZXldID0geyBzZWxlY3RlZENob2ljZUlkczogW2EuY2hvaWNlSWRdIH07CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYS50eXBlID09PSAnbnVtZXJpYycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQucHVzaCh7IGN1cnJlbnRWYWx1ZTogYS52YWx1ZSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJbnB1dFthLndpZGdldEtleV0gPSB7IGN1cnJlbnRWYWx1ZTogYS52YWx1ZSB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlPy5bYS53aWRnZXRLZXldKSBzdGF0ZVthLndpZGdldEtleV0uY3VycmVudFZhbHVlID0gYS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhLnR5cGUgPT09ICdleHByZXNzaW9uJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudC5wdXNoKGEudmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklucHV0W2Eud2lkZ2V0S2V5XSA9IGEudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGU/LlthLndpZGdldEtleV0pIHN0YXRlW2Eud2lkZ2V0S2V5XS52YWx1ZSA9IGEudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYS50eXBlID09PSAnZ3JhcGhlcicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGdyYXBoID0geyB0eXBlOiBhLmdyYXBoVHlwZSwgY29vcmRzOiBhLmNvb3JkcywgYXN5bXB0b3RlOiBhLmFzeW1wdG90ZSB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudC5wdXNoKGdyYXBoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJbnB1dFthLndpZGdldEtleV0gPSBncmFwaDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZT8uW2Eud2lkZ2V0S2V5XSkgc3RhdGVbYS53aWRnZXRLZXldLnBsb3QgPSBncmFwaDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBib2R5T2JqLnZhcmlhYmxlcy5pbnB1dC5hdHRlbXB0Q29udGVudCA9IEpTT04uc3RyaW5naWZ5KFtjb250ZW50LCBbXV0pOwogICAgICAgICAgICAgICAgICAgIGJvZHlPYmoudmFyaWFibGVzLmlucHV0LnVzZXJJbnB1dCA9IEpTT04uc3RyaW5naWZ5KHVzZXJJbnB1dCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlKSBib2R5T2JqLnZhcmlhYmxlcy5pbnB1dC5hdHRlbXB0U3RhdGUgPSBKU09OLnN0cmluZ2lmeShzdGF0ZSk7CgogICAgICAgICAgICAgICAgICAgIGJvZHkgPSBKU09OLnN0cmluZ2lmeShib2R5T2JqKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBSZXF1ZXN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0ID0gbmV3IFJlcXVlc3QoaW5wdXQsIHsgYm9keSB9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpbml0LmJvZHkgPSBib2R5OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYXBwbHlpbmcgYW5zd2VyczonLCBlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG9yaWdpbmFsRmV0Y2guYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07Cn0KCmZ1bmN0aW9uIGludGVyY2VwdFZpZGVvcygpIHsKICAgIGNvbnN0IG9yaWdpbmFsRmV0Y2ggPSB3aW5kb3cuZmV0Y2g7CgogICAgd2luZG93LmZldGNoID0gYXN5bmMgZnVuY3Rpb24oaW5wdXQsIGluaXQpIHsKICAgICAgICBsZXQgYm9keTsKICAgICAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBSZXF1ZXN0KSB7CiAgICAgICAgICAgIGJvZHkgPSBhd2FpdCBpbnB1dC5jbG9uZSgpLnRleHQoKTsKICAgICAgICB9IGVsc2UgaWYgKGluaXQgJiYgaW5pdC5ib2R5KSB7CiAgICAgICAgICAgIGJvZHkgPSBpbml0LmJvZHk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2luZG93LmZlYXR1cmVzLnNraXBWaWRlb3MgJiYgYm9keSAmJiBib2R5LmluY2x1ZGVzKCcib3BlcmF0aW9uTmFtZSI6InVwZGF0ZVVzZXJWaWRlb1Byb2dyZXNzIicpKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBsZXQgYm9keU9iaiA9IEpTT04ucGFyc2UoYm9keSk7CiAgICAgICAgICAgICAgICBpZiAoYm9keU9iai52YXJpYWJsZXMgJiYgYm9keU9iai52YXJpYWJsZXMuaW5wdXQpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkdXJhdGlvblNlY29uZHMgPSBib2R5T2JqLnZhcmlhYmxlcy5pbnB1dC5kdXJhdGlvblNlY29uZHM7CiAgICAgICAgICAgICAgICAgICAgYm9keU9iai52YXJpYWJsZXMuaW5wdXQuc2Vjb25kc1dhdGNoZWQgPSBkdXJhdGlvblNlY29uZHM7CiAgICAgICAgICAgICAgICAgICAgYm9keU9iai52YXJpYWJsZXMuaW5wdXQubGFzdFNlY29uZFdhdGNoZWQgPSBkdXJhdGlvblNlY29uZHM7CiAgICAgICAgICAgICAgICAgICAgYm9keSA9IEpTT04uc3RyaW5naWZ5KGJvZHlPYmopOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIFJlcXVlc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQgPSBuZXcgUmVxdWVzdChpbnB1dCwgeyBib2R5OiBib2R5IH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGluaXQuYm9keSA9IGJvZHk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB2aWRlbyBza2lwOicsIGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBvcmlnaW5hbEZldGNoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9Owp9CgpmdW5jdGlvbiByZXZlYWxBbnN3ZXJzKCkgewogICAgY29uc3Qgb3JpZ2luYWxQYXJzZSA9IEpTT04ucGFyc2U7CgogICAgSlNPTi5wYXJzZSA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICBsZXQgYm9keSA9IG9yaWdpbmFsUGFyc2UoZSwgdCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGJvZHk/LmRhdGEpIHsKICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGJvZHkuZGF0YSkuZm9yRWFjaChrZXkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBib2R5LmRhdGFba2V5XTsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZlYXR1cmVzLnJldmVhbENvcnJlY3QgJiYga2V5ID09PSAiYXNzZXNzbWVudEl0ZW0iICYmIGRhdGE/Lml0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlbURhdGEgPSBKU09OLnBhcnNlKGRhdGEuaXRlbS5pdGVtRGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtRGF0YS5xdWVzdGlvbiAmJiBpdGVtRGF0YS5xdWVzdGlvbi53aWRnZXRzICYmIGl0ZW1EYXRhLnF1ZXN0aW9uLmNvbnRlbnRbMF0gPT09IGl0ZW1EYXRhLnF1ZXN0aW9uLmNvbnRlbnRbMF0udG9VcHBlckNhc2UoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoaXRlbURhdGEucXVlc3Rpb24ud2lkZ2V0cykuZm9yRWFjaCh3aWRnZXRLZXkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHdpZGdldCA9IGl0ZW1EYXRhLnF1ZXN0aW9uLndpZGdldHNbd2lkZ2V0S2V5XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod2lkZ2V0Lm9wdGlvbnMgJiYgd2lkZ2V0Lm9wdGlvbnMuY2hvaWNlcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWRnZXQub3B0aW9ucy5jaG9pY2VzLmZvckVhY2goY2hvaWNlID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaG9pY2UuY29ycmVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNob2ljZS5jb250ZW50ID0gIuKchSAiICsgY2hvaWNlLmNvbnRlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5pdGVtLml0ZW1EYXRhID0gSlNPTi5zdHJpbmdpZnkoaXRlbURhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJldmVhbGluZyBhbnN3ZXJzOicsIGUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYm9keTsKICAgIH07Cn0KCmZ1bmN0aW9uIGF1dG9tYXRlQ29tcGxldGlvbigpIHsKICAgIGNvbnN0IHNlbGVjdG9ycyA9IFsKICAgICAgICBgLnBlcnNldXNfaG0zdXUtc3FgLAogICAgICAgIGBbZGF0YS10ZXN0aWQ9ImV4ZXJjaXNlLWNoZWNrLWFuc3dlciJdYCwKICAgICAgICBgW2RhdGEtdGVzdGlkPSJleGVyY2lzZS1uZXh0LXF1ZXN0aW9uIl1gLAogICAgICAgIGAuXzF3aTJ0bWE0YAogICAgXTsKCiAgICB3aW5kb3cuZ2hvc3RBY3RpdmUgPSB0cnVlOwoKICAgIChhc3luYyAoKSA9PiB7CiAgICAgICAgd2hpbGUgKHdpbmRvdy5naG9zdEFjdGl2ZSkgewogICAgICAgICAgICBpZiAod2luZG93LmZlYXR1cmVzLmluc3RhbnRDb21wbGV0ZSAmJiB3aW5kb3cuZmVhdHVyZXMuYnlwYXNzUXVlc3Rpb25zKSB7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHNlbGVjdG9yIG9mIHNlbGVjdG9ycykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCkgewogICAgICAgICAgICAgICAgICAgICAgICBjbGlja0VsZW1lbnQoc2VsZWN0b3IpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBhd2FpdCB3YWl0KHdpbmRvdy5mZWF0dXJlQ29uZmlncy5jb21wbGV0aW9uU3BlZWQgKiA4MDApOwogICAgICAgIH0KICAgIH0pKCk7Cn0KCmZ1bmN0aW9uIGVuYWJsZURhcmtNb2RlKCkgewogICAgdHJ5IHsKICAgICAgICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgICAgICBzY3JpcHQuc3JjID0gImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vZGFya3JlYWRlckBsYXRlc3QvZGFya3JlYWRlci5taW4uanMiOwogICAgICAgIHNjcmlwdC5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgICAgIERhcmtSZWFkZXIuZW5hYmxlKCk7CiAgICAgICAgfTsKICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHNjcmlwdCk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignRXJybyBhbyBoYWJpbGl0YXIgZGFyayBtb2RlOicsIGUpOwogICAgfQp9CgpmdW5jdGlvbiBlbmFibGVBbnRpSW5zcGVjdCgpIHsKICAgIHRyeSB7CiAgICAgICAgY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICAgICAgc2NyaXB0LnNyYyA9ICJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2RldnRvb2xzLWRldGVjdG9yL2xpYi9kZXZ0b29scy1kZXRlY3Rvci5taW4uanMiOwogICAgICAgIHNjcmlwdC5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAndXNlIHN0cmljdCc7CgogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2VsZWN0c3RhcnQnLCBlID0+IHsKICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgY29uc3QgcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7CiAgICAgICAgICAgICAgICBzLnRleHRDb250ZW50ID0gYAogICAgICAgICAgICAgICAgICAgICp7CiAgICAgICAgICAgICAgICAgICAgICAgIC13ZWJraXQtdXNlci1zZWxlY3Q6bm9uZSFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIC1tb3otdXNlci1zZWxlY3Q6bm9uZSFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIC1tcy11c2VyLXNlbGVjdDpub25lIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICAgICAgdXNlci1zZWxlY3Q6bm9uZSFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIC13ZWJraXQtdXNlci1kcmFnOm5vbmUhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgICAgICAgICAta2h0bWwtdXNlci1kcmFnOm5vbmUhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgICAgICAgICAtbW96LXVzZXItZHJhZzpub25lIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICAgICAgLW8tdXNlci1kcmFnOm5vbmUhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgICAgICAgICB1c2VyLWRyYWc6bm9uZSFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQocyk7CgogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgZSA9PiB7IGUucHJldmVudERlZmF1bHQoKTsgcmV0dXJuIGZhbHNlOyB9KTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCBlID0+IHsgZS5wcmV2ZW50RGVmYXVsdCgpOyByZXR1cm4gZmFsc2U7IH0pOwoKICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW1ncyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdpbWcnKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpbWcgb2YgaW1ncykgewogICAgICAgICAgICAgICAgICAgICAgICBpbWcuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgZSA9PiB7IGUucHJldmVudERlZmF1bHQoKTsgcmV0dXJuIGZhbHNlOyB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjb250ZXh0bWVudScsIGUgPT4geyBlLnByZXZlbnREZWZhdWx0KCk7IHJldHVybiBmYWxzZTsgfSk7CgogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGUgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgZS5rZXlDb2RlID09PSAxMjMgfHwKICAgICAgICAgICAgICAgICAgICAgICAgKGUuY3RybEtleSAmJiBlLnNoaWZ0S2V5ICYmIChlLmtleUNvZGUgPT09IDczIHx8IGUua2V5Q29kZSA9PT0gNzQgfHwgZS5rZXlDb2RlID09PSA2NykpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIChlLmN0cmxLZXkgJiYgKGUua2V5Q29kZSA9PT0gODUgfHwgZS5rZXlDb2RlID09PSA4MyB8fCBlLmtleUNvZGUgPT09IDgwKSkgfHwKICAgICAgICAgICAgICAgICAgICAgICAgKGUubWV0YUtleSAmJiBlLmFsdEtleSAmJiAoZS5rZXlDb2RlID09PSA3MyB8fCBlLmtleUNvZGUgPT09IDc0IHx8IGUua2V5Q29kZSA9PT0gNjcpKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAoZS5tZXRhS2V5ICYmIGUua2V5Q29kZSA9PT0gODUpCiAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGNvbnN0IHIgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdSA9IHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCArICIvLyIgKyB3aW5kb3cubG9jYXRpb24uaG9zdDsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiAhPT0gdSArICIvIiA/IHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gdSArICIvIiA6IHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgZGV2dG9vbHNEZXRlY3Rvci5hZGRMaXN0ZW5lcihvcGVuZWQgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChvcGVuZWQpIHIoKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGRldnRvb2xzRGV0ZWN0b3IubGF1bmNoKCk7CgogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nID0gY29uc29sZS53YXJuID0gY29uc29sZS5lcnJvciA9IGNvbnNvbGUuaW5mbyA9IGNvbnNvbGUuZGVidWcgPSBjb25zb2xlLmNsZWFyID0gZnVuY3Rpb24gKCkgeyB9OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSkoKTsKICAgICAgICB9OwoKICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHNjcmlwdCk7CgogICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm8gYW8gYXRpdmFyIHNjcmlwdCBhbnRpLWluc3Blw6fDo286IiwgZSk7CiAgICB9Cn0KCmFzeW5jIGZ1bmN0aW9uIGJvb3RzdHJhcCgpIHsKICAgIGNvbnN0IGx1Y2lkZVNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwogICAgbHVjaWRlU2NyaXB0LnNyYyA9ICdodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2x1Y2lkZS9kaXN0L3VtZC9sdWNpZGUubWluLmpzJzsKICAgIGx1Y2lkZVNjcmlwdC5hc3luYyA9IHRydWU7CiAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKGx1Y2lkZVNjcmlwdCk7CgogICAgYXdhaXQgd2FpdCg1MDApOwoKICAgIGNyZWF0ZUludGVyZmFjZSgpOwogICAgZW5hYmxlQW50aUluc3BlY3QoKTsKICAgIGludGVyY2VwdFF1ZXN0aW9ucygpOwogICAgaW50ZXJjZXB0VmlkZW9zKCk7CiAgICByZXZlYWxBbnN3ZXJzKCk7CiAgICBhdXRvbWF0ZUNvbXBsZXRpb24oKTsKICAgIGVuYWJsZURhcmtNb2RlKCk7CiAgICBjbGVhbnVwUGFnZSgpOwogICAgaW5pdGlhbGl6ZUljb25zKCk7Cn0KCmJvb3RzdHJhcCgpOw==");
